import{Hash as e,aInRange as t,abool as n,abytes as r,add as i,add3H as a,add3L as o,add4H as s,add4L as c,add5H as l,add5L as u,aexists as d,ahash as f,anumber as p,aoutput as m,bitLen as h,bitMask as g,bytesToHex as _,bytesToNumberBE as v,bytesToNumberLE as y,clean as b,concatBytes as x,concatBytes$1 as S,createHasher as C,createHmacDrbg as w,createView as T,ensureBytes as E,hexToBytes as D,inRange as O,isBytes as ee,memoized as k,numberToBytesBE as A,numberToBytesLE as j,numberToHexUnpadded as M,randomBytes as te,rotr as N,rotrBH as P,rotrBL as F,rotrSH as I,rotrSL as L,shrSH as ne,shrSL as re,split as ie,toBytes as ae,validateObject as R}from"./utils-DlSZ4OeX.js";function oe(e,t,n,r){if(typeof e.setBigUint64==`function`)return e.setBigUint64(t,n,r);let i=BigInt(32),a=BigInt(4294967295),o=Number(n>>i&a),s=Number(n&a),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,s,r)}function se(e,t,n){return e&t^~e&n}function ce(e,t,n){return e&t^e&n^t&n}var le=class extends e{constructor(e,t,n,r){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.buffer=new Uint8Array(e),this.view=T(this.buffer)}update(e){d(this),e=ae(e),r(e);let{view:t,buffer:n,blockLen:i}=this,a=e.length;for(let r=0;r<a;){let o=Math.min(i-this.pos,a-r);if(o===i){let t=T(e);for(;i<=a-r;r+=i)this.process(t,r);continue}n.set(e.subarray(r,r+o),this.pos),this.pos+=o,r+=o,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){d(this),m(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:i}=this,{pos:a}=this;t[a++]=128,b(this.buffer.subarray(a)),this.padOffset>r-a&&(this.process(n,0),a=0);for(let e=a;e<r;e++)t[e]=0;oe(n,r-8,BigInt(this.length*8),i),this.process(n,0);let o=T(e),s=this.outputLen;if(s%4)throw Error(`_sha2: outputLen should be aligned to 32bit`);let c=s/4,l=this.get();if(c>l.length)throw Error(`_sha2: outputLen bigger than state`);for(let e=0;e<c;e++)o.setUint32(4*e,l[e],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:i,destroyed:a,pos:o}=this;return e.destroyed=a,e.finished=i,e.length=r,e.pos=o,r%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const z=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),B=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),V=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),ue=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),H=new Uint32Array(64);var de=class extends le{constructor(e=32){super(64,e,8,!1),this.A=z[0]|0,this.B=z[1]|0,this.C=z[2]|0,this.D=z[3]|0,this.E=z[4]|0,this.F=z[5]|0,this.G=z[6]|0,this.H=z[7]|0}get(){let{A:e,B:t,C:n,D:r,E:i,F:a,G:o,H:s}=this;return[e,t,n,r,i,a,o,s]}set(e,t,n,r,i,a,o,s){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=i|0,this.F=a|0,this.G=o|0,this.H=s|0}process(e,t){for(let n=0;n<16;n++,t+=4)H[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=H[e-15],n=H[e-2],r=N(t,7)^N(t,18)^t>>>3;H[e]=(N(n,17)^N(n,19)^n>>>10)+H[e-7]+r+H[e-16]|0}let{A:n,B:r,C:i,D:a,E:o,F:s,G:c,H:l}=this;for(let e=0;e<64;e++){let t=N(o,6)^N(o,11)^N(o,25),u=l+t+se(o,s,c)+ue[e]+H[e]|0,d=(N(n,2)^N(n,13)^N(n,22))+ce(n,r,i)|0;l=c,c=s,s=o,o=a+u|0,a=i,i=r,r=n,n=u+d|0}n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,a=a+this.D|0,o=o+this.E|0,s=s+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,i,a,o,s,c,l)}roundClean(){b(H)}destroy(){this.set(0,0,0,0,0,0,0,0),b(this.buffer)}};const fe=(()=>ie(`0x428a2f98d728ae22.0x7137449123ef65cd.0xb5c0fbcfec4d3b2f.0xe9b5dba58189dbbc.0x3956c25bf348b538.0x59f111f1b605d019.0x923f82a4af194f9b.0xab1c5ed5da6d8118.0xd807aa98a3030242.0x12835b0145706fbe.0x243185be4ee4b28c.0x550c7dc3d5ffb4e2.0x72be5d74f27b896f.0x80deb1fe3b1696b1.0x9bdc06a725c71235.0xc19bf174cf692694.0xe49b69c19ef14ad2.0xefbe4786384f25e3.0x0fc19dc68b8cd5b5.0x240ca1cc77ac9c65.0x2de92c6f592b0275.0x4a7484aa6ea6e483.0x5cb0a9dcbd41fbd4.0x76f988da831153b5.0x983e5152ee66dfab.0xa831c66d2db43210.0xb00327c898fb213f.0xbf597fc7beef0ee4.0xc6e00bf33da88fc2.0xd5a79147930aa725.0x06ca6351e003826f.0x142929670a0e6e70.0x27b70a8546d22ffc.0x2e1b21385c26c926.0x4d2c6dfc5ac42aed.0x53380d139d95b3df.0x650a73548baf63de.0x766a0abb3c77b2a8.0x81c2c92e47edaee6.0x92722c851482353b.0xa2bfe8a14cf10364.0xa81a664bbc423001.0xc24b8b70d0f89791.0xc76c51a30654be30.0xd192e819d6ef5218.0xd69906245565a910.0xf40e35855771202a.0x106aa07032bbd1b8.0x19a4c116b8d2d0c8.0x1e376c085141ab53.0x2748774cdf8eeb99.0x34b0bcb5e19b48a8.0x391c0cb3c5c95a63.0x4ed8aa4ae3418acb.0x5b9cca4f7763e373.0x682e6ff3d6b2b8a3.0x748f82ee5defb2fc.0x78a5636f43172f60.0x84c87814a1f0ab72.0x8cc702081a6439ec.0x90befffa23631e28.0xa4506cebde82bde9.0xbef9a3f7b2c67915.0xc67178f2e372532b.0xca273eceea26619c.0xd186b8c721c0c207.0xeada7dd6cde0eb1e.0xf57d4f7fee6ed178.0x06f067aa72176fba.0x0a637dc5a2c898a6.0x113f9804bef90dae.0x1b710b35131c471b.0x28db77f523047d84.0x32caab7b40c72493.0x3c9ebe0a15c9bebc.0x431d67c49c100d4c.0x4cc5d4becb3e42b6.0x597f299cfc657e2a.0x5fcb6fab3ad6faec.0x6c44198c4a475817`.split(`.`).map(e=>BigInt(e))))(),pe=(()=>fe[0])(),me=(()=>fe[1])(),U=new Uint32Array(80),W=new Uint32Array(80);var he=class extends le{constructor(e=64){super(128,e,16,!1),this.Ah=V[0]|0,this.Al=V[1]|0,this.Bh=V[2]|0,this.Bl=V[3]|0,this.Ch=V[4]|0,this.Cl=V[5]|0,this.Dh=V[6]|0,this.Dl=V[7]|0,this.Eh=V[8]|0,this.El=V[9]|0,this.Fh=V[10]|0,this.Fl=V[11]|0,this.Gh=V[12]|0,this.Gl=V[13]|0,this.Hh=V[14]|0,this.Hl=V[15]|0}get(){let{Ah:e,Al:t,Bh:n,Bl:r,Ch:i,Cl:a,Dh:o,Dl:s,Eh:c,El:l,Fh:u,Fl:d,Gh:f,Gl:p,Hh:m,Hl:h}=this;return[e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h]}set(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=r|0,this.Ch=i|0,this.Cl=a|0,this.Dh=o|0,this.Dl=s|0,this.Eh=c|0,this.El=l|0,this.Fh=u|0,this.Fl=d|0,this.Gh=f|0,this.Gl=p|0,this.Hh=m|0,this.Hl=h|0}process(e,t){for(let n=0;n<16;n++,t+=4)U[n]=e.getUint32(t),W[n]=e.getUint32(t+=4);for(let e=16;e<80;e++){let t=U[e-15]|0,n=W[e-15]|0,r=I(t,n,1)^I(t,n,8)^ne(t,n,7),i=L(t,n,1)^L(t,n,8)^re(t,n,7),a=U[e-2]|0,o=W[e-2]|0,l=I(a,o,19)^P(a,o,61)^ne(a,o,6),u=L(a,o,19)^F(a,o,61)^re(a,o,6),d=c(i,u,W[e-7],W[e-16]);U[e]=s(d,r,l,U[e-7],U[e-16])|0,W[e]=d|0}let{Ah:n,Al:r,Bh:d,Bl:f,Ch:p,Cl:m,Dh:h,Dl:g,Eh:_,El:v,Fh:y,Fl:b,Gh:x,Gl:S,Hh:C,Hl:w}=this;for(let e=0;e<80;e++){let t=I(_,v,14)^I(_,v,18)^P(_,v,41),s=L(_,v,14)^L(_,v,18)^F(_,v,41),c=_&y^~_&x,T=v&b^~v&S,E=u(w,s,T,me[e],W[e]),D=l(E,C,t,c,pe[e],U[e]),O=E|0,ee=I(n,r,28)^P(n,r,34)^P(n,r,39),k=L(n,r,28)^F(n,r,34)^F(n,r,39),A=n&d^n&p^d&p,j=r&f^r&m^f&m;C=x|0,w=S|0,x=y|0,S=b|0,y=_|0,b=v|0,{h:_,l:v}=i(h|0,g|0,D|0,O|0),h=p|0,g=m|0,p=d|0,m=f|0,d=n|0,f=r|0;let M=o(O,k,j);n=a(M,D,ee,A),r=M|0}({h:n,l:r}=i(this.Ah|0,this.Al|0,n|0,r|0)),{h:d,l:f}=i(this.Bh|0,this.Bl|0,d|0,f|0),{h:p,l:m}=i(this.Ch|0,this.Cl|0,p|0,m|0),{h,l:g}=i(this.Dh|0,this.Dl|0,h|0,g|0),{h:_,l:v}=i(this.Eh|0,this.El|0,_|0,v|0),{h:y,l:b}=i(this.Fh|0,this.Fl|0,y|0,b|0),{h:x,l:S}=i(this.Gh|0,this.Gl|0,x|0,S|0),{h:C,l:w}=i(this.Hh|0,this.Hl|0,C|0,w|0),this.set(n,r,d,f,p,m,h,g,_,v,y,b,x,S,C,w)}roundClean(){b(U,W)}destroy(){b(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},ge=class extends he{constructor(){super(48),this.Ah=B[0]|0,this.Al=B[1]|0,this.Bh=B[2]|0,this.Bl=B[3]|0,this.Ch=B[4]|0,this.Cl=B[5]|0,this.Dh=B[6]|0,this.Dl=B[7]|0,this.Eh=B[8]|0,this.El=B[9]|0,this.Fh=B[10]|0,this.Fl=B[11]|0,this.Gh=B[12]|0,this.Gl=B[13]|0,this.Hh=B[14]|0,this.Hl=B[15]|0}};const _e=C(()=>new de),ve=C(()=>new he),ye=C(()=>new ge);var be=class extends e{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,f(e);let n=ae(t);if(this.iHash=e.create(),typeof this.iHash.update!=`function`)throw Error(`Expected instance of class which extends utils.Hash`);this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),b(i)}update(e){return d(this),this.iHash.update(e),this}digestInto(e){d(this),r(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:a,outputLen:o}=this;return e=e,e.finished=r,e.destroyed=i,e.blockLen=a,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const xe=(e,t,n)=>new be(e,t).update(n).digest();xe.create=(e,t)=>new be(e,t);const G=BigInt(0),K=BigInt(1),q=BigInt(2),Se=BigInt(3),Ce=BigInt(4),we=BigInt(5),Te=BigInt(8);function J(e,t){let n=e%t;return n>=G?n:t+n}function Y(e,t,n){let r=e;for(;t-- >G;)r*=r,r%=n;return r}function Ee(e,t){if(e===G)throw Error(`invert: expected non-zero number`);if(t<=G)throw Error(`invert: expected positive modulus, got `+t);let n=J(e,t),r=t,i=G,a=K,o=K,s=G;for(;n!==G;){let e=r/n,t=r%n,c=i-o*e,l=a-s*e;r=n,n=t,i=o,a=s,o=c,s=l}if(r!==K)throw Error(`invert: does not exist`);return J(i,t)}function De(e,t){let n=(e.ORDER+K)/Ce,r=e.pow(t,n);if(!e.eql(e.sqr(r),t))throw Error(`Cannot find square root`);return r}function Oe(e,t){let n=(e.ORDER-we)/Te,r=e.mul(t,q),i=e.pow(r,n),a=e.mul(t,i),o=e.mul(e.mul(a,q),i),s=e.mul(a,e.sub(o,e.ONE));if(!e.eql(e.sqr(s),t))throw Error(`Cannot find square root`);return s}function ke(e){if(e<BigInt(3))throw Error(`sqrt is not defined for small field`);let t=e-K,n=0;for(;t%q===G;)t/=q,n++;let r=q,i=X(e);for(;Fe(i,r)===1;)if(r++>1e3)throw Error(`Cannot find square root: probably non-prime P`);if(n===1)return De;let a=i.pow(r,t),o=(t+K)/q;return function(e,r){if(e.is0(r))return r;if(Fe(e,r)!==1)throw Error(`Cannot find square root`);let i=n,s=e.mul(e.ONE,a),c=e.pow(r,t),l=e.pow(r,o);for(;!e.eql(c,e.ONE);){if(e.is0(c))return e.ZERO;let t=1,n=e.sqr(c);for(;!e.eql(n,e.ONE);)if(t++,n=e.sqr(n),t===i)throw Error(`Cannot find square root`);let r=K<<BigInt(i-t-1),a=e.pow(s,r);i=t,s=e.sqr(a),c=e.mul(c,s),l=e.mul(l,a)}return l}}function Ae(e){return e%Ce===Se?De:e%Te===we?Oe:ke(e)}const je=[`create`,`isValid`,`is0`,`neg`,`inv`,`sqrt`,`sqr`,`eql`,`add`,`sub`,`mul`,`pow`,`div`,`addN`,`subN`,`mulN`,`sqrN`];function Me(e){let t=je.reduce((e,t)=>(e[t]=`function`,e),{ORDER:`bigint`,MASK:`bigint`,BYTES:`isSafeInteger`,BITS:`isSafeInteger`});return R(e,t)}function Ne(e,t,n){if(n<G)throw Error(`invalid exponent, negatives unsupported`);if(n===G)return e.ONE;if(n===K)return t;let r=e.ONE,i=t;for(;n>G;)n&K&&(r=e.mul(r,i)),i=e.sqr(i),n>>=K;return r}function Pe(e,t,n=!1){let r=Array(t.length).fill(n?e.ZERO:void 0),i=t.reduce((t,n,i)=>e.is0(n)?t:(r[i]=t,e.mul(t,n)),e.ONE),a=e.inv(i);return t.reduceRight((t,n,i)=>e.is0(n)?t:(r[i]=e.mul(t,r[i]),e.mul(t,n)),a),r}function Fe(e,t){let n=(e.ORDER-K)/q,r=e.pow(t,n),i=e.eql(r,e.ONE),a=e.eql(r,e.ZERO),o=e.eql(r,e.neg(e.ONE));if(!i&&!a&&!o)throw Error(`invalid Legendre symbol result`);return i?1:a?0:-1}function Ie(e,t){t!==void 0&&p(t);let n=t===void 0?e.toString(2).length:t,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function X(e,t,n=!1,r={}){if(e<=G)throw Error(`invalid field: expected ORDER > 0, got `+e);let{nBitLength:i,nByteLength:a}=Ie(e,t);if(a>2048)throw Error(`invalid field: expected ORDER of <= 2048 bytes`);let o,s=Object.freeze({ORDER:e,isLE:n,BITS:i,BYTES:a,MASK:g(i),ZERO:G,ONE:K,create:t=>J(t,e),isValid:t=>{if(typeof t!=`bigint`)throw Error(`invalid field element: expected bigint, got `+typeof t);return G<=t&&t<e},is0:e=>e===G,isOdd:e=>(e&K)===K,neg:t=>J(-t,e),eql:(e,t)=>e===t,sqr:t=>J(t*t,e),add:(t,n)=>J(t+n,e),sub:(t,n)=>J(t-n,e),mul:(t,n)=>J(t*n,e),pow:(e,t)=>Ne(s,e,t),div:(t,n)=>J(t*Ee(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>Ee(t,e),sqrt:r.sqrt||(t=>(o||(o=Ae(e)),o(s,t))),toBytes:e=>n?j(e,a):A(e,a),fromBytes:e=>{if(e.length!==a)throw Error(`Field.fromBytes: expected `+a+` bytes, got `+e.length);return n?y(e):v(e)},invertBatch:e=>Pe(s,e),cmov:(e,t,n)=>n?t:e});return Object.freeze(s)}function Le(e){if(typeof e!=`bigint`)throw Error(`field order must be bigint`);let t=e.toString(2).length;return Math.ceil(t/8)}function Re(e){let t=Le(e);return t+Math.ceil(t/2)}function ze(e,t,n=!1){let r=e.length,i=Le(t),a=Re(t);if(r<16||r<a||r>1024)throw Error(`expected `+a+`-1024 bytes of input, got `+r);let o=n?y(e):v(e),s=J(o,t-K)+K;return n?j(s,i):A(s,i)}const Be=BigInt(0),Ve=BigInt(1);function He(e,t){let n=t.negate();return e?n:t}function Ue(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw Error(`invalid window size, expected [1..`+t+`], got W=`+e)}function We(e,t){Ue(e,t);let n=Math.ceil(t/e)+1,r=2**(e-1),i=2**e,a=g(e),o=BigInt(e);return{windows:n,windowSize:r,mask:a,maxNumber:i,shiftBy:o}}function Ge(e,t,n){let{windowSize:r,mask:i,maxNumber:a,shiftBy:o}=n,s=Number(e&i),c=e>>o;s>r&&(s-=a,c+=Ve);let l=t*r,u=l+Math.abs(s)-1,d=s===0,f=s<0,p=t%2!=0;return{nextN:c,offset:u,isZero:d,isNeg:f,isNegF:p,offsetF:l}}function Ke(e,t){if(!Array.isArray(e))throw Error(`array expected`);e.forEach((e,n)=>{if(!(e instanceof t))throw Error(`invalid point at index `+n)})}function qe(e,t){if(!Array.isArray(e))throw Error(`array of scalars expected`);e.forEach((e,n)=>{if(!t.isValid(e))throw Error(`invalid scalar at index `+n)})}const Je=new WeakMap,Ye=new WeakMap;function Xe(e){return Ye.get(e)||1}function Ze(e,t){return{constTimeNegate:He,hasPrecomputes(e){return Xe(e)!==1},unsafeLadder(t,n,r=e.ZERO){let i=t;for(;n>Be;)n&Ve&&(r=r.add(i)),i=i.double(),n>>=Ve;return r},precomputeWindow(e,n){let{windows:r,windowSize:i}=We(n,t),a=[],o=e,s=o;for(let e=0;e<r;e++){s=o,a.push(s);for(let e=1;e<i;e++)s=s.add(o),a.push(s);o=s.double()}return a},wNAF(n,r,i){let a=e.ZERO,o=e.BASE,s=We(n,t);for(let e=0;e<s.windows;e++){let{nextN:t,offset:n,isZero:c,isNeg:l,isNegF:u,offsetF:d}=Ge(i,e,s);i=t,c?o=o.add(He(u,r[d])):a=a.add(He(l,r[n]))}return{p:a,f:o}},wNAFUnsafe(n,r,i,a=e.ZERO){let o=We(n,t);for(let e=0;e<o.windows&&i!==Be;e++){let{nextN:t,offset:n,isZero:s,isNeg:c}=Ge(i,e,o);if(i=t,!s){let e=r[n];a=a.add(c?e.negate():e)}}return a},getPrecomputes(e,t,n){let r=Je.get(t);return r||(r=this.precomputeWindow(t,e),e!==1&&Je.set(t,n(r))),r},wNAFCached(e,t,n){let r=Xe(e);return this.wNAF(r,this.getPrecomputes(r,e,n),t)},wNAFCachedUnsafe(e,t,n,r){let i=Xe(e);return i===1?this.unsafeLadder(e,t,r):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),t,r)},setWindowSize(e,n){Ue(n,t),Ye.set(e,n),Je.delete(e)}}}function Qe(e,t,n,r){Ke(n,e),qe(r,t);let i=n.length,a=r.length;if(i!==a)throw Error(`arrays of points and scalars must have equal length`);let o=e.ZERO,s=h(BigInt(i)),c=1;s>12?c=s-3:s>4?c=s-2:s>0&&(c=2);let l=g(c),u=Array(Number(l)+1).fill(o),d=Math.floor((t.BITS-1)/c)*c,f=o;for(let e=d;e>=0;e-=c){u.fill(o);for(let t=0;t<a;t++){let i=r[t],a=Number(i>>BigInt(e)&l);u[a]=u[a].add(n[t])}let t=o;for(let e=u.length-1,n=o;e>0;e--)n=n.add(u[e]),t=t.add(n);if(f=f.add(t),e!==0)for(let e=0;e<c;e++)f=f.double()}return f}function $e(e){return Me(e.Fp),R(e,{n:`bigint`,h:`bigint`,Gx:`field`,Gy:`field`},{nBitLength:`isSafeInteger`,nByteLength:`isSafeInteger`}),Object.freeze({...Ie(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}function et(e){e.lowS!==void 0&&n(`lowS`,e.lowS),e.prehash!==void 0&&n(`prehash`,e.prehash)}function tt(e){let t=$e(e);R(t,{a:`field`,b:`field`},{allowInfinityPoint:`boolean`,allowedPrivateKeyLengths:`array`,clearCofactor:`function`,fromBytes:`function`,isTorsionFree:`function`,toBytes:`function`,wrapPrivateKey:`boolean`});let{endo:n,Fp:r,a:i}=t;if(n){if(!r.eql(i,r.ZERO))throw Error(`invalid endo: CURVE.a must be 0`);if(typeof n!=`object`||typeof n.beta!=`bigint`||typeof n.splitScalar!=`function`)throw Error(`invalid endo: expected "beta": bigint and "splitScalar": function`)}return Object.freeze({...t})}const Z={Err:class extends Error{constructor(e=``){super(e)}},_tlv:{encode:(e,t)=>{let{Err:n}=Z;if(e<0||e>256)throw new n(`tlv.encode: wrong tag`);if(t.length&1)throw new n(`tlv.encode: unpadded data`);let r=t.length/2,i=M(r);if(i.length/2&128)throw new n(`tlv.encode: long form length too big`);let a=r>127?M(i.length/2|128):``;return M(e)+a+i+t},decode(e,t){let{Err:n}=Z,r=0;if(e<0||e>256)throw new n(`tlv.encode: wrong tag`);if(t.length<2||t[r++]!==e)throw new n(`tlv.decode: wrong tlv`);let i=t[r++],a=!!(i&128),o=0;if(!a)o=i;else{let e=i&127;if(!e)throw new n(`tlv.decode(long): indefinite length not supported`);if(e>4)throw new n(`tlv.decode(long): byte length is too big`);let a=t.subarray(r,r+e);if(a.length!==e)throw new n(`tlv.decode: length bytes not complete`);if(a[0]===0)throw new n(`tlv.decode(long): zero leftmost byte`);for(let e of a)o=o<<8|e;if(r+=e,o<128)throw new n(`tlv.decode(long): not minimal encoding`)}let s=t.subarray(r,r+o);if(s.length!==o)throw new n(`tlv.decode: wrong value length`);return{v:s,l:t.subarray(r+o)}}},_int:{encode(e){let{Err:t}=Z;if(e<Q)throw new t(`integer: negative integers are not allowed`);let n=M(e);if(Number.parseInt(n[0],16)&8&&(n=`00`+n),n.length&1)throw new t(`unexpected DER parsing assertion: unpadded hex`);return n},decode(e){let{Err:t}=Z;if(e[0]&128)throw new t(`invalid signature integer: negative`);if(e[0]===0&&!(e[1]&128))throw new t(`invalid signature integer: unnecessary leading zero`);return v(e)}},toSig(e){let{Err:t,_int:n,_tlv:r}=Z,i=E(`signature`,e),{v:a,l:o}=r.decode(48,i);if(o.length)throw new t(`invalid signature: left bytes after parsing`);let{v:s,l:c}=r.decode(2,a),{v:l,l:u}=r.decode(2,c);if(u.length)throw new t(`invalid signature: left bytes after parsing`);return{r:n.decode(s),s:n.decode(l)}},hexFromSig(e){let{_tlv:t,_int:n}=Z,r=t.encode(2,n.encode(e.r)),i=t.encode(2,n.encode(e.s)),a=r+i;return t.encode(48,a)}};function nt(e,t){return _(A(e,t))}const Q=BigInt(0),$=BigInt(1);BigInt(2);const rt=BigInt(3),it=BigInt(4);function at(e){let r=tt(e),{Fp:i}=r,a=X(r.n,r.nBitLength),o=r.toBytes||((e,t,n)=>{let r=t.toAffine();return x(Uint8Array.from([4]),i.toBytes(r.x),i.toBytes(r.y))}),s=r.fromBytes||(e=>{let t=e.subarray(1),n=i.fromBytes(t.subarray(0,i.BYTES)),r=i.fromBytes(t.subarray(i.BYTES,2*i.BYTES));return{x:n,y:r}});function c(e){let{a:t,b:n}=r,a=i.sqr(e),o=i.mul(a,e);return i.add(i.add(o,i.mul(e,t)),n)}function l(e,t){let n=i.sqr(t),r=c(e);return i.eql(n,r)}if(!l(r.Gx,r.Gy))throw Error(`bad curve params: generator point`);let u=i.mul(i.pow(r.a,rt),it),d=i.mul(i.sqr(r.b),BigInt(27));if(i.is0(i.add(u,d)))throw Error(`bad curve params: a or b`);function f(e){return O(e,$,r.n)}function p(e){let{allowedPrivateKeyLengths:n,nByteLength:i,wrapPrivateKey:a,n:o}=r;if(n&&typeof e!=`bigint`){if(ee(e)&&(e=_(e)),typeof e!=`string`||!n.includes(e.length))throw Error(`invalid private key`);e=e.padStart(i*2,`0`)}let s;try{s=typeof e==`bigint`?e:v(E(`private key`,e,i))}catch(t){throw Error(`invalid private key, expected hex or `+i+` bytes, got `+typeof e)}return a&&(s=J(s,o)),t(`private key`,s,$,o),s}function m(e){if(!(e instanceof y))throw Error(`ProjectivePoint expected`)}let h=k((e,t)=>{let{px:n,py:r,pz:a}=e;if(i.eql(a,i.ONE))return{x:n,y:r};let o=e.is0();t==null&&(t=o?i.ONE:i.inv(a));let s=i.mul(n,t),c=i.mul(r,t),l=i.mul(a,t);if(o)return{x:i.ZERO,y:i.ZERO};if(!i.eql(l,i.ONE))throw Error(`invZ was invalid`);return{x:s,y:c}}),g=k(e=>{if(e.is0()){if(r.allowInfinityPoint&&!i.is0(e.py))return;throw Error(`bad point: ZERO`)}let{x:t,y:n}=e.toAffine();if(!i.isValid(t)||!i.isValid(n))throw Error(`bad point: x or y not FE`);if(!l(t,n))throw Error(`bad point: equation left != right`);if(!e.isTorsionFree())throw Error(`bad point: not in prime-order subgroup`);return!0});class y{constructor(e,t,n){if(e==null||!i.isValid(e))throw Error(`x required`);if(t==null||!i.isValid(t)||i.is0(t))throw Error(`y required`);if(n==null||!i.isValid(n))throw Error(`z required`);this.px=e,this.py=t,this.pz=n,Object.freeze(this)}static fromAffine(e){let{x:t,y:n}=e||{};if(!e||!i.isValid(t)||!i.isValid(n))throw Error(`invalid affine point`);if(e instanceof y)throw Error(`projective point not allowed`);let r=e=>i.eql(e,i.ZERO);return r(t)&&r(n)?y.ZERO:new y(t,n,i.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){let t=Pe(i,e.map(e=>e.pz));return e.map((e,n)=>e.toAffine(t[n])).map(y.fromAffine)}static fromHex(e){let t=y.fromAffine(s(E(`pointHex`,e)));return t.assertValidity(),t}static fromPrivateKey(e){return y.BASE.multiply(p(e))}static msm(e,t){return Qe(y,a,e,t)}_setWindowSize(e){C.setWindowSize(this,e)}assertValidity(){g(this)}hasEvenY(){let{y:e}=this.toAffine();if(i.isOdd)return!i.isOdd(e);throw Error(`Field doesn't support isOdd`)}equals(e){m(e);let{px:t,py:n,pz:r}=this,{px:a,py:o,pz:s}=e,c=i.eql(i.mul(t,s),i.mul(a,r)),l=i.eql(i.mul(n,s),i.mul(o,r));return c&&l}negate(){return new y(this.px,i.neg(this.py),this.pz)}double(){let{a:e,b:t}=r,n=i.mul(t,rt),{px:a,py:o,pz:s}=this,c=i.ZERO,l=i.ZERO,u=i.ZERO,d=i.mul(a,a),f=i.mul(o,o),p=i.mul(s,s),m=i.mul(a,o);return m=i.add(m,m),u=i.mul(a,s),u=i.add(u,u),c=i.mul(e,u),l=i.mul(n,p),l=i.add(c,l),c=i.sub(f,l),l=i.add(f,l),l=i.mul(c,l),c=i.mul(m,c),u=i.mul(n,u),p=i.mul(e,p),m=i.sub(d,p),m=i.mul(e,m),m=i.add(m,u),u=i.add(d,d),d=i.add(u,d),d=i.add(d,p),d=i.mul(d,m),l=i.add(l,d),p=i.mul(o,s),p=i.add(p,p),d=i.mul(p,m),c=i.sub(c,d),u=i.mul(p,f),u=i.add(u,u),u=i.add(u,u),new y(c,l,u)}add(e){m(e);let{px:t,py:n,pz:a}=this,{px:o,py:s,pz:c}=e,l=i.ZERO,u=i.ZERO,d=i.ZERO,f=r.a,p=i.mul(r.b,rt),h=i.mul(t,o),g=i.mul(n,s),_=i.mul(a,c),v=i.add(t,n),b=i.add(o,s);v=i.mul(v,b),b=i.add(h,g),v=i.sub(v,b),b=i.add(t,a);let x=i.add(o,c);return b=i.mul(b,x),x=i.add(h,_),b=i.sub(b,x),x=i.add(n,a),l=i.add(s,c),x=i.mul(x,l),l=i.add(g,_),x=i.sub(x,l),d=i.mul(f,b),l=i.mul(p,_),d=i.add(l,d),l=i.sub(g,d),d=i.add(g,d),u=i.mul(l,d),g=i.add(h,h),g=i.add(g,h),_=i.mul(f,_),b=i.mul(p,b),g=i.add(g,_),_=i.sub(h,_),_=i.mul(f,_),b=i.add(b,_),h=i.mul(g,b),u=i.add(u,h),h=i.mul(x,b),l=i.mul(v,l),l=i.sub(l,h),h=i.mul(v,g),d=i.mul(x,d),d=i.add(d,h),new y(l,u,d)}subtract(e){return this.add(e.negate())}is0(){return this.equals(y.ZERO)}wNAF(e){return C.wNAFCached(this,e,y.normalizeZ)}multiplyUnsafe(e){let{endo:n,n:a}=r;t(`scalar`,e,Q,a);let o=y.ZERO;if(e===Q)return o;if(this.is0()||e===$)return this;if(!n||C.hasPrecomputes(this))return C.wNAFCachedUnsafe(this,e,y.normalizeZ);let{k1neg:s,k1:c,k2neg:l,k2:u}=n.splitScalar(e),d=o,f=o,p=this;for(;c>Q||u>Q;)c&$&&(d=d.add(p)),u&$&&(f=f.add(p)),p=p.double(),c>>=$,u>>=$;return s&&(d=d.negate()),l&&(f=f.negate()),f=new y(i.mul(f.px,n.beta),f.py,f.pz),d.add(f)}multiply(e){let{endo:n,n:a}=r;t(`scalar`,e,$,a);let o,s;if(n){let{k1neg:t,k1:r,k2neg:a,k2:c}=n.splitScalar(e),{p:l,f:u}=this.wNAF(r),{p:d,f}=this.wNAF(c);l=C.constTimeNegate(t,l),d=C.constTimeNegate(a,d),d=new y(i.mul(d.px,n.beta),d.py,d.pz),o=l.add(d),s=u.add(f)}else{let{p:t,f:n}=this.wNAF(e);o=t,s=n}return y.normalizeZ([o,s])[0]}multiplyAndAddUnsafe(e,t,n){let r=y.BASE,i=(e,t)=>t===Q||t===$||!e.equals(r)?e.multiplyUnsafe(t):e.multiply(t),a=i(this,t).add(i(e,n));return a.is0()?void 0:a}toAffine(e){return h(this,e)}isTorsionFree(){let{h:e,isTorsionFree:t}=r;if(e===$)return!0;if(t)return t(y,this);throw Error(`isTorsionFree() has not been declared for the elliptic curve`)}clearCofactor(){let{h:e,clearCofactor:t}=r;return e===$?this:t?t(y,this):this.multiplyUnsafe(r.h)}toRawBytes(e=!0){return n(`isCompressed`,e),this.assertValidity(),o(y,this,e)}toHex(e=!0){return n(`isCompressed`,e),_(this.toRawBytes(e))}}y.BASE=new y(r.Gx,r.Gy,i.ONE),y.ZERO=new y(i.ZERO,i.ONE,i.ZERO);let{endo:b,nBitLength:S}=r,C=Ze(y,b?Math.ceil(S/2):S);return{CURVE:r,ProjectivePoint:y,normPrivateKeyToScalar:p,weierstrassEquation:c,isWithinCurveOrder:f}}function ot(e){let t=$e(e);return R(t,{hash:`hash`,hmac:`function`,randomBytes:`function`},{bits2int:`function`,bits2int_modN:`function`,lowS:`boolean`}),Object.freeze({lowS:!0,...t})}function st(e){let r=ot(e),{Fp:i,n:a,nByteLength:o,nBitLength:s}=r,c=i.BYTES+1,l=2*i.BYTES+1;function u(e){return J(e,a)}function d(e){return Ee(e,a)}let{ProjectivePoint:f,normPrivateKeyToScalar:p,weierstrassEquation:m,isWithinCurveOrder:h}=at({...r,toBytes(e,t,r){let a=t.toAffine(),o=i.toBytes(a.x),s=x;return n(`isCompressed`,r),r?s(Uint8Array.from([t.hasEvenY()?2:3]),o):s(Uint8Array.from([4]),o,i.toBytes(a.y))},fromBytes(e){let t=e.length,n=e[0],r=e.subarray(1);if(t===c&&(n===2||n===3)){let e=v(r);if(!O(e,$,i.ORDER))throw Error(`Point is not on curve`);let t=m(e),a;try{a=i.sqrt(t)}catch(e){let t=e instanceof Error?`: `+e.message:``;throw Error(`Point is not on curve`+t)}let o=(a&$)===$;return(n&1)==1!==o&&(a=i.neg(a)),{x:e,y:a}}else if(t===l&&n===4){let e=i.fromBytes(r.subarray(0,i.BYTES)),t=i.fromBytes(r.subarray(i.BYTES,2*i.BYTES));return{x:e,y:t}}else{let e=c,n=l;throw Error(`invalid Point, expected length of `+e+`, or uncompressed `+n+`, got `+t)}}});function _(e){let t=a>>$;return e>t}function y(e){return _(e)?u(-e):e}let b=(e,t,n)=>v(e.slice(t,n));class S{constructor(e,n,r){t(`r`,e,$,a),t(`s`,n,$,a),this.r=e,this.s=n,r!=null&&(this.recovery=r),Object.freeze(this)}static fromCompact(e){let t=o;return e=E(`compactSignature`,e,t*2),new S(b(e,0,t),b(e,t,2*t))}static fromDER(e){let{r:t,s:n}=Z.toSig(E(`DER`,e));return new S(t,n)}assertValidity(){}addRecoveryBit(e){return new S(this.r,this.s,e)}recoverPublicKey(e){let{r:t,s:n,recovery:a}=this,o=te(E(`msgHash`,e));if(a==null||![0,1,2,3].includes(a))throw Error(`recovery id invalid`);let s=a===2||a===3?t+r.n:t;if(s>=i.ORDER)throw Error(`recovery id 2 or 3 invalid`);let c=a&1?`03`:`02`,l=f.fromHex(c+nt(s,i.BYTES)),p=d(s),m=u(-o*p),h=u(n*p),g=f.BASE.multiplyAndAddUnsafe(l,m,h);if(!g)throw Error(`point at infinify`);return g.assertValidity(),g}hasHighS(){return _(this.s)}normalizeS(){return this.hasHighS()?new S(this.r,u(-this.s),this.recovery):this}toDERRawBytes(){return D(this.toDERHex())}toDERHex(){return Z.hexFromSig(this)}toCompactRawBytes(){return D(this.toCompactHex())}toCompactHex(){let e=o;return nt(this.r,e)+nt(this.s,e)}}let C={isValidPrivateKey(e){try{return p(e),!0}catch(e){return!1}},normPrivateKeyToScalar:p,randomPrivateKey:()=>{let e=Re(r.n);return ze(r.randomBytes(e),r.n)},precompute(e=8,t=f.BASE){return t._setWindowSize(e),t.multiply(BigInt(3)),t}};function T(e,t=!0){return f.fromPrivateKey(e).toRawBytes(t)}function k(e){if(typeof e==`bigint`)return!1;if(e instanceof f)return!0;let t=E(`key`,e).length,n=i.BYTES,a=n+1,s=2*n+1;if(!(r.allowedPrivateKeyLengths||o===a))return t===a||t===s}function j(e,t,n=!0){if(k(e)===!0)throw Error(`first arg must be private key`);if(k(t)===!1)throw Error(`second arg must be public key`);return f.fromHex(t).multiply(p(e)).toRawBytes(n)}let M=r.bits2int||function(e){if(e.length>8192)throw Error(`input is too large`);let t=v(e),n=e.length*8-s;return n>0?t>>BigInt(n):t},te=r.bits2int_modN||function(e){return u(M(e))},N=g(s);function P(e){return t(`num < 2^`+s,e,Q,N),A(e,o)}function F(e,t,n=I){if([`recovered`,`canonical`].some(e=>e in n))throw Error(`sign() legacy options not supported`);let{hash:a,randomBytes:o}=r,{lowS:s,prehash:c,extraEntropy:l}=n;s==null&&(s=!0),e=E(`msgHash`,e),et(n),c&&(e=E(`prehashed msgHash`,a(e)));let m=te(e),g=p(t),v=[P(g),P(m)];if(l!=null&&l!==!1){let e=l===!0?o(i.BYTES):l;v.push(E(`extraEntropy`,e))}let b=x(...v),C=m;function w(e){let t=M(e);if(!h(t))return;let n=d(t),r=f.BASE.multiply(t).toAffine(),i=u(r.x);if(i===Q)return;let a=u(n*u(C+i*g));if(a===Q)return;let o=(r.x===i?0:2)|Number(r.y&$),c=a;return s&&_(a)&&(c=y(a),o^=1),new S(i,c,o)}return{seed:b,k2sig:w}}let I={lowS:r.lowS,prehash:!1},L={lowS:r.lowS,prehash:!1};function ne(e,t,n=I){let{seed:i,k2sig:a}=F(e,t,n),o=r;return w(o.hash.outputLen,o.nByteLength,o.hmac)(i,a)}f.BASE._setWindowSize(8);function re(e,t,n,i=L){let a=e;t=E(`msgHash`,t),n=E(`publicKey`,n);let{lowS:o,prehash:s,format:c}=i;if(et(i),`strict`in i)throw Error(`options.strict was renamed to lowS`);if(c!==void 0&&c!==`compact`&&c!==`der`)throw Error(`format must be compact or der`);let l=typeof a==`string`||ee(a),p=!l&&!c&&typeof a==`object`&&!!a&&typeof a.r==`bigint`&&typeof a.s==`bigint`;if(!l&&!p)throw Error(`invalid signature, expected Uint8Array, hex string or Signature instance`);let m,h;try{if(p&&(m=new S(a.r,a.s)),l){try{c!==`compact`&&(m=S.fromDER(a))}catch(e){if(!(e instanceof Z.Err))throw e}!m&&c!==`der`&&(m=S.fromCompact(a))}h=f.fromHex(n)}catch(e){return!1}if(!m||o&&m.hasHighS())return!1;s&&(t=r.hash(t));let{r:g,s:_}=m,v=te(t),y=d(_),b=u(v*y),x=u(g*y),C=f.BASE.multiplyAndAddUnsafe(h,b,x)?.toAffine();return C?u(C.x)===g:!1}return{CURVE:r,getPublicKey:T,getSharedSecret:j,sign:ne,verify:re,ProjectivePoint:f,Signature:S,utils:C}}function ct(e){return{hash:e,hmac:(t,...n)=>xe(e,t,S(...n)),randomBytes:te}}function lt(e,t){let n=t=>st({...e,...ct(t)});return{...n(t),create:n}}const ut=BigInt(`0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f`),dt=BigInt(`0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141`),ft=BigInt(0),pt=BigInt(1),mt=BigInt(2),ht=(e,t)=>(e+t/mt)/t;function gt(e){let t=ut,n=BigInt(3),r=BigInt(6),i=BigInt(11),a=BigInt(22),o=BigInt(23),s=BigInt(44),c=BigInt(88),l=e*e*e%t,u=l*l*e%t,d=Y(u,n,t)*u%t,f=Y(d,n,t)*u%t,p=Y(f,mt,t)*l%t,m=Y(p,i,t)*p%t,h=Y(m,a,t)*m%t,g=Y(h,s,t)*h%t,_=Y(g,c,t)*g%t,v=Y(_,s,t)*h%t,y=Y(v,n,t)*u%t,b=Y(y,o,t)*m%t,x=Y(b,r,t)*l%t,S=Y(x,mt,t);if(!_t.eql(_t.sqr(S),e))throw Error(`Cannot find square root`);return S}const _t=X(ut,void 0,void 0,{sqrt:gt}),vt=lt({a:ft,b:BigInt(7),Fp:_t,n:dt,Gx:BigInt(`55066263022277343669578718895168534326250603453777594175500187360389116729240`),Gy:BigInt(`32670510020758816978083085130507043184471273380659243275938904335757337482424`),h:BigInt(1),lowS:!0,endo:{beta:BigInt(`0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee`),splitScalar:e=>{let t=dt,n=BigInt(`0x3086d221a7d46bcde86c90e49284eb15`),r=-pt*BigInt(`0xe4437ed6010e88286f547fa90abfe4c3`),i=BigInt(`0x114ca50f7a8e2f3f657c1108d9d44cfd8`),a=n,o=BigInt(`0x100000000000000000000000000000000`),s=ht(a*e,t),c=ht(-r*e,t),l=J(e-s*n-c*i,t),u=J(-s*r-c*a,t),d=l>o,f=u>o;if(d&&(l=t-l),f&&(u=t-u),l>o||u>o)throw Error(`splitScalar: Endomorphism failed, k=`+e);return{k1neg:d,k1:l,k2neg:f,k2:u}}}},_e);export{X as Field,lt as createCurve,vt as secp256k1,_e as sha256,ye as sha384,ve as sha512};