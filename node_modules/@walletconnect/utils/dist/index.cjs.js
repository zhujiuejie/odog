"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var To=require("detect-browser"),Te=require("@walletconnect/time"),ae=require("@walletconnect/window-getters"),Uo=require("@walletconnect/window-metadata"),_o=require("viem"),Co=require("bs58"),Lo=require("@walletconnect/relay-auth"),D=require("uint8arrays"),Po=require("@walletconnect/relay-api");function $o(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var jo=$o(Co);const ct=":";function Ot(e){const[t,n]=e.split(ct);return{namespace:t,reference:n}}function En(e){const{namespace:t,reference:n}=e;return[t,n].join(ct)}function It(e){const[t,n,r]=e.split(ct);return{namespace:t,reference:n,address:r}}function vn(e){const{namespace:t,reference:n,address:r}=e;return[t,n,r].join(ct)}function Bt(e,t){const n=[];return e.forEach(r=>{const o=t(r);n.includes(o)||n.push(o)}),n}function xn(e){const{address:t}=It(e);return t}function Sn(e){const{namespace:t,reference:n}=It(e);return En({namespace:t,reference:n})}function ko(e,t){const{namespace:n,reference:r}=Ot(t);return vn({namespace:n,reference:r,address:e})}function Vo(e){return Bt(e,xn)}function An(e){return Bt(e,Sn)}function Do(e,t=[]){const n=[];return Object.keys(e).forEach(r=>{if(t.length&&!t.includes(r))return;const o=e[r];n.push(...o.accounts)}),n}function Mo(e,t=[]){const n=[];return Object.keys(e).forEach(r=>{if(t.length&&!t.includes(r))return;const o=e[r];n.push(...An(o.accounts))}),n}function qo(e,t=[]){const n=[];return Object.keys(e).forEach(r=>{if(t.length&&!t.includes(r))return;const o=e[r];n.push(...at(r,o))}),n}function at(e,t){return e.includes(":")?[e]:t.chains||[]}var Ho=Object.defineProperty,Fo=Object.defineProperties,Ko=Object.getOwnPropertyDescriptors,Nn=Object.getOwnPropertySymbols,zo=Object.prototype.hasOwnProperty,Zo=Object.prototype.propertyIsEnumerable,On=(e,t,n)=>t in e?Ho(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,In=(e,t)=>{for(var n in t||(t={}))zo.call(t,n)&&On(e,n,t[n]);if(Nn)for(var n of Nn(t))Zo.call(t,n)&&On(e,n,t[n]);return e},Yo=(e,t)=>Fo(e,Ko(t));const Bn="ReactNative",G={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},ut=" ",Go=":",Rn="/",Rt=2,Wo=1e3,Tn="js";function Tt(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function pe(){return!ae.getDocument()&&!!ae.getNavigator()&&navigator.product===Bn}function Jo(){return pe()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function Xo(){return pe()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Ue(){return!Tt()&&!!ae.getNavigator()&&!!ae.getDocument()}function xe(){return pe()?G.reactNative:Tt()?G.node:Ue()?G.browser:G.unknown}function Qo(){var e;try{return pe()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(e=global.Application)==null?void 0:e.applicationId:void 0}catch{return}}function Un(e,t){const n=new URLSearchParams(e);for(const r of Object.keys(t).sort())if(t.hasOwnProperty(r)){const o=t[r];o!==void 0&&n.set(r,o)}return n.toString()}function ei(e){var t,n;const r=_n();try{return e!=null&&e.url&&r.url&&new URL(e.url).host!==new URL(r.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${e.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),e.url=r.url),(t=e?.icons)!=null&&t.length&&e.icons.length>0&&(e.icons=e.icons.filter(o=>o!=="")),Yo(In(In({},r),e),{url:e?.url||r.url,name:e?.name||r.name,description:e?.description||r.description,icons:(n=e?.icons)!=null&&n.length&&e.icons.length>0?e.icons:r.icons})}catch(o){return console.warn("Error populating app metadata",o),e||r}}function _n(){return Uo.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function ti(e,t){var n;const r=xe(),o={protocol:e,version:t,env:r};return r==="browser"&&(o.host=((n=ae.getLocation())==null?void 0:n.host)||"unknown"),o}function Cn(){if(xe()===G.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:n,Version:r}=global.Platform;return[n,r].join("-")}const e=To.detect();if(e===null)return"unknown";const t=e.os?e.os.replace(" ","").toLowerCase():"unknown";return e.type==="browser"?[t,e.name,e.version].join("-"):[t,e.version].join("-")}function Ln(){var e;const t=xe();return t===G.browser?[t,((e=ae.getLocation())==null?void 0:e.host)||"unknown"].join(":"):t}function Pn(e,t,n){const r=Cn(),o=Ln();return[[e,t].join("-"),[Tn,n].join("-"),r,o].join("/")}function ni({protocol:e,version:t,relayUrl:n,sdkVersion:r,auth:o,projectId:i,useOnCloseEvent:s,bundleId:c,packageName:a}){const u=n.split("?"),l=Pn(e,t,r),f={auth:o,ua:l,projectId:i,useOnCloseEvent:s||void 0,packageName:a||void 0,bundleId:c||void 0},h=Un(u[1]||"",f);return u[0]+"?"+h}function ri(e){let t=(e.match(/^[^:]+(?=:\/\/)/gi)||[])[0];const n=typeof t<"u"?e.split("://")[1]:e;return t=t==="wss"?"https":"http",[t,n].join("://")}function oi(e,t,n){if(!e[t]||typeof e[t]!==n)throw new Error(`Missing or invalid "${t}" param`)}function $n(e,t=Rt){return jn(e.split(Rn),t)}function ii(e){return $n(e).join(ut)}function ge(e,t){return e.filter(n=>t.includes(n)).length===e.length}function jn(e,t=Rt){return e.slice(Math.max(e.length-t,0))}function si(e){return Object.fromEntries(e.entries())}function ci(e){return new Map(Object.entries(e))}function ai(e,t){const n={};return Object.keys(e).forEach(r=>{n[r]=t(e[r])}),n}const ui=e=>e;function kn(e){return e.trim().replace(/^\w/,t=>t.toUpperCase())}function fi(e){return e.split(ut).map(t=>kn(t)).join(ut)}function li(e=Te.FIVE_MINUTES,t){const n=Te.toMiliseconds(e||Te.FIVE_MINUTES);let r,o,i,s;return{resolve:c=>{i&&r&&(clearTimeout(i),r(c),s=Promise.resolve(c))},reject:c=>{i&&o&&(clearTimeout(i),o(c))},done:()=>new Promise((c,a)=>{if(s)return c(s);i=setTimeout(()=>{const u=new Error(t);s=Promise.reject(u),a(u)},n),r=c,o=a})}}function di(e,t,n){return new Promise(async(r,o)=>{const i=setTimeout(()=>o(new Error(n)),t);try{const s=await e;r(s)}catch(s){o(s)}clearTimeout(i)})}function Ut(e,t){if(typeof t=="string"&&t.startsWith(`${e}:`))return t;if(e.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(e.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${e}`)}function hi(e){return Ut("topic",e)}function pi(e){return Ut("id",e)}function gi(e){const[t,n]=e.split(":"),r={id:void 0,topic:void 0};if(t==="topic"&&typeof n=="string")r.topic=n;else if(t==="id"&&Number.isInteger(Number(n)))r.id=Number(n);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${n}`);return r}function mi(e,t){return Te.fromMiliseconds((t||Date.now())+Te.toMiliseconds(e))}function yi(e){return Date.now()>=Te.toMiliseconds(e)}function wi(e,t){return`${e}${t?`:${t}`:""}`}function re(e=[],t=[]){return[...new Set([...e,...t])]}async function bi({id:e,topic:t,wcDeepLink:n}){var r;try{if(!n)return;const o=typeof n=="string"?JSON.parse(n):n,i=o?.href;if(typeof i!="string")return;const s=Vn(i,e,t),c=xe();if(c===G.browser){if(!((r=ae.getDocument())!=null&&r.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}Dn(s)}else c===G.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(s)}catch(o){console.error(o)}}function Vn(e,t,n){const r=`requestId=${t}&sessionTopic=${n}`;e.endsWith("/")&&(e=e.slice(0,-1));let o=`${e}`;if(e.startsWith("https://t.me")){const i=e.includes("?")?"&startapp=":"?startapp=";o=`${o}${i}${Hn(r,!0)}`}else o=`${o}/wc?${r}`;return o}function Dn(e){let t="_self";qn()?t="_top":(Mn()||e.startsWith("https://")||e.startsWith("http://"))&&(t="_blank"),window.open(e,t,"noreferrer noopener")}async function Ei(e,t){let n="";try{if(Ue()&&(n=localStorage.getItem(t),n))return n;n=await e.getItem(t)}catch(r){console.error(r)}return n}function _t(e,t){return e.filter(n=>t.includes(n))}function vi(e,t){if(!e.includes(t))return null;const n=e.split(/([&,?,=])/),r=n.indexOf(t);return n[r+2]}function xi(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function Si(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function Mn(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function qn(){try{return window.self!==window.top}catch{return!1}}function Hn(e,t=!1){const n=Buffer.from(e).toString("base64");return t?n.replace(/[=]/g,""):n}function Ct(e){return Buffer.from(e,"base64").toString("utf-8")}function Ai(e){return new Promise(t=>setTimeout(t,e))}function Ge(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function Ni(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function We(e,...t){if(!Ni(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Lt(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ge(e.outputLen),Ge(e.blockLen)}function _e(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Fn(e,t){We(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}const ft=BigInt(2**32-1),Kn=BigInt(32);function Oi(e,t=!1){return t?{h:Number(e&ft),l:Number(e>>Kn&ft)}:{h:Number(e>>Kn&ft)|0,l:Number(e&ft)|0}}function Ii(e,t=!1){let n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let o=0;o<e.length;o++){const{h:i,l:s}=Oi(e[o],t);[n[o],r[o]]=[i,s]}return[n,r]}const Bi=(e,t,n)=>e<<n|t>>>32-n,Ri=(e,t,n)=>t<<n|e>>>32-n,Ti=(e,t,n)=>t<<n-32|e>>>64-n,Ui=(e,t,n)=>e<<n-32|t>>>64-n,Ce=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function _i(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function Pt(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function se(e,t){return e<<32-t|e>>>t}const zn=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Ci(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function Zn(e){for(let t=0;t<e.length;t++)e[t]=Ci(e[t])}function Li(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))}function Le(e){return typeof e=="string"&&(e=Li(e)),We(e),e}function Pi(...e){let t=0;for(let r=0;r<e.length;r++){const o=e[r];We(o),t+=o.length}const n=new Uint8Array(t);for(let r=0,o=0;r<e.length;r++){const i=e[r];n.set(i,o),o+=i.length}return n}class $t{clone(){return this._cloneInto()}}function Yn(e){const t=r=>e().update(Le(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Pe(e=32){if(Ce&&typeof Ce.getRandomValues=="function")return Ce.getRandomValues(new Uint8Array(e));if(Ce&&typeof Ce.randomBytes=="function")return Ce.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}const Gn=[],Wn=[],Jn=[],$i=BigInt(0),Je=BigInt(1),ji=BigInt(2),ki=BigInt(7),Vi=BigInt(256),Di=BigInt(113);for(let e=0,t=Je,n=1,r=0;e<24;e++){[n,r]=[r,(2*n+3*r)%5],Gn.push(2*(5*r+n)),Wn.push((e+1)*(e+2)/2%64);let o=$i;for(let i=0;i<7;i++)t=(t<<Je^(t>>ki)*Di)%Vi,t&ji&&(o^=Je<<(Je<<BigInt(i))-Je);Jn.push(o)}const[Mi,qi]=Ii(Jn,!0),Xn=(e,t,n)=>n>32?Ti(e,t,n):Bi(e,t,n),Qn=(e,t,n)=>n>32?Ui(e,t,n):Ri(e,t,n);function Hi(e,t=24){const n=new Uint32Array(10);for(let r=24-t;r<24;r++){for(let s=0;s<10;s++)n[s]=e[s]^e[s+10]^e[s+20]^e[s+30]^e[s+40];for(let s=0;s<10;s+=2){const c=(s+8)%10,a=(s+2)%10,u=n[a],l=n[a+1],f=Xn(u,l,1)^n[c],h=Qn(u,l,1)^n[c+1];for(let m=0;m<50;m+=10)e[s+m]^=f,e[s+m+1]^=h}let o=e[2],i=e[3];for(let s=0;s<24;s++){const c=Wn[s],a=Xn(o,i,c),u=Qn(o,i,c),l=Gn[s];o=e[l],i=e[l+1],e[l]=a,e[l+1]=u}for(let s=0;s<50;s+=10){for(let c=0;c<10;c++)n[c]=e[s+c];for(let c=0;c<10;c++)e[s+c]^=~n[(c+2)%10]&n[(c+4)%10]}e[0]^=Mi[r],e[1]^=qi[r]}n.fill(0)}class wn extends $t{constructor(t,n,r,o=!1,i=24){if(super(),this.blockLen=t,this.suffix=n,this.outputLen=r,this.enableXOF=o,this.rounds=i,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Ge(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=_i(this.state)}keccak(){zn||Zn(this.state32),Hi(this.state32,this.rounds),zn||Zn(this.state32),this.posOut=0,this.pos=0}update(t){_e(this);const{blockLen:n,state:r}=this;t=Le(t);const o=t.length;for(let i=0;i<o;){const s=Math.min(n-this.pos,o-i);for(let c=0;c<s;c++)r[this.pos++]^=t[i++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:n,pos:r,blockLen:o}=this;t[r]^=n,(n&128)!==0&&r===o-1&&this.keccak(),t[o-1]^=128,this.keccak()}writeInto(t){_e(this,!1),We(t),this.finish();const n=this.state,{blockLen:r}=this;for(let o=0,i=t.length;o<i;){this.posOut>=r&&this.keccak();const s=Math.min(r-this.posOut,i-o);t.set(n.subarray(this.posOut,this.posOut+s),o),this.posOut+=s,o+=s}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return Ge(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(Fn(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(t){const{blockLen:n,suffix:r,outputLen:o,rounds:i,enableXOF:s}=this;return t||(t=new wn(n,r,o,s,i)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=i,t.suffix=r,t.outputLen=o,t.enableXOF=s,t.destroyed=this.destroyed,t}}const Fi=(e,t,n)=>Yn(()=>new wn(t,e,n)),Ki=Fi(1,136,256/8),zi="https://rpc.walletconnect.org/v1";function jt(e){const t=`Ethereum Signed Message:
${e.length}`,n=new TextEncoder().encode(t+e);return"0x"+Buffer.from(Ki(n)).toString("hex")}async function er(e,t,n,r,o,i){switch(n.t){case"eip191":return await tr(e,t,n.s);case"eip1271":return await nr(e,t,n.s,r,o,i);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${n.t}`)}}async function tr(e,t,n){return(await _o.recoverAddress({hash:jt(t),signature:n})).toLowerCase()===e.toLowerCase()}async function nr(e,t,n,r,o,i){const s=Ot(r);if(!s.namespace||!s.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{const c="0x1626ba7e",a="0000000000000000000000000000000000000000000000000000000000000040",u="0000000000000000000000000000000000000000000000000000000000000041",l=n.substring(2),f=jt(t).substring(2),h=c+f+a+u+l,m=await fetch(`${i||zi}/?chainId=${r}&projectId=${o}`,{method:"POST",body:JSON.stringify({id:Zi(),jsonrpc:"2.0",method:"eth_call",params:[{to:e,data:h},"latest"]})}),{result:E}=await m.json();return E?E.slice(0,c.length).toLowerCase()===c.toLowerCase():!1}catch(c){return console.error("isValidEip1271Signature: ",c),!1}}function Zi(){return Date.now()+Math.floor(Math.random()*1e3)}function Yi(e){const t=atob(e),n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);const r=n[0];if(r===0)throw new Error("No signatures found");const o=1+r*64;if(n.length<o)throw new Error("Transaction data too short for claimed signature count");if(n.length<100)throw new Error("Transaction too short");const i=Buffer.from(e,"base64").slice(1,65);return jo.default.encode(i)}var Gi=Object.defineProperty,Wi=Object.defineProperties,Ji=Object.getOwnPropertyDescriptors,rr=Object.getOwnPropertySymbols,Xi=Object.prototype.hasOwnProperty,Qi=Object.prototype.propertyIsEnumerable,or=(e,t,n)=>t in e?Gi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,kt=(e,t)=>{for(var n in t||(t={}))Xi.call(t,n)&&or(e,n,t[n]);if(rr)for(var n of rr(t))Qi.call(t,n)&&or(e,n,t[n]);return e},ir=(e,t)=>Wi(e,Ji(t));const es="did:pkh:",lt=e=>e?.split(":"),sr=e=>{const t=e&&lt(e);if(t)return e.includes(es)?t[3]:t[1]},cr=e=>{const t=e&&lt(e);if(t)return t[2]+":"+t[3]},Vt=e=>{const t=e&&lt(e);if(t)return t.pop()};async function ts(e){const{cacao:t,projectId:n}=e,{s:r,p:o}=t,i=ar(o,o.iss),s=Vt(o.iss);return await er(s,i,r,cr(o.iss),n)}const ar=(e,t)=>{const n=`${e.domain} wants you to sign in with your Ethereum account:`,r=Vt(t);if(!e.aud&&!e.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let o=e.statement||void 0;const i=`URI: ${e.aud||e.uri}`,s=`Version: ${e.version}`,c=`Chain ID: ${sr(t)}`,a=`Nonce: ${e.nonce}`,u=`Issued At: ${e.iat}`,l=e.exp?`Expiration Time: ${e.exp}`:void 0,f=e.nbf?`Not Before: ${e.nbf}`:void 0,h=e.requestId?`Request ID: ${e.requestId}`:void 0,m=e.resources?`Resources:${e.resources.map(p=>`
- ${p}`).join("")}`:void 0,E=ht(e.resources);if(E){const p=me(E);o=qt(o,p)}return[n,r,"",o,"",i,s,c,a,u,l,f,h,m].filter(p=>p!=null).join(`
`)};function ns(e,t,n){return n.includes("did:pkh:")||(n=`did:pkh:${n}`),{h:{t:"caip122"},p:{iss:n,domain:e.domain,aud:e.aud,version:e.version,nonce:e.nonce,iat:e.iat,statement:e.statement,requestId:e.requestId,resources:e.resources,nbf:e.nbf,exp:e.exp},s:t}}function rs(e){var t;const{authPayload:n,chains:r,methods:o}=e,i=n.statement||"";if(!(r!=null&&r.length))return n;const s=n.chains,c=_t(s,r);if(!(c!=null&&c.length))throw new Error("No supported chains");const a=ur(n.resources);if(!a)return n;ce(a);const u=fr(a,"eip155");let l=n?.resources||[];if(u!=null&&u.length){const f=lr(u),h=_t(f,o);if(!(h!=null&&h.length))throw new Error(`Supported methods don't satisfy the requested: ${JSON.stringify(f)}, supported: ${JSON.stringify(o)}`);const m=Dt("request",h,{chains:c}),E=gr(a,"eip155",m);l=((t=n?.resources)==null?void 0:t.slice(0,-1))||[],l.push(dt(E))}return ir(kt({},n),{statement:yr(i,ht(l)),chains:c,resources:n!=null&&n.resources||l.length>0?l:void 0})}function ur(e){const t=ht(e);if(t&&Mt(t))return me(t)}function os(e,t){var n;return(n=e?.att)==null?void 0:n.hasOwnProperty(t)}function fr(e,t){var n,r;return(n=e?.att)!=null&&n[t]?Object.keys((r=e?.att)==null?void 0:r[t]):[]}function is(e){return e?.map(t=>Object.keys(t))||[]}function lr(e){return e?.map(t=>{var n;return(n=t.split("/"))==null?void 0:n[1]})||[]}function dr(e){return Buffer.from(JSON.stringify(e)).toString("base64")}function hr(e){return JSON.parse(Buffer.from(e,"base64").toString("utf-8"))}function ce(e){if(!e)throw new Error("No recap provided, value is undefined");if(!e.att)throw new Error("No `att` property found");const t=Object.keys(e.att);if(!(t!=null&&t.length))throw new Error("No resources found in `att` property");t.forEach(n=>{const r=e.att[n];if(Array.isArray(r))throw new Error(`Resource must be an object: ${n}`);if(typeof r!="object")throw new Error(`Resource must be an object: ${n}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${n}`);Object.keys(r).forEach(o=>{const i=r[o];if(!Array.isArray(i))throw new Error(`Ability limits ${o} must be an array of objects, found: ${i}`);if(!i.length)throw new Error(`Value of ${o} is empty array, must be an array with objects`);i.forEach(s=>{if(typeof s!="object")throw new Error(`Ability limits (${o}) must be an array of objects, found: ${s}`)})})})}function pr(e,t,n,r={}){return n?.sort((o,i)=>o.localeCompare(i)),{att:{[e]:Dt(t,n,r)}}}function gr(e,t,n){var r;e.att[t]=kt({},n);const o=(r=Object.keys(e.att))==null?void 0:r.sort((s,c)=>s.localeCompare(c)),i={att:{}};return o.reduce((s,c)=>(s.att[c]=e.att[c],s),i)}function Dt(e,t,n={}){t=t?.sort((o,i)=>o.localeCompare(i));const r=t.map(o=>({[`${e}/${o}`]:[n]}));return Object.assign({},...r)}function dt(e){return ce(e),`urn:recap:${dr(e).replace(/=/g,"")}`}function me(e){const t=hr(e.replace("urn:recap:",""));return ce(t),t}function ss(e,t,n){const r=pr(e,t,n);return dt(r)}function Mt(e){return e&&e.includes("urn:recap:")}function cs(e,t){const n=me(e),r=me(t),o=mr(n,r);return dt(o)}function mr(e,t){ce(e),ce(t);const n=Object.keys(e.att).concat(Object.keys(t.att)).sort((o,i)=>o.localeCompare(i)),r={att:{}};return n.forEach(o=>{var i,s;Object.keys(((i=e.att)==null?void 0:i[o])||{}).concat(Object.keys(((s=t.att)==null?void 0:s[o])||{})).sort((c,a)=>c.localeCompare(a)).forEach(c=>{var a,u;r.att[o]=ir(kt({},r.att[o]),{[c]:((a=e.att[o])==null?void 0:a[c])||((u=t.att[o])==null?void 0:u[c])})})}),r}function qt(e="",t){ce(t);const n="I further authorize the stated URI to perform the following actions on my behalf: ";if(e.includes(n))return e;const r=[];let o=0;Object.keys(t.att).forEach(c=>{const a=Object.keys(t.att[c]).map(f=>({ability:f.split("/")[0],action:f.split("/")[1]}));a.sort((f,h)=>f.action.localeCompare(h.action));const u={};a.forEach(f=>{u[f.ability]||(u[f.ability]=[]),u[f.ability].push(f.action)});const l=Object.keys(u).map(f=>(o++,`(${o}) '${f}': '${u[f].join("', '")}' for '${c}'.`));r.push(l.join(", ").replace(".,","."))});const i=r.join(" "),s=`${n}${i}`;return`${e?e+" ":""}${s}`}function as(e){var t;const n=me(e);ce(n);const r=(t=n.att)==null?void 0:t.eip155;return r?Object.keys(r).map(o=>o.split("/")[1]):[]}function us(e){const t=me(e);ce(t);const n=[];return Object.values(t.att).forEach(r=>{Object.values(r).forEach(o=>{var i;(i=o?.[0])!=null&&i.chains&&n.push(o[0].chains)})}),[...new Set(n.flat())]}function yr(e,t){if(!t)return e;const n=me(t);return ce(n),qt(e,n)}function ht(e){if(!e)return;const t=e?.[e.length-1];return Mt(t)?t:void 0}function Ht(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function wr(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function ee(e,...t){if(!wr(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function br(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function fs(e,t){ee(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function Er(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}const ye=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),ls=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),ds=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!ds)throw new Error("Non little-endian hardware is not supported");function hs(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function Ft(e){if(typeof e=="string")e=hs(e);else if(wr(e))e=Kt(e);else throw new Error("Uint8Array expected, got "+typeof e);return e}function ps(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function gs(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}const ms=(e,t)=>{function n(r,...o){if(ee(r),e.nonceLength!==void 0){const l=o[0];if(!l)throw new Error("nonce / iv required");e.varSizeNonce?ee(l):ee(l,e.nonceLength)}const i=e.tagLength;i&&o[1]!==void 0&&ee(o[1]);const s=t(r,...o),c=(l,f)=>{if(f!==void 0){if(l!==2)throw new Error("cipher output not supported");ee(f)}};let a=!1;return{encrypt(l,f){if(a)throw new Error("cannot encrypt() twice with same key + nonce");return a=!0,ee(l),c(s.encrypt.length,f),s.encrypt(l,f)},decrypt(l,f){if(ee(l),i&&l.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return c(s.decrypt.length,f),s.decrypt(l,f)}}}return Object.assign(n,e),n};function vr(e,t,n=!0){if(t===void 0)return new Uint8Array(e);if(t.length!==e)throw new Error("invalid output length, expected "+e+", got: "+t.length);if(n&&!ys(t))throw new Error("invalid output, must be aligned");return t}function xr(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),c=Number(n&i),a=r?4:0,u=r?0:4;e.setUint32(t+a,s,r),e.setUint32(t+u,c,r)}function ys(e){return e.byteOffset%4===0}function Kt(e){return Uint8Array.from(e)}function $e(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}const Sr=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),ws=Sr("expand 16-byte k"),bs=Sr("expand 32-byte k"),Es=ye(ws),vs=ye(bs);function V(e,t){return e<<t|e>>>32-t}function zt(e){return e.byteOffset%4===0}const pt=64,xs=16,Ar=2**32-1,Nr=new Uint32Array;function Ss(e,t,n,r,o,i,s,c){const a=o.length,u=new Uint8Array(pt),l=ye(u),f=zt(o)&&zt(i),h=f?ye(o):Nr,m=f?ye(i):Nr;for(let E=0;E<a;s++){if(e(t,n,r,l,s,c),s>=Ar)throw new Error("arx: counter overflow");const p=Math.min(pt,a-E);if(f&&p===pt){const d=E/4;if(E%4!==0)throw new Error("arx: invalid block position");for(let v=0,y;v<xs;v++)y=d+v,m[y]=h[y]^l[v];E+=pt;continue}for(let d=0,v;d<p;d++)v=E+d,i[v]=o[v]^u[d];E+=p}}function As(e,t){const{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:i,rounds:s}=ps({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return Ht(o),Ht(s),Er(i),Er(n),(c,a,u,l,f=0)=>{ee(c),ee(a),ee(u);const h=u.length;if(l===void 0&&(l=new Uint8Array(h)),ee(l),Ht(f),f<0||f>=Ar)throw new Error("arx: counter overflow");if(l.length<h)throw new Error(`arx: output (${l.length}) is shorter than data (${h})`);const m=[];let E=c.length,p,d;if(E===32)m.push(p=Kt(c)),d=vs;else if(E===16&&n)p=new Uint8Array(32),p.set(c),p.set(c,16),d=Es,m.push(p);else throw new Error(`arx: invalid 32-byte key, got length=${E}`);zt(a)||m.push(a=Kt(a));const v=ye(p);if(r){if(a.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(d,v,ye(a.subarray(0,16)),v),a=a.subarray(16)}const y=16-o;if(y!==a.length)throw new Error(`arx: nonce must be ${y} or 16 bytes`);if(y!==12){const B=new Uint8Array(12);B.set(a,i?0:12-a.length),a=B,m.push(a)}const A=ye(a);return Ss(e,d,v,A,u,l,f,s),$e(...m),l}}const z=(e,t)=>e[t++]&255|(e[t++]&255)<<8;class Ns{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=Ft(t),ee(t,32);const n=z(t,0),r=z(t,2),o=z(t,4),i=z(t,6),s=z(t,8),c=z(t,10),a=z(t,12),u=z(t,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|o<<6)&7939,this.r[3]=(o>>>7|i<<9)&8191,this.r[4]=(i>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|c<<2)&8191,this.r[7]=(c>>>11|a<<5)&8065,this.r[8]=(a>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=z(t,16+2*l)}process(t,n,r=!1){const o=r?0:2048,{h:i,r:s}=this,c=s[0],a=s[1],u=s[2],l=s[3],f=s[4],h=s[5],m=s[6],E=s[7],p=s[8],d=s[9],v=z(t,n+0),y=z(t,n+2),A=z(t,n+4),B=z(t,n+6),C=z(t,n+8),O=z(t,n+10),N=z(t,n+12),T=z(t,n+14);let S=i[0]+(v&8191),L=i[1]+((v>>>13|y<<3)&8191),R=i[2]+((y>>>10|A<<6)&8191),_=i[3]+((A>>>7|B<<9)&8191),P=i[4]+((B>>>4|C<<12)&8191),g=i[5]+(C>>>1&8191),w=i[6]+((C>>>14|O<<2)&8191),b=i[7]+((O>>>11|N<<5)&8191),I=i[8]+((N>>>8|T<<8)&8191),U=i[9]+(T>>>5|o),x=0,$=x+S*c+L*(5*d)+R*(5*p)+_*(5*E)+P*(5*m);x=$>>>13,$&=8191,$+=g*(5*h)+w*(5*f)+b*(5*l)+I*(5*u)+U*(5*a),x+=$>>>13,$&=8191;let j=x+S*a+L*c+R*(5*d)+_*(5*p)+P*(5*E);x=j>>>13,j&=8191,j+=g*(5*m)+w*(5*h)+b*(5*f)+I*(5*l)+U*(5*u),x+=j>>>13,j&=8191;let k=x+S*u+L*a+R*c+_*(5*d)+P*(5*p);x=k>>>13,k&=8191,k+=g*(5*E)+w*(5*m)+b*(5*h)+I*(5*f)+U*(5*l),x+=k>>>13,k&=8191;let M=x+S*l+L*u+R*a+_*c+P*(5*d);x=M>>>13,M&=8191,M+=g*(5*p)+w*(5*E)+b*(5*m)+I*(5*h)+U*(5*f),x+=M>>>13,M&=8191;let q=x+S*f+L*l+R*u+_*a+P*c;x=q>>>13,q&=8191,q+=g*(5*d)+w*(5*p)+b*(5*E)+I*(5*m)+U*(5*h),x+=q>>>13,q&=8191;let Z=x+S*h+L*f+R*l+_*u+P*a;x=Z>>>13,Z&=8191,Z+=g*c+w*(5*d)+b*(5*p)+I*(5*E)+U*(5*m),x+=Z>>>13,Z&=8191;let Y=x+S*m+L*h+R*f+_*l+P*u;x=Y>>>13,Y&=8191,Y+=g*a+w*c+b*(5*d)+I*(5*p)+U*(5*E),x+=Y>>>13,Y&=8191;let ie=x+S*E+L*m+R*h+_*f+P*l;x=ie>>>13,ie&=8191,ie+=g*u+w*a+b*c+I*(5*d)+U*(5*p),x+=ie>>>13,ie&=8191;let J=x+S*p+L*E+R*m+_*h+P*f;x=J>>>13,J&=8191,J+=g*l+w*u+b*a+I*c+U*(5*d),x+=J>>>13,J&=8191;let Q=x+S*d+L*p+R*E+_*m+P*h;x=Q>>>13,Q&=8191,Q+=g*f+w*l+b*u+I*a+U*c,x+=Q>>>13,Q&=8191,x=(x<<2)+x|0,x=x+$|0,$=x&8191,x=x>>>13,j+=x,i[0]=$,i[1]=j,i[2]=k,i[3]=M,i[4]=q,i[5]=Z,i[6]=Y,i[7]=ie,i[8]=J,i[9]=Q}finalize(){const{h:t,pad:n}=this,r=new Uint16Array(10);let o=t[1]>>>13;t[1]&=8191;for(let c=2;c<10;c++)t[c]+=o,o=t[c]>>>13,t[c]&=8191;t[0]+=o*5,o=t[0]>>>13,t[0]&=8191,t[1]+=o,o=t[1]>>>13,t[1]&=8191,t[2]+=o,r[0]=t[0]+5,o=r[0]>>>13,r[0]&=8191;for(let c=1;c<10;c++)r[c]=t[c]+o,o=r[c]>>>13,r[c]&=8191;r[9]-=8192;let i=(o^1)-1;for(let c=0;c<10;c++)r[c]&=i;i=~i;for(let c=0;c<10;c++)t[c]=t[c]&i|r[c];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let s=t[0]+n[0];t[0]=s&65535;for(let c=1;c<8;c++)s=(t[c]+n[c]|0)+(s>>>16)|0,t[c]=s&65535;$e(r)}update(t){br(this);const{buffer:n,blockLen:r}=this;t=Ft(t);const o=t.length;for(let i=0;i<o;){const s=Math.min(r-this.pos,o-i);if(s===r){for(;r<=o-i;i+=r)this.process(t,i);continue}n.set(t.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){$e(this.h,this.r,this.buffer,this.pad)}digestInto(t){br(this),fs(t,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let i=0;for(let s=0;s<8;s++)t[i++]=r[s]>>>0,t[i++]=r[s]>>>8;return t}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}}function Os(e){const t=(r,o)=>e(o).update(Ft(r)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=r=>e(r),t}const Is=Os(e=>new Ns(e));function Bs(e,t,n,r,o,i=20){let s=e[0],c=e[1],a=e[2],u=e[3],l=t[0],f=t[1],h=t[2],m=t[3],E=t[4],p=t[5],d=t[6],v=t[7],y=o,A=n[0],B=n[1],C=n[2],O=s,N=c,T=a,S=u,L=l,R=f,_=h,P=m,g=E,w=p,b=d,I=v,U=y,x=A,$=B,j=C;for(let M=0;M<i;M+=2)O=O+L|0,U=V(U^O,16),g=g+U|0,L=V(L^g,12),O=O+L|0,U=V(U^O,8),g=g+U|0,L=V(L^g,7),N=N+R|0,x=V(x^N,16),w=w+x|0,R=V(R^w,12),N=N+R|0,x=V(x^N,8),w=w+x|0,R=V(R^w,7),T=T+_|0,$=V($^T,16),b=b+$|0,_=V(_^b,12),T=T+_|0,$=V($^T,8),b=b+$|0,_=V(_^b,7),S=S+P|0,j=V(j^S,16),I=I+j|0,P=V(P^I,12),S=S+P|0,j=V(j^S,8),I=I+j|0,P=V(P^I,7),O=O+R|0,j=V(j^O,16),b=b+j|0,R=V(R^b,12),O=O+R|0,j=V(j^O,8),b=b+j|0,R=V(R^b,7),N=N+_|0,U=V(U^N,16),I=I+U|0,_=V(_^I,12),N=N+_|0,U=V(U^N,8),I=I+U|0,_=V(_^I,7),T=T+P|0,x=V(x^T,16),g=g+x|0,P=V(P^g,12),T=T+P|0,x=V(x^T,8),g=g+x|0,P=V(P^g,7),S=S+L|0,$=V($^S,16),w=w+$|0,L=V(L^w,12),S=S+L|0,$=V($^S,8),w=w+$|0,L=V(L^w,7);let k=0;r[k++]=s+O|0,r[k++]=c+N|0,r[k++]=a+T|0,r[k++]=u+S|0,r[k++]=l+L|0,r[k++]=f+R|0,r[k++]=h+_|0,r[k++]=m+P|0,r[k++]=E+g|0,r[k++]=p+w|0,r[k++]=d+b|0,r[k++]=v+I|0,r[k++]=y+U|0,r[k++]=A+x|0,r[k++]=B+$|0,r[k++]=C+j|0}const Rs=As(Bs,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Ts=new Uint8Array(16),Or=(e,t)=>{e.update(t);const n=t.length%16;n&&e.update(Ts.subarray(n))},Us=new Uint8Array(32);function Ir(e,t,n,r,o){const i=e(t,n,Us),s=Is.create(i);o&&Or(s,o),Or(s,r);const c=new Uint8Array(16),a=ls(c);xr(a,0,BigInt(o?o.length:0),!0),xr(a,8,BigInt(r.length),!0),s.update(c);const u=s.digest();return $e(i,c),u}const _s=e=>(t,n,r)=>({encrypt(i,s){const c=i.length;s=vr(c+16,s,!1),s.set(i);const a=s.subarray(0,-16);e(t,n,a,a,1);const u=Ir(e,t,n,a,r);return s.set(u,c),$e(u),s},decrypt(i,s){s=vr(i.length-16,s,!1);const c=i.subarray(0,-16),a=i.subarray(-16),u=Ir(e,t,n,c,r);if(!gs(a,u))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),e(t,n,s,s,1),$e(u),s}}),Br=ms({blockSize:64,nonceLength:12,tagLength:16},_s(Rs));class Rr extends $t{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,Lt(t);const r=Le(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,i=new Uint8Array(o);i.set(r.length>o?t.create().update(r).digest():r);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=t.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),i.fill(0)}update(t){return _e(this),this.iHash.update(t),this}digestInto(t){_e(this),We(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:i,blockLen:s,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=i,t.blockLen=s,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const gt=(e,t,n)=>new Rr(e,t).update(n).digest();gt.create=(e,t)=>new Rr(e,t);function Cs(e,t,n){return Lt(e),n===void 0&&(n=new Uint8Array(e.outputLen)),gt(e,Le(n),Le(t))}const Zt=new Uint8Array([0]),Tr=new Uint8Array;function Ls(e,t,n,r=32){if(Lt(e),Ge(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(r/e.outputLen);n===void 0&&(n=Tr);const i=new Uint8Array(o*e.outputLen),s=gt.create(e,t),c=s._cloneInto(),a=new Uint8Array(s.outputLen);for(let u=0;u<o;u++)Zt[0]=u+1,c.update(u===0?Tr:a).update(n).update(Zt).digestInto(a),i.set(a,e.outputLen*u),s._cloneInto(c);return s.destroy(),c.destroy(),a.fill(0),Zt.fill(0),i.slice(0,r)}const Ps=(e,t,n,r,o)=>Ls(e,Cs(e,t,n),r,o);function $s(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),c=Number(n&i),a=r?4:0,u=r?0:4;e.setUint32(t+a,s,r),e.setUint32(t+u,c,r)}function js(e,t,n){return e&t^~e&n}function ks(e,t,n){return e&t^e&n^t&n}class Vs extends $t{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Pt(this.buffer)}update(t){_e(this);const{view:n,buffer:r,blockLen:o}=this;t=Le(t);const i=t.length;for(let s=0;s<i;){const c=Math.min(o-this.pos,i-s);if(c===o){const a=Pt(t);for(;o<=i-s;s+=o)this.process(a,s);continue}r.set(t.subarray(s,s+c),this.pos),this.pos+=c,s+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){_e(this),Fn(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:i}=this;let{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(r,0),s=0);for(let f=s;f<o;f++)n[f]=0;$s(r,o-8,BigInt(this.length*8),i),this.process(r,0);const c=Pt(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=a/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)c.setUint32(4*f,l[f],i)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:i,destroyed:s,pos:c}=this;return t.length=o,t.pos=c,t.finished=i,t.destroyed=s,o%n&&t.buffer.set(r),t}}const Ds=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),we=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),be=new Uint32Array(64);class Ms extends Vs{constructor(){super(64,32,8,!1),this.A=we[0]|0,this.B=we[1]|0,this.C=we[2]|0,this.D=we[3]|0,this.E=we[4]|0,this.F=we[5]|0,this.G=we[6]|0,this.H=we[7]|0}get(){const{A:t,B:n,C:r,D:o,E:i,F:s,G:c,H:a}=this;return[t,n,r,o,i,s,c,a]}set(t,n,r,o,i,s,c,a){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=c|0,this.H=a|0}process(t,n){for(let f=0;f<16;f++,n+=4)be[f]=t.getUint32(n,!1);for(let f=16;f<64;f++){const h=be[f-15],m=be[f-2],E=se(h,7)^se(h,18)^h>>>3,p=se(m,17)^se(m,19)^m>>>10;be[f]=p+be[f-7]+E+be[f-16]|0}let{A:r,B:o,C:i,D:s,E:c,F:a,G:u,H:l}=this;for(let f=0;f<64;f++){const h=se(c,6)^se(c,11)^se(c,25),m=l+h+js(c,a,u)+Ds[f]+be[f]|0,p=(se(r,2)^se(r,13)^se(r,22))+ks(r,o,i)|0;l=u,u=a,a=c,c=s+m|0,s=i,i=o,o=r,r=m+p|0}r=r+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,c=c+this.E|0,a=a+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(r,o,i,s,c,a,u,l)}roundClean(){be.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Xe=Yn(()=>new Ms);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const mt=BigInt(0),yt=BigInt(1),qs=BigInt(2);function Se(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Qe(e){if(!Se(e))throw new Error("Uint8Array expected")}function je(e,t){if(typeof t!="boolean")throw new Error(e+" boolean expected, got "+t)}const Hs=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function ke(e){Qe(e);let t="";for(let n=0;n<e.length;n++)t+=Hs[e[n]];return t}function Ve(e){const t=e.toString(16);return t.length&1?"0"+t:t}function Yt(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?mt:BigInt("0x"+e)}const ue={_0:48,_9:57,A:65,F:70,a:97,f:102};function Ur(e){if(e>=ue._0&&e<=ue._9)return e-ue._0;if(e>=ue.A&&e<=ue.F)return e-(ue.A-10);if(e>=ue.a&&e<=ue.f)return e-(ue.a-10)}function De(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let o=0,i=0;o<n;o++,i+=2){const s=Ur(e.charCodeAt(i)),c=Ur(e.charCodeAt(i+1));if(s===void 0||c===void 0){const a=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+a+'" at index '+i)}r[o]=s*16+c}return r}function Ae(e){return Yt(ke(e))}function et(e){return Qe(e),Yt(ke(Uint8Array.from(e).reverse()))}function Me(e,t){return De(e.toString(16).padStart(t*2,"0"))}function wt(e,t){return Me(e,t).reverse()}function Fs(e){return De(Ve(e))}function te(e,t,n){let r;if(typeof t=="string")try{r=De(t)}catch(i){throw new Error(e+" must be hex string or Uint8Array, cause: "+i)}else if(Se(t))r=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");const o=r.length;if(typeof n=="number"&&o!==n)throw new Error(e+" of length "+n+" expected, got "+o);return r}function tt(...e){let t=0;for(let r=0;r<e.length;r++){const o=e[r];Qe(o),t+=o.length}const n=new Uint8Array(t);for(let r=0,o=0;r<e.length;r++){const i=e[r];n.set(i,o),o+=i.length}return n}function Ks(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}function zs(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}const Gt=e=>typeof e=="bigint"&&mt<=e;function bt(e,t,n){return Gt(e)&&Gt(t)&&Gt(n)&&t<=e&&e<n}function fe(e,t,n,r){if(!bt(t,n,r))throw new Error("expected valid "+e+": "+n+" <= n < "+r+", got "+t)}function _r(e){let t;for(t=0;e>mt;e>>=yt,t+=1);return t}function Zs(e,t){return e>>BigInt(t)&yt}function Ys(e,t,n){return e|(n?yt:mt)<<BigInt(t)}const Wt=e=>(qs<<BigInt(e-1))-yt,Jt=e=>new Uint8Array(e),Cr=e=>Uint8Array.from(e);function Lr(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Jt(e),o=Jt(e),i=0;const s=()=>{r.fill(1),o.fill(0),i=0},c=(...f)=>n(o,r,...f),a=(f=Jt())=>{o=c(Cr([0]),f),r=c(),f.length!==0&&(o=c(Cr([1]),f),r=c())},u=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const h=[];for(;f<t;){r=c();const m=r.slice();h.push(m),f+=r.length}return tt(...h)};return(f,h)=>{s(),a(f);let m;for(;!(m=h(u()));)a();return s(),m}}const Gs={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||Se(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function qe(e,t,n={}){const r=(o,i,s)=>{const c=Gs[i];if(typeof c!="function")throw new Error("invalid validator function");const a=e[o];if(!(s&&a===void 0)&&!c(a,e))throw new Error("param "+String(o)+" is invalid. Expected "+i+", got "+a)};for(const[o,i]of Object.entries(t))r(o,i,!1);for(const[o,i]of Object.entries(n))r(o,i,!0);return e}const Ws=()=>{throw new Error("not implemented")};function Xt(e){const t=new WeakMap;return(n,...r)=>{const o=t.get(n);if(o!==void 0)return o;const i=e(n,...r);return t.set(n,i),i}}var Js=Object.freeze({__proto__:null,isBytes:Se,abytes:Qe,abool:je,bytesToHex:ke,numberToHexUnpadded:Ve,hexToNumber:Yt,hexToBytes:De,bytesToNumberBE:Ae,bytesToNumberLE:et,numberToBytesBE:Me,numberToBytesLE:wt,numberToVarBytesBE:Fs,ensureBytes:te,concatBytes:tt,equalBytes:Ks,utf8ToBytes:zs,inRange:bt,aInRange:fe,bitLen:_r,bitGet:Zs,bitSet:Ys,bitMask:Wt,createHmacDrbg:Lr,validateObject:qe,notImplemented:Ws,memoized:Xt});const F=BigInt(0),H=BigInt(1),Ne=BigInt(2),Xs=BigInt(3),Qt=BigInt(4),Pr=BigInt(5),$r=BigInt(8);function X(e,t){const n=e%t;return n>=F?n:t+n}function jr(e,t,n){if(t<F)throw new Error("invalid exponent, negatives unsupported");if(n<=F)throw new Error("invalid modulus");if(n===H)return F;let r=H;for(;t>F;)t&H&&(r=r*e%n),e=e*e%n,t>>=H;return r}function oe(e,t,n){let r=e;for(;t-- >F;)r*=r,r%=n;return r}function en(e,t){if(e===F)throw new Error("invert: expected non-zero number");if(t<=F)throw new Error("invert: expected positive modulus, got "+t);let n=X(e,t),r=t,o=F,i=H;for(;n!==F;){const c=r/n,a=r%n,u=o-i*c;r=n,n=a,o=i,i=u}if(r!==H)throw new Error("invert: does not exist");return X(o,t)}function Qs(e){const t=(e-H)/Ne;let n,r,o;for(n=e-H,r=0;n%Ne===F;n/=Ne,r++);for(o=Ne;o<e&&jr(o,t,e)!==e-H;o++)if(o>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const s=(e+H)/Qt;return function(a,u){const l=a.pow(u,s);if(!a.eql(a.sqr(l),u))throw new Error("Cannot find square root");return l}}const i=(n+H)/Ne;return function(c,a){if(c.pow(a,t)===c.neg(c.ONE))throw new Error("Cannot find square root");let u=r,l=c.pow(c.mul(c.ONE,o),n),f=c.pow(a,i),h=c.pow(a,n);for(;!c.eql(h,c.ONE);){if(c.eql(h,c.ZERO))return c.ZERO;let m=1;for(let p=c.sqr(h);m<u&&!c.eql(p,c.ONE);m++)p=c.sqr(p);const E=c.pow(l,H<<BigInt(u-m-1));l=c.sqr(E),f=c.mul(f,E),h=c.mul(h,l),u=m}return f}}function ec(e){if(e%Qt===Xs){const t=(e+H)/Qt;return function(r,o){const i=r.pow(o,t);if(!r.eql(r.sqr(i),o))throw new Error("Cannot find square root");return i}}if(e%$r===Pr){const t=(e-Pr)/$r;return function(r,o){const i=r.mul(o,Ne),s=r.pow(i,t),c=r.mul(o,s),a=r.mul(r.mul(c,Ne),s),u=r.mul(c,r.sub(a,r.ONE));if(!r.eql(r.sqr(u),o))throw new Error("Cannot find square root");return u}}return Qs(e)}const tc=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function nc(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=tc.reduce((r,o)=>(r[o]="function",r),t);return qe(e,n)}function rc(e,t,n){if(n<F)throw new Error("invalid exponent, negatives unsupported");if(n===F)return e.ONE;if(n===H)return t;let r=e.ONE,o=t;for(;n>F;)n&H&&(r=e.mul(r,o)),o=e.sqr(o),n>>=H;return r}function oc(e,t){const n=new Array(t.length),r=t.reduce((i,s,c)=>e.is0(s)?i:(n[c]=i,e.mul(i,s)),e.ONE),o=e.inv(r);return t.reduceRight((i,s,c)=>e.is0(s)?i:(n[c]=e.mul(i,n[c]),e.mul(i,s)),o),n}function kr(e,t){const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Vr(e,t,n=!1,r={}){if(e<=F)throw new Error("invalid field: expected ORDER > 0, got "+e);const{nBitLength:o,nByteLength:i}=kr(e,t);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let s;const c=Object.freeze({ORDER:e,isLE:n,BITS:o,BYTES:i,MASK:Wt(o),ZERO:F,ONE:H,create:a=>X(a,e),isValid:a=>{if(typeof a!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof a);return F<=a&&a<e},is0:a=>a===F,isOdd:a=>(a&H)===H,neg:a=>X(-a,e),eql:(a,u)=>a===u,sqr:a=>X(a*a,e),add:(a,u)=>X(a+u,e),sub:(a,u)=>X(a-u,e),mul:(a,u)=>X(a*u,e),pow:(a,u)=>rc(c,a,u),div:(a,u)=>X(a*en(u,e),e),sqrN:a=>a*a,addN:(a,u)=>a+u,subN:(a,u)=>a-u,mulN:(a,u)=>a*u,inv:a=>en(a,e),sqrt:r.sqrt||(a=>(s||(s=ec(e)),s(c,a))),invertBatch:a=>oc(c,a),cmov:(a,u,l)=>l?u:a,toBytes:a=>n?wt(a,i):Me(a,i),fromBytes:a=>{if(a.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+a.length);return n?et(a):Ae(a)}});return Object.freeze(c)}function Dr(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function Mr(e){const t=Dr(e);return t+Math.ceil(t/2)}function ic(e,t,n=!1){const r=e.length,o=Dr(t),i=Mr(t);if(r<16||r<i||r>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+r);const s=n?et(e):Ae(e),c=X(s,t-H)+H;return n?wt(c,o):Me(c,o)}const qr=BigInt(0),Et=BigInt(1);function tn(e,t){const n=t.negate();return e?n:t}function Hr(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function nn(e,t){Hr(e,t);const n=Math.ceil(t/e)+1,r=2**(e-1);return{windows:n,windowSize:r}}function sc(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((n,r)=>{if(!(n instanceof t))throw new Error("invalid point at index "+r)})}function cc(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((n,r)=>{if(!t.isValid(n))throw new Error("invalid scalar at index "+r)})}const rn=new WeakMap,Fr=new WeakMap;function on(e){return Fr.get(e)||1}function ac(e,t){return{constTimeNegate:tn,hasPrecomputes(n){return on(n)!==1},unsafeLadder(n,r,o=e.ZERO){let i=n;for(;r>qr;)r&Et&&(o=o.add(i)),i=i.double(),r>>=Et;return o},precomputeWindow(n,r){const{windows:o,windowSize:i}=nn(r,t),s=[];let c=n,a=c;for(let u=0;u<o;u++){a=c,s.push(a);for(let l=1;l<i;l++)a=a.add(c),s.push(a);c=a.double()}return s},wNAF(n,r,o){const{windows:i,windowSize:s}=nn(n,t);let c=e.ZERO,a=e.BASE;const u=BigInt(2**n-1),l=2**n,f=BigInt(n);for(let h=0;h<i;h++){const m=h*s;let E=Number(o&u);o>>=f,E>s&&(E-=l,o+=Et);const p=m,d=m+Math.abs(E)-1,v=h%2!==0,y=E<0;E===0?a=a.add(tn(v,r[p])):c=c.add(tn(y,r[d]))}return{p:c,f:a}},wNAFUnsafe(n,r,o,i=e.ZERO){const{windows:s,windowSize:c}=nn(n,t),a=BigInt(2**n-1),u=2**n,l=BigInt(n);for(let f=0;f<s;f++){const h=f*c;if(o===qr)break;let m=Number(o&a);if(o>>=l,m>c&&(m-=u,o+=Et),m===0)continue;let E=r[h+Math.abs(m)-1];m<0&&(E=E.negate()),i=i.add(E)}return i},getPrecomputes(n,r,o){let i=rn.get(r);return i||(i=this.precomputeWindow(r,n),n!==1&&rn.set(r,o(i))),i},wNAFCached(n,r,o){const i=on(n);return this.wNAF(i,this.getPrecomputes(i,n,o),r)},wNAFCachedUnsafe(n,r,o,i){const s=on(n);return s===1?this.unsafeLadder(n,r,i):this.wNAFUnsafe(s,this.getPrecomputes(s,n,o),r,i)},setWindowSize(n,r){Hr(r,t),Fr.set(n,r),rn.delete(n)}}}function uc(e,t,n,r){if(sc(n,e),cc(r,t),n.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const o=e.ZERO,i=_r(BigInt(n.length)),s=i>12?i-3:i>4?i-2:i?2:1,c=(1<<s)-1,a=new Array(c+1).fill(o),u=Math.floor((t.BITS-1)/s)*s;let l=o;for(let f=u;f>=0;f-=s){a.fill(o);for(let m=0;m<r.length;m++){const E=r[m],p=Number(E>>BigInt(f)&BigInt(c));a[p]=a[p].add(n[m])}let h=o;for(let m=a.length-1,E=o;m>0;m--)E=E.add(a[m]),h=h.add(E);if(l=l.add(h),f!==0)for(let m=0;m<s;m++)l=l.double()}return l}function Kr(e){return nc(e.Fp),qe(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...kr(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const He=BigInt(0),sn=BigInt(1);function fc(e){return qe(e,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...e})}function lc(e){const t=fc(e),{P:n}=t,r=y=>X(y,n),o=t.montgomeryBits,i=Math.ceil(o/8),s=t.nByteLength,c=t.adjustScalarBytes||(y=>y),a=t.powPminus2||(y=>jr(y,n-BigInt(2),n));function u(y,A,B){const C=r(y*(A-B));return A=r(A-C),B=r(B+C),[A,B]}const l=(t.a-BigInt(2))/BigInt(4);function f(y,A){fe("u",y,He,n),fe("scalar",A,He,n);const B=A,C=y;let O=sn,N=He,T=y,S=sn,L=He,R;for(let P=BigInt(o-1);P>=He;P--){const g=B>>P&sn;L^=g,R=u(L,O,T),O=R[0],T=R[1],R=u(L,N,S),N=R[0],S=R[1],L=g;const w=O+N,b=r(w*w),I=O-N,U=r(I*I),x=b-U,$=T+S,j=T-S,k=r(j*w),M=r($*I),q=k+M,Z=k-M;T=r(q*q),S=r(C*r(Z*Z)),O=r(b*U),N=r(x*(b+r(l*x)))}R=u(L,O,T),O=R[0],T=R[1],R=u(L,N,S),N=R[0],S=R[1];const _=a(N);return r(O*_)}function h(y){return wt(r(y),i)}function m(y){const A=te("u coordinate",y,i);return s===32&&(A[31]&=127),et(A)}function E(y){const A=te("scalar",y),B=A.length;if(B!==i&&B!==s){let C=""+i+" or "+s;throw new Error("invalid scalar, expected "+C+" bytes, got "+B)}return et(c(A))}function p(y,A){const B=m(A),C=E(y),O=f(B,C);if(O===He)throw new Error("invalid private or public key received");return h(O)}const d=h(t.Gu);function v(y){return p(y,d)}return{scalarMult:p,scalarMultBase:v,getSharedSecret:(y,A)=>p(y,A),getPublicKey:y=>v(y),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:d}}const cn=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const dc=BigInt(1),zr=BigInt(2),hc=BigInt(3),pc=BigInt(5);BigInt(8);function gc(e){const t=BigInt(10),n=BigInt(20),r=BigInt(40),o=BigInt(80),i=cn,c=e*e%i*e%i,a=oe(c,zr,i)*c%i,u=oe(a,dc,i)*e%i,l=oe(u,pc,i)*u%i,f=oe(l,t,i)*l%i,h=oe(f,n,i)*f%i,m=oe(h,r,i)*h%i,E=oe(m,o,i)*m%i,p=oe(E,o,i)*m%i,d=oe(p,t,i)*l%i;return{pow_p_5_8:oe(d,zr,i)*e%i,b2:c}}function mc(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}const an=lc({P:cn,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:e=>{const t=cn,{pow_p_5_8:n,b2:r}=gc(e);return X(oe(n,hc,t)*r,t)},adjustScalarBytes:mc,randomBytes:Pe});function Zr(e){e.lowS!==void 0&&je("lowS",e.lowS),e.prehash!==void 0&&je("prehash",e.prehash)}function yc(e){const t=Kr(e);qe(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=t;if(n){if(!r.eql(o,r.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:wc,hexToBytes:bc}=Js;class Ec extends Error{constructor(t=""){super(t)}}const le={Err:Ec,_tlv:{encode:(e,t)=>{const{Err:n}=le;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length&1)throw new n("tlv.encode: unpadded data");const r=t.length/2,o=Ve(r);if(o.length/2&128)throw new n("tlv.encode: long form length too big");const i=r>127?Ve(o.length/2|128):"";return Ve(e)+i+o+t},decode(e,t){const{Err:n}=le;let r=0;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length<2||t[r++]!==e)throw new n("tlv.decode: wrong tlv");const o=t[r++],i=!!(o&128);let s=0;if(!i)s=o;else{const a=o&127;if(!a)throw new n("tlv.decode(long): indefinite length not supported");if(a>4)throw new n("tlv.decode(long): byte length is too big");const u=t.subarray(r,r+a);if(u.length!==a)throw new n("tlv.decode: length bytes not complete");if(u[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const l of u)s=s<<8|l;if(r+=a,s<128)throw new n("tlv.decode(long): not minimal encoding")}const c=t.subarray(r,r+s);if(c.length!==s)throw new n("tlv.decode: wrong value length");return{v:c,l:t.subarray(r+s)}}},_int:{encode(e){const{Err:t}=le;if(e<de)throw new t("integer: negative integers are not allowed");let n=Ve(e);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return n},decode(e){const{Err:t}=le;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return wc(e)}},toSig(e){const{Err:t,_int:n,_tlv:r}=le,o=typeof e=="string"?bc(e):e;Qe(o);const{v:i,l:s}=r.decode(48,o);if(s.length)throw new t("invalid signature: left bytes after parsing");const{v:c,l:a}=r.decode(2,i),{v:u,l}=r.decode(2,a);if(l.length)throw new t("invalid signature: left bytes after parsing");return{r:n.decode(c),s:n.decode(u)}},hexFromSig(e){const{_tlv:t,_int:n}=le,r=t.encode(2,n.encode(e.r)),o=t.encode(2,n.encode(e.s)),i=r+o;return t.encode(48,i)}},de=BigInt(0),K=BigInt(1);BigInt(2);const Yr=BigInt(3);BigInt(4);function vc(e){const t=yc(e),{Fp:n}=t,r=Vr(t.n,t.nBitLength),o=t.toBytes||((p,d,v)=>{const y=d.toAffine();return tt(Uint8Array.from([4]),n.toBytes(y.x),n.toBytes(y.y))}),i=t.fromBytes||(p=>{const d=p.subarray(1),v=n.fromBytes(d.subarray(0,n.BYTES)),y=n.fromBytes(d.subarray(n.BYTES,2*n.BYTES));return{x:v,y}});function s(p){const{a:d,b:v}=t,y=n.sqr(p),A=n.mul(y,p);return n.add(n.add(A,n.mul(p,d)),v)}if(!n.eql(n.sqr(t.Gy),s(t.Gx)))throw new Error("bad generator point: equation left != right");function c(p){return bt(p,K,t.n)}function a(p){const{allowedPrivateKeyLengths:d,nByteLength:v,wrapPrivateKey:y,n:A}=t;if(d&&typeof p!="bigint"){if(Se(p)&&(p=ke(p)),typeof p!="string"||!d.includes(p.length))throw new Error("invalid private key");p=p.padStart(v*2,"0")}let B;try{B=typeof p=="bigint"?p:Ae(te("private key",p,v))}catch{throw new Error("invalid private key, expected hex or "+v+" bytes, got "+typeof p)}return y&&(B=X(B,A)),fe("private key",B,K,A),B}function u(p){if(!(p instanceof h))throw new Error("ProjectivePoint expected")}const l=Xt((p,d)=>{const{px:v,py:y,pz:A}=p;if(n.eql(A,n.ONE))return{x:v,y};const B=p.is0();d==null&&(d=B?n.ONE:n.inv(A));const C=n.mul(v,d),O=n.mul(y,d),N=n.mul(A,d);if(B)return{x:n.ZERO,y:n.ZERO};if(!n.eql(N,n.ONE))throw new Error("invZ was invalid");return{x:C,y:O}}),f=Xt(p=>{if(p.is0()){if(t.allowInfinityPoint&&!n.is0(p.py))return;throw new Error("bad point: ZERO")}const{x:d,y:v}=p.toAffine();if(!n.isValid(d)||!n.isValid(v))throw new Error("bad point: x or y not FE");const y=n.sqr(v),A=s(d);if(!n.eql(y,A))throw new Error("bad point: equation left != right");if(!p.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class h{constructor(d,v,y){if(this.px=d,this.py=v,this.pz=y,d==null||!n.isValid(d))throw new Error("x required");if(v==null||!n.isValid(v))throw new Error("y required");if(y==null||!n.isValid(y))throw new Error("z required");Object.freeze(this)}static fromAffine(d){const{x:v,y}=d||{};if(!d||!n.isValid(v)||!n.isValid(y))throw new Error("invalid affine point");if(d instanceof h)throw new Error("projective point not allowed");const A=B=>n.eql(B,n.ZERO);return A(v)&&A(y)?h.ZERO:new h(v,y,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){const v=n.invertBatch(d.map(y=>y.pz));return d.map((y,A)=>y.toAffine(v[A])).map(h.fromAffine)}static fromHex(d){const v=h.fromAffine(i(te("pointHex",d)));return v.assertValidity(),v}static fromPrivateKey(d){return h.BASE.multiply(a(d))}static msm(d,v){return uc(h,r,d,v)}_setWindowSize(d){E.setWindowSize(this,d)}assertValidity(){f(this)}hasEvenY(){const{y:d}=this.toAffine();if(n.isOdd)return!n.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){u(d);const{px:v,py:y,pz:A}=this,{px:B,py:C,pz:O}=d,N=n.eql(n.mul(v,O),n.mul(B,A)),T=n.eql(n.mul(y,O),n.mul(C,A));return N&&T}negate(){return new h(this.px,n.neg(this.py),this.pz)}double(){const{a:d,b:v}=t,y=n.mul(v,Yr),{px:A,py:B,pz:C}=this;let O=n.ZERO,N=n.ZERO,T=n.ZERO,S=n.mul(A,A),L=n.mul(B,B),R=n.mul(C,C),_=n.mul(A,B);return _=n.add(_,_),T=n.mul(A,C),T=n.add(T,T),O=n.mul(d,T),N=n.mul(y,R),N=n.add(O,N),O=n.sub(L,N),N=n.add(L,N),N=n.mul(O,N),O=n.mul(_,O),T=n.mul(y,T),R=n.mul(d,R),_=n.sub(S,R),_=n.mul(d,_),_=n.add(_,T),T=n.add(S,S),S=n.add(T,S),S=n.add(S,R),S=n.mul(S,_),N=n.add(N,S),R=n.mul(B,C),R=n.add(R,R),S=n.mul(R,_),O=n.sub(O,S),T=n.mul(R,L),T=n.add(T,T),T=n.add(T,T),new h(O,N,T)}add(d){u(d);const{px:v,py:y,pz:A}=this,{px:B,py:C,pz:O}=d;let N=n.ZERO,T=n.ZERO,S=n.ZERO;const L=t.a,R=n.mul(t.b,Yr);let _=n.mul(v,B),P=n.mul(y,C),g=n.mul(A,O),w=n.add(v,y),b=n.add(B,C);w=n.mul(w,b),b=n.add(_,P),w=n.sub(w,b),b=n.add(v,A);let I=n.add(B,O);return b=n.mul(b,I),I=n.add(_,g),b=n.sub(b,I),I=n.add(y,A),N=n.add(C,O),I=n.mul(I,N),N=n.add(P,g),I=n.sub(I,N),S=n.mul(L,b),N=n.mul(R,g),S=n.add(N,S),N=n.sub(P,S),S=n.add(P,S),T=n.mul(N,S),P=n.add(_,_),P=n.add(P,_),g=n.mul(L,g),b=n.mul(R,b),P=n.add(P,g),g=n.sub(_,g),g=n.mul(L,g),b=n.add(b,g),_=n.mul(P,b),T=n.add(T,_),_=n.mul(I,b),N=n.mul(w,N),N=n.sub(N,_),_=n.mul(w,P),S=n.mul(I,S),S=n.add(S,_),new h(N,T,S)}subtract(d){return this.add(d.negate())}is0(){return this.equals(h.ZERO)}wNAF(d){return E.wNAFCached(this,d,h.normalizeZ)}multiplyUnsafe(d){const{endo:v,n:y}=t;fe("scalar",d,de,y);const A=h.ZERO;if(d===de)return A;if(this.is0()||d===K)return this;if(!v||E.hasPrecomputes(this))return E.wNAFCachedUnsafe(this,d,h.normalizeZ);let{k1neg:B,k1:C,k2neg:O,k2:N}=v.splitScalar(d),T=A,S=A,L=this;for(;C>de||N>de;)C&K&&(T=T.add(L)),N&K&&(S=S.add(L)),L=L.double(),C>>=K,N>>=K;return B&&(T=T.negate()),O&&(S=S.negate()),S=new h(n.mul(S.px,v.beta),S.py,S.pz),T.add(S)}multiply(d){const{endo:v,n:y}=t;fe("scalar",d,K,y);let A,B;if(v){const{k1neg:C,k1:O,k2neg:N,k2:T}=v.splitScalar(d);let{p:S,f:L}=this.wNAF(O),{p:R,f:_}=this.wNAF(T);S=E.constTimeNegate(C,S),R=E.constTimeNegate(N,R),R=new h(n.mul(R.px,v.beta),R.py,R.pz),A=S.add(R),B=L.add(_)}else{const{p:C,f:O}=this.wNAF(d);A=C,B=O}return h.normalizeZ([A,B])[0]}multiplyAndAddUnsafe(d,v,y){const A=h.BASE,B=(O,N)=>N===de||N===K||!O.equals(A)?O.multiplyUnsafe(N):O.multiply(N),C=B(this,v).add(B(d,y));return C.is0()?void 0:C}toAffine(d){return l(this,d)}isTorsionFree(){const{h:d,isTorsionFree:v}=t;if(d===K)return!0;if(v)return v(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:d,clearCofactor:v}=t;return d===K?this:v?v(h,this):this.multiplyUnsafe(t.h)}toRawBytes(d=!0){return je("isCompressed",d),this.assertValidity(),o(h,this,d)}toHex(d=!0){return je("isCompressed",d),ke(this.toRawBytes(d))}}h.BASE=new h(t.Gx,t.Gy,n.ONE),h.ZERO=new h(n.ZERO,n.ONE,n.ZERO);const m=t.nBitLength,E=ac(h,t.endo?Math.ceil(m/2):m);return{CURVE:t,ProjectivePoint:h,normPrivateKeyToScalar:a,weierstrassEquation:s,isWithinCurveOrder:c}}function xc(e){const t=Kr(e);return qe(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function Sc(e){const t=xc(e),{Fp:n,n:r}=t,o=n.BYTES+1,i=2*n.BYTES+1;function s(g){return X(g,r)}function c(g){return en(g,r)}const{ProjectivePoint:a,normPrivateKeyToScalar:u,weierstrassEquation:l,isWithinCurveOrder:f}=vc({...t,toBytes(g,w,b){const I=w.toAffine(),U=n.toBytes(I.x),x=tt;return je("isCompressed",b),b?x(Uint8Array.from([w.hasEvenY()?2:3]),U):x(Uint8Array.from([4]),U,n.toBytes(I.y))},fromBytes(g){const w=g.length,b=g[0],I=g.subarray(1);if(w===o&&(b===2||b===3)){const U=Ae(I);if(!bt(U,K,n.ORDER))throw new Error("Point is not on curve");const x=l(U);let $;try{$=n.sqrt(x)}catch(M){const q=M instanceof Error?": "+M.message:"";throw new Error("Point is not on curve"+q)}const j=($&K)===K;return(b&1)===1!==j&&($=n.neg($)),{x:U,y:$}}else if(w===i&&b===4){const U=n.fromBytes(I.subarray(0,n.BYTES)),x=n.fromBytes(I.subarray(n.BYTES,2*n.BYTES));return{x:U,y:x}}else{const U=o,x=i;throw new Error("invalid Point, expected length of "+U+", or uncompressed "+x+", got "+w)}}}),h=g=>ke(Me(g,t.nByteLength));function m(g){const w=r>>K;return g>w}function E(g){return m(g)?s(-g):g}const p=(g,w,b)=>Ae(g.slice(w,b));class d{constructor(w,b,I){this.r=w,this.s=b,this.recovery=I,this.assertValidity()}static fromCompact(w){const b=t.nByteLength;return w=te("compactSignature",w,b*2),new d(p(w,0,b),p(w,b,2*b))}static fromDER(w){const{r:b,s:I}=le.toSig(te("DER",w));return new d(b,I)}assertValidity(){fe("r",this.r,K,r),fe("s",this.s,K,r)}addRecoveryBit(w){return new d(this.r,this.s,w)}recoverPublicKey(w){const{r:b,s:I,recovery:U}=this,x=O(te("msgHash",w));if(U==null||![0,1,2,3].includes(U))throw new Error("recovery id invalid");const $=U===2||U===3?b+t.n:b;if($>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const j=(U&1)===0?"02":"03",k=a.fromHex(j+h($)),M=c($),q=s(-x*M),Z=s(I*M),Y=a.BASE.multiplyAndAddUnsafe(k,q,Z);if(!Y)throw new Error("point at infinify");return Y.assertValidity(),Y}hasHighS(){return m(this.s)}normalizeS(){return this.hasHighS()?new d(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return De(this.toDERHex())}toDERHex(){return le.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return De(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const v={isValidPrivateKey(g){try{return u(g),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const g=Mr(t.n);return ic(t.randomBytes(g),t.n)},precompute(g=8,w=a.BASE){return w._setWindowSize(g),w.multiply(BigInt(3)),w}};function y(g,w=!0){return a.fromPrivateKey(g).toRawBytes(w)}function A(g){const w=Se(g),b=typeof g=="string",I=(w||b)&&g.length;return w?I===o||I===i:b?I===2*o||I===2*i:g instanceof a}function B(g,w,b=!0){if(A(g))throw new Error("first arg must be private key");if(!A(w))throw new Error("second arg must be public key");return a.fromHex(w).multiply(u(g)).toRawBytes(b)}const C=t.bits2int||function(g){if(g.length>8192)throw new Error("input is too large");const w=Ae(g),b=g.length*8-t.nBitLength;return b>0?w>>BigInt(b):w},O=t.bits2int_modN||function(g){return s(C(g))},N=Wt(t.nBitLength);function T(g){return fe("num < 2^"+t.nBitLength,g,de,N),Me(g,t.nByteLength)}function S(g,w,b=L){if(["recovered","canonical"].some(J=>J in b))throw new Error("sign() legacy options not supported");const{hash:I,randomBytes:U}=t;let{lowS:x,prehash:$,extraEntropy:j}=b;x==null&&(x=!0),g=te("msgHash",g),Zr(b),$&&(g=te("prehashed msgHash",I(g)));const k=O(g),M=u(w),q=[T(M),T(k)];if(j!=null&&j!==!1){const J=j===!0?U(n.BYTES):j;q.push(te("extraEntropy",J))}const Z=tt(...q),Y=k;function ie(J){const Q=C(J);if(!f(Q))return;const Nt=c(Q),Ze=a.BASE.multiply(Q).toAffine(),ve=s(Ze.x);if(ve===de)return;const Ye=s(Nt*s(Y+ve*M));if(Ye===de)return;let Re=(Ze.x===ve?0:2)|Number(Ze.y&K),bn=Ye;return x&&m(Ye)&&(bn=E(Ye),Re^=1),new d(ve,bn,Re)}return{seed:Z,k2sig:ie}}const L={lowS:t.lowS,prehash:!1},R={lowS:t.lowS,prehash:!1};function _(g,w,b=L){const{seed:I,k2sig:U}=S(g,w,b),x=t;return Lr(x.hash.outputLen,x.nByteLength,x.hmac)(I,U)}a.BASE._setWindowSize(8);function P(g,w,b,I=R){const U=g;w=te("msgHash",w),b=te("publicKey",b);const{lowS:x,prehash:$,format:j}=I;if(Zr(I),"strict"in I)throw new Error("options.strict was renamed to lowS");if(j!==void 0&&j!=="compact"&&j!=="der")throw new Error("format must be compact or der");const k=typeof U=="string"||Se(U),M=!k&&!j&&typeof U=="object"&&U!==null&&typeof U.r=="bigint"&&typeof U.s=="bigint";if(!k&&!M)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let q,Z;try{if(M&&(q=new d(U.r,U.s)),k){try{j!=="compact"&&(q=d.fromDER(U))}catch(Re){if(!(Re instanceof le.Err))throw Re}!q&&j!=="der"&&(q=d.fromCompact(U))}Z=a.fromHex(b)}catch{return!1}if(!q||x&&q.hasHighS())return!1;$&&(w=t.hash(w));const{r:Y,s:ie}=q,J=O(w),Q=c(ie),Nt=s(J*Q),Ze=s(Y*Q),ve=a.BASE.multiplyAndAddUnsafe(Z,Nt,Ze)?.toAffine();return ve?s(ve.x)===Y:!1}return{CURVE:t,getPublicKey:y,getSharedSecret:B,sign:_,verify:P,ProjectivePoint:a,Signature:d,utils:v}}function Ac(e){return{hash:e,hmac:(t,...n)=>gt(e,t,Pi(...n)),randomBytes:Pe}}function Nc(e,t){const n=r=>Sc({...e,...Ac(r)});return{...n(t),create:n}}const Gr=Vr(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),Oc=Gr.create(BigInt("-3")),Ic=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Bc=Nc({a:Oc,b:Ic,Fp:Gr,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},Xe),un="base10",W="base16",Fe="base64pad",vt="base64url",Ke="utf8",fn=0,ze=1,nt=2,Rc=0,Wr=1,rt=12,ln=32;function Tc(){const e=an.utils.randomPrivateKey(),t=an.getPublicKey(e);return{privateKey:D.toString(e,W),publicKey:D.toString(t,W)}}function Uc(){const e=Pe(ln);return D.toString(e,W)}function _c(e,t){const n=an.getSharedSecret(D.fromString(e,W),D.fromString(t,W)),r=Ps(Xe,n,void 0,void 0,ln);return D.toString(r,W)}function Cc(e){const t=Xe(D.fromString(e,W));return D.toString(t,W)}function Lc(e){const t=Xe(D.fromString(e,Ke));return D.toString(t,W)}function dn(e){return D.fromString(`${e}`,un)}function Oe(e){return Number(D.toString(e,un))}function Jr(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Xr(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n=(4-t.length%4)%4;return t+"=".repeat(n)}function Pc(e){const t=dn(typeof e.type<"u"?e.type:fn);if(Oe(t)===ze&&typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const n=typeof e.senderPublicKey<"u"?D.fromString(e.senderPublicKey,W):void 0,r=typeof e.iv<"u"?D.fromString(e.iv,W):Pe(rt),o=D.fromString(e.symKey,W),i=Br(o,r).encrypt(D.fromString(e.message,Ke)),s=hn({type:t,sealed:i,iv:r,senderPublicKey:n});return e.encoding===vt?Jr(s):s}function $c(e){const t=D.fromString(e.symKey,W),{sealed:n,iv:r}=xt({encoded:e.encoded,encoding:e.encoding}),o=Br(t,r).decrypt(n);if(o===null)throw new Error("Failed to decrypt");return D.toString(o,Ke)}function jc(e,t){const n=dn(nt),r=Pe(rt),o=D.fromString(e,Ke),i=hn({type:n,sealed:o,iv:r});return t===vt?Jr(i):i}function kc(e,t){const{sealed:n}=xt({encoded:e,encoding:t});return D.toString(n,Ke)}function hn(e){if(Oe(e.type)===nt)return D.toString(D.concat([e.type,e.sealed]),Fe);if(Oe(e.type)===ze){if(typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return D.toString(D.concat([e.type,e.senderPublicKey,e.iv,e.sealed]),Fe)}return D.toString(D.concat([e.type,e.iv,e.sealed]),Fe)}function xt(e){const t=(e.encoding||Fe)===vt?Xr(e.encoded):e.encoded,n=D.fromString(t,Fe),r=n.slice(Rc,Wr),o=Wr;if(Oe(r)===ze){const a=o+ln,u=a+rt,l=n.slice(o,a),f=n.slice(a,u),h=n.slice(u);return{type:r,sealed:h,iv:f,senderPublicKey:l}}if(Oe(r)===nt){const a=n.slice(o),u=Pe(rt);return{type:r,sealed:a,iv:u}}const i=o+rt,s=n.slice(o,i),c=n.slice(i);return{type:r,sealed:c,iv:s}}function Vc(e,t){const n=xt({encoded:e,encoding:t?.encoding});return Qr({type:Oe(n.type),senderPublicKey:typeof n.senderPublicKey<"u"?D.toString(n.senderPublicKey,W):void 0,receiverPublicKey:t?.receiverPublicKey})}function Qr(e){const t=e?.type||fn;if(t===ze){if(typeof e?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof e?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:e?.senderPublicKey,receiverPublicKey:e?.receiverPublicKey}}function Dc(e){return e.type===ze&&typeof e.senderPublicKey=="string"&&typeof e.receiverPublicKey=="string"}function Mc(e){return e.type===nt}function eo(e){const t=Buffer.from(e.x,"base64"),n=Buffer.from(e.y,"base64");return D.concat([new Uint8Array([4]),t,n])}function qc(e,t){const[n,r,o]=e.split("."),i=Buffer.from(Xr(o),"base64");if(i.length!==64)throw new Error("Invalid signature length");const s=i.slice(0,32),c=i.slice(32,64),a=`${n}.${r}`,u=Xe(a),l=eo(t);if(!Bc.verify(D.concat([s,c]),u,l))throw new Error("Invalid signature");return Lo.decodeJWT(e).payload}const to="irn";function Hc(e){return e?.relay||{protocol:to}}function Fc(e){const t=Po.RELAY_JSONRPC[e];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${e}`);return t}function no(e,t="-"){const n={},r="relay"+t;return Object.keys(e).forEach(o=>{if(o.startsWith(r)){const i=o.replace(r,""),s=e[o];n[i]=s}}),n}function Kc(e){if(!e.includes("wc:")){const u=Ct(e);u!=null&&u.includes("wc:")&&(e=u)}e=e.includes("wc://")?e.replace("wc://",""):e,e=e.includes("wc:")?e.replace("wc:",""):e;const t=e.indexOf(":"),n=e.indexOf("?")!==-1?e.indexOf("?"):void 0,r=e.substring(0,t),o=e.substring(t+1,n).split("@"),i=typeof n<"u"?e.substring(n):"",s=new URLSearchParams(i),c={};s.forEach((u,l)=>{c[l]=u});const a=typeof c.methods=="string"?c.methods.split(","):void 0;return{protocol:r,topic:ro(o[0]),version:parseInt(o[1],10),symKey:c.symKey,relay:no(c),methods:a,expiryTimestamp:c.expiryTimestamp?parseInt(c.expiryTimestamp,10):void 0}}function ro(e){return e.startsWith("//")?e.substring(2):e}function oo(e,t="-"){const n="relay",r={};return Object.keys(e).forEach(o=>{const i=o,s=n+t+i;e[i]&&(r[s]=e[i])}),r}function zc(e){const t=new URLSearchParams,n=oo(e.relay);Object.keys(n).sort().forEach(o=>{t.set(o,n[o])}),t.set("symKey",e.symKey),e.expiryTimestamp&&t.set("expiryTimestamp",e.expiryTimestamp.toString()),e.methods&&t.set("methods",e.methods.join(","));const r=t.toString();return`${e.protocol}:${e.topic}@${e.version}?${r}`}function Zc(e,t,n){return`${e}?wc_ev=${n}&topic=${t}`}var Yc=Object.defineProperty,Gc=Object.defineProperties,Wc=Object.getOwnPropertyDescriptors,io=Object.getOwnPropertySymbols,Jc=Object.prototype.hasOwnProperty,Xc=Object.prototype.propertyIsEnumerable,so=(e,t,n)=>t in e?Yc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Qc=(e,t)=>{for(var n in t||(t={}))Jc.call(t,n)&&so(e,n,t[n]);if(io)for(var n of io(t))Xc.call(t,n)&&so(e,n,t[n]);return e},ea=(e,t)=>Gc(e,Wc(t));function Ie(e){const t=[];return e.forEach(n=>{const[r,o]=n.split(":");t.push(`${r}:${o}`)}),t}function co(e){const t=[];return Object.values(e).forEach(n=>{t.push(...Ie(n.accounts))}),t}function ao(e,t){const n=[];return Object.values(e).forEach(r=>{Ie(r.accounts).includes(t)&&n.push(...r.methods)}),n}function uo(e,t){const n=[];return Object.values(e).forEach(r=>{Ie(r.accounts).includes(t)&&n.push(...r.events)}),n}function ta(e,t){const n=vo(e,t);if(n)throw new Error(n.message);const r={};for(const[o,i]of Object.entries(e))r[o]={methods:i.methods,events:i.events,chains:i.accounts.map(s=>`${s.split(":")[0]}:${s.split(":")[1]}`)};return r}function na(e){const{proposal:{requiredNamespaces:t,optionalNamespaces:n={}},supportedNamespaces:r}=e,o=ot(t),i=ot(n),s={};Object.keys(r).forEach(u=>{const l=r[u].chains,f=r[u].methods,h=r[u].events,m=r[u].accounts;l.forEach(E=>{if(!m.some(p=>p.includes(E)))throw new Error(`No accounts provided for chain ${E} in namespace ${u}`)}),s[u]={chains:l,methods:f,events:h,accounts:m}});const c=So(t,s,"approve()");if(c)throw new Error(c.message);const a={};return!Object.keys(t).length&&!Object.keys(n).length?s:(Object.keys(o).forEach(u=>{const l=r[u].chains.filter(E=>{var p,d;return(d=(p=o[u])==null?void 0:p.chains)==null?void 0:d.includes(E)}),f=r[u].methods.filter(E=>{var p,d;return(d=(p=o[u])==null?void 0:p.methods)==null?void 0:d.includes(E)}),h=r[u].events.filter(E=>{var p,d;return(d=(p=o[u])==null?void 0:p.events)==null?void 0:d.includes(E)}),m=l.map(E=>r[u].accounts.filter(p=>p.includes(`${E}:`))).flat();a[u]={chains:l,methods:f,events:h,accounts:m}}),Object.keys(i).forEach(u=>{var l,f,h,m,E,p;if(!r[u])return;const d=(f=(l=i[u])==null?void 0:l.chains)==null?void 0:f.filter(B=>r[u].chains.includes(B)),v=r[u].methods.filter(B=>{var C,O;return(O=(C=i[u])==null?void 0:C.methods)==null?void 0:O.includes(B)}),y=r[u].events.filter(B=>{var C,O;return(O=(C=i[u])==null?void 0:C.events)==null?void 0:O.includes(B)}),A=d?.map(B=>r[u].accounts.filter(C=>C.includes(`${B}:`))).flat();a[u]={chains:re((h=a[u])==null?void 0:h.chains,d),methods:re((m=a[u])==null?void 0:m.methods,v),events:re((E=a[u])==null?void 0:E.events,y),accounts:re((p=a[u])==null?void 0:p.accounts,A)}}),a)}function pn(e){return e.includes(":")}function fo(e){return pn(e)?e.split(":")[0]:e}function ot(e){var t,n,r;const o={};if(!St(e))return o;for(const[i,s]of Object.entries(e)){const c=pn(i)?[i]:s.chains,a=s.methods||[],u=s.events||[],l=fo(i);o[l]=ea(Qc({},o[l]),{chains:re(c,(t=o[l])==null?void 0:t.chains),methods:re(a,(n=o[l])==null?void 0:n.methods),events:re(u,(r=o[l])==null?void 0:r.events)})}return o}function lo(e){const t={};return e?.forEach(n=>{var r;const[o,i]=n.split(":");t[o]||(t[o]={accounts:[],chains:[],events:[],methods:[]}),t[o].accounts.push(n),(r=t[o].chains)==null||r.push(`${o}:${i}`)}),t}function ra(e,t){t=t.map(r=>r.replace("did:pkh:",""));const n=lo(t);for(const[r,o]of Object.entries(n))o.methods?o.methods=re(o.methods,e):o.methods=e,o.events=["chainChanged","accountsChanged"];return n}function oa(e,t){var n,r,o,i,s,c;const a=ot(e),u=ot(t),l={},f=Object.keys(a).concat(Object.keys(u));for(const h of f)l[h]={chains:re((n=a[h])==null?void 0:n.chains,(r=u[h])==null?void 0:r.chains),methods:re((o=a[h])==null?void 0:o.methods,(i=u[h])==null?void 0:i.methods),events:re((s=a[h])==null?void 0:s.events,(c=u[h])==null?void 0:c.events)};return l}const ho={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},po={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function he(e,t){const{message:n,code:r}=po[e];return{message:t?`${n} ${t}`:n,code:r}}function Be(e,t){const{message:n,code:r}=ho[e];return{message:t?`${n} ${t}`:n,code:r}}function it(e,t){return Array.isArray(e)?typeof t<"u"&&e.length?e.every(t):!0:!1}function St(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function Ee(e){return typeof e>"u"}function ne(e,t){return t&&Ee(e)?!0:typeof e=="string"&&!!e.trim().length}function At(e,t){return t&&Ee(e)?!0:typeof e=="number"&&!isNaN(e)}function ia(e,t){const{requiredNamespaces:n}=t,r=Object.keys(e.namespaces),o=Object.keys(n);let i=!0;return ge(o,r)?(r.forEach(s=>{const{accounts:c,methods:a,events:u}=e.namespaces[s],l=Ie(c),f=n[s];(!ge(at(s,f),l)||!ge(f.methods,a)||!ge(f.events,u))&&(i=!1)}),i):!1}function st(e){return ne(e,!1)&&e.includes(":")?e.split(":").length===2:!1}function go(e){if(ne(e,!1)&&e.includes(":")){const t=e.split(":");if(t.length===3){const n=t[0]+":"+t[1];return!!t[2]&&st(n)}}return!1}function sa(e){function t(n){try{return typeof new URL(n)<"u"}catch{return!1}}try{if(ne(e,!1)){if(t(e))return!0;const n=Ct(e);return t(n)}}catch{}return!1}function ca(e){var t;return(t=e?.proposer)==null?void 0:t.publicKey}function aa(e){return e?.topic}function ua(e,t){let n=null;return ne(e?.publicKey,!1)||(n=he("MISSING_OR_INVALID",`${t} controller public key should be a string`)),n}function gn(e){let t=!0;return it(e)?e.length&&(t=e.every(n=>ne(n,!1))):t=!1,t}function mo(e,t,n){let r=null;return it(t)&&t.length?t.forEach(o=>{r||st(o)||(r=Be("UNSUPPORTED_CHAINS",`${n}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):st(e)||(r=Be("UNSUPPORTED_CHAINS",`${n}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function yo(e,t,n){let r=null;return Object.entries(e).forEach(([o,i])=>{if(r)return;const s=mo(o,at(o,i),`${t} ${n}`);s&&(r=s)}),r}function wo(e,t){let n=null;return it(e)?e.forEach(r=>{n||go(r)||(n=Be("UNSUPPORTED_ACCOUNTS",`${t}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):n=Be("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n}function bo(e,t){let n=null;return Object.values(e).forEach(r=>{if(n)return;const o=wo(r?.accounts,`${t} namespace`);o&&(n=o)}),n}function Eo(e,t){let n=null;return gn(e?.methods)?gn(e?.events)||(n=Be("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):n=Be("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),n}function mn(e,t){let n=null;return Object.values(e).forEach(r=>{if(n)return;const o=Eo(r,`${t}, namespace`);o&&(n=o)}),n}function fa(e,t,n){let r=null;if(e&&St(e)){const o=mn(e,t);o&&(r=o);const i=yo(e,t,n);i&&(r=i)}else r=he("MISSING_OR_INVALID",`${t}, ${n} should be an object with data`);return r}function vo(e,t){let n=null;if(e&&St(e)){const r=mn(e,t);r&&(n=r);const o=bo(e,t);o&&(n=o)}else n=he("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return n}function xo(e){return ne(e.protocol,!0)}function la(e,t){let n=!1;return t&&!e?n=!0:e&&it(e)&&e.length&&e.forEach(r=>{n=xo(r)}),n}function da(e){return typeof e=="number"}function ha(e){return typeof e<"u"&&typeof e!==null}function pa(e){return!(!e||typeof e!="object"||!e.code||!At(e.code,!1)||!e.message||!ne(e.message,!1))}function ga(e){return!(Ee(e)||!ne(e.method,!1))}function ma(e){return!(Ee(e)||Ee(e.result)&&Ee(e.error)||!At(e.id,!1)||!ne(e.jsonrpc,!1))}function ya(e){return!(Ee(e)||!ne(e.name,!1))}function wa(e,t){return!(!st(t)||!co(e).includes(t))}function ba(e,t,n){return ne(n,!1)?ao(e,t).includes(n):!1}function Ea(e,t,n){return ne(n,!1)?uo(e,t).includes(n):!1}function So(e,t,n){let r=null;const o=va(e),i=xa(t),s=Object.keys(o),c=Object.keys(i),a=Ao(Object.keys(e)),u=Ao(Object.keys(t)),l=a.filter(f=>!u.includes(f));return l.length&&(r=he("NON_CONFORMING_NAMESPACES",`${n} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(t).toString()}`)),ge(s,c)||(r=he("NON_CONFORMING_NAMESPACES",`${n} namespaces chains don't satisfy required namespaces.
      Required: ${s.toString()}
      Approved: ${c.toString()}`)),Object.keys(t).forEach(f=>{if(!f.includes(":")||r)return;const h=Ie(t[f].accounts);h.includes(f)||(r=he("NON_CONFORMING_NAMESPACES",`${n} namespaces accounts don't satisfy namespace accounts for ${f}
        Required: ${f}
        Approved: ${h.toString()}`))}),s.forEach(f=>{r||(ge(o[f].methods,i[f].methods)?ge(o[f].events,i[f].events)||(r=he("NON_CONFORMING_NAMESPACES",`${n} namespaces events don't satisfy namespace events for ${f}`)):r=he("NON_CONFORMING_NAMESPACES",`${n} namespaces methods don't satisfy namespace methods for ${f}`))}),r}function va(e){const t={};return Object.keys(e).forEach(n=>{var r;n.includes(":")?t[n]=e[n]:(r=e[n].chains)==null||r.forEach(o=>{t[o]={methods:e[n].methods,events:e[n].events}})}),t}function Ao(e){return[...new Set(e.map(t=>t.includes(":")?t.split(":")[0]:t))]}function xa(e){const t={};return Object.keys(e).forEach(n=>{if(n.includes(":"))t[n]=e[n];else{const r=Ie(e[n].accounts);r?.forEach(o=>{t[o]={accounts:e[n].accounts.filter(i=>i.includes(`${o}:`)),methods:e[n].methods,events:e[n].events}})}}),t}function Sa(e,t){return At(e,!1)&&e<=t.max&&e>=t.min}function Aa(){const e=xe();return new Promise(t=>{switch(e){case G.browser:t(No());break;case G.reactNative:t(Oo());break;case G.node:t(Io());break;default:t(!0)}})}function No(){return Ue()&&navigator?.onLine}async function Oo(){if(pe()&&typeof global<"u"&&global!=null&&global.NetInfo){const e=await(global==null?void 0:global.NetInfo.fetch());return e?.isConnected}return!0}function Io(){return!0}function Na(e){switch(xe()){case G.browser:Bo(e);break;case G.reactNative:Ro(e);break;case G.node:break}}function Bo(e){!pe()&&Ue()&&(window.addEventListener("online",()=>e(!0)),window.addEventListener("offline",()=>e(!1)))}function Ro(e){pe()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(t=>e(t?.isConnected))}function Oa(){var e;return Ue()&&ae.getDocument()?((e=ae.getDocument())==null?void 0:e.visibilityState)==="visible":!0}const yn={};class Ia{static get(t){return yn[t]}static set(t,n){yn[t]=n}static delete(t){delete yn[t]}}exports.BASE10=un,exports.BASE16=W,exports.BASE64=Fe,exports.BASE64URL=vt,exports.COLON=Go,exports.DEFAULT_DEPTH=Rt,exports.EMPTY_SPACE=ut,exports.ENV_MAP=G,exports.INTERNAL_ERRORS=po,exports.MemoryStore=Ia,exports.ONE_THOUSAND=Wo,exports.REACT_NATIVE_PRODUCT=Bn,exports.RELAYER_DEFAULT_PROTOCOL=to,exports.SDK_ERRORS=ho,exports.SDK_TYPE=Tn,exports.SLASH=Rn,exports.TYPE_0=fn,exports.TYPE_1=ze,exports.TYPE_2=nt,exports.UTF8=Ke,exports.addResourceToRecap=gr,exports.appendToQueryString=Un,exports.assertType=oi,exports.assignAbilityToActions=Dt,exports.base64Decode=hr,exports.base64Encode=dr,exports.buildApprovedNamespaces=na,exports.buildAuthObject=ns,exports.buildNamespacesFromAuth=ra,exports.buildRecapStatement=yr,exports.calcExpiry=mi,exports.capitalize=fi,exports.capitalizeWord=kn,exports.createDelayedPromise=li,exports.createEncodedRecap=ss,exports.createExpiringPromise=di,exports.createRecap=pr,exports.decodeRecap=me,exports.decodeTypeByte=Oe,exports.decodeTypeTwoEnvelope=kc,exports.decrypt=$c,exports.deriveSymKey=_c,exports.deserialize=xt,exports.encodeRecap=dt,exports.encodeTypeByte=dn,exports.encodeTypeTwoEnvelope=jc,exports.encrypt=Pc,exports.engineEvent=wi,exports.enumify=ui,exports.extractSolanaTransactionId=Yi,exports.formatAccountId=vn,exports.formatAccountWithChain=ko,exports.formatChainId=En,exports.formatDeeplinkUrl=Vn,exports.formatExpirerTarget=Ut,exports.formatIdTarget=pi,exports.formatMessage=ar,exports.formatMessageContext=ii,exports.formatRelayParams=oo,exports.formatRelayRpcUrl=ni,exports.formatStatementFromRecap=qt,exports.formatTopicTarget=hi,exports.formatUA=Pn,exports.formatUri=zc,exports.fromBase64=Ct,exports.generateKeyPair=Tc,exports.generateRandomBytes32=Uc,exports.getAccountsChains=Ie,exports.getAccountsFromNamespaces=Do,exports.getAddressFromAccount=xn,exports.getAddressesFromAccounts=Vo,exports.getAppId=Qo,exports.getAppMetadata=_n,exports.getBrowserOnlineStatus=No,exports.getChainFromAccount=Sn,exports.getChainsFromAccounts=An,exports.getChainsFromNamespace=at,exports.getChainsFromNamespaces=Mo,exports.getChainsFromRecap=us,exports.getChainsFromRequiredNamespaces=qo,exports.getCommonValuesInArrays=_t,exports.getCryptoKeyFromKeyData=eo,exports.getDecodedRecapFromResources=ur,exports.getDeepLink=Ei,exports.getDidAddress=Vt,exports.getDidAddressSegments=lt,exports.getDidChainId=sr,exports.getEnvironment=xe,exports.getHttpUrl=ri,exports.getInternalError=he,exports.getJavascriptID=Ln,exports.getJavascriptOS=Cn,exports.getLastItems=jn,exports.getLinkModeURL=Zc,exports.getMethodsFromRecap=as,exports.getNamespacedDidChainId=cr,exports.getNamespacesChains=co,exports.getNamespacesEventsForChainId=uo,exports.getNamespacesFromAccounts=lo,exports.getNamespacesMethodsForChainId=ao,exports.getNodeOnlineStatus=Io,exports.getReCapActions=lr,exports.getReactNativeOnlineStatus=Oo,exports.getRecapAbilitiesFromResource=is,exports.getRecapFromResources=ht,exports.getRecapResource=fr,exports.getRelayClientMetadata=ti,exports.getRelayProtocolApi=Fc,exports.getRelayProtocolName=Hc,exports.getRequiredNamespacesFromNamespaces=ta,exports.getSdkError=Be,exports.getSearchParamFromURL=vi,exports.getUniqueValues=Bt,exports.handleDeeplinkRedirect=bi,exports.hasOverlap=ge,exports.hashEthereumMessage=jt,exports.hashKey=Cc,exports.hashMessage=Lc,exports.isAndroid=Jo,exports.isAppVisible=Oa,exports.isBrowser=Ue,exports.isCaipNamespace=pn,exports.isConformingNamespaces=So,exports.isExpired=yi,exports.isIframe=qn,exports.isIos=Xo,exports.isNode=Tt,exports.isOnline=Aa,exports.isProposalStruct=ca,exports.isReactNative=pe,exports.isRecap=Mt,exports.isSessionCompatible=ia,exports.isSessionStruct=aa,exports.isTelegram=Mn,exports.isTestRun=Si,exports.isTypeOneEnvelope=Dc,exports.isTypeTwoEnvelope=Mc,exports.isUndefined=Ee,exports.isValidAccountId=go,exports.isValidAccounts=wo,exports.isValidActions=Eo,exports.isValidArray=it,exports.isValidChainId=st,exports.isValidChains=mo,exports.isValidController=ua,exports.isValidEip1271Signature=nr,exports.isValidEip191Signature=tr,exports.isValidErrorReason=pa,exports.isValidEvent=ya,exports.isValidId=da,exports.isValidNamespaceAccounts=bo,exports.isValidNamespaceActions=mn,exports.isValidNamespaceChains=yo,exports.isValidNamespaceMethodsOrEvents=gn,exports.isValidNamespaces=vo,exports.isValidNamespacesChainId=wa,exports.isValidNamespacesEvent=Ea,exports.isValidNamespacesRequest=ba,exports.isValidNumber=At,exports.isValidObject=St,exports.isValidParams=ha,exports.isValidRecap=ce,exports.isValidRelay=xo,exports.isValidRelays=la,exports.isValidRequest=ga,exports.isValidRequestExpiry=Sa,exports.isValidRequiredNamespaces=fa,exports.isValidResponse=ma,exports.isValidString=ne,exports.isValidUrl=sa,exports.mapEntries=ai,exports.mapToObj=si,exports.mergeArrays=re,exports.mergeEncodedRecaps=cs,exports.mergeRecaps=mr,exports.mergeRequiredAndOptionalNamespaces=oa,exports.normalizeNamespaces=ot,exports.objToMap=ci,exports.openDeeplink=Dn,exports.parseAccountId=It,exports.parseChainId=Ot,exports.parseContextNames=$n,exports.parseExpirerTarget=gi,exports.parseNamespaceKey=fo,exports.parseRelayParams=no,exports.parseTopic=ro,exports.parseUri=Kc,exports.populateAppMetadata=ei,exports.populateAuthPayload=rs,exports.recapHasResource=os,exports.serialize=hn,exports.sleep=Ai,exports.subscribeToBrowserNetworkChange=Bo,exports.subscribeToNetworkChange=Na,exports.subscribeToReactNativeNetworkChange=Ro,exports.toBase64=Hn,exports.uuidv4=xi,exports.validateDecoding=Vc,exports.validateEncoding=Qr,exports.validateSignedCacao=ts,exports.verifyP256Jwt=qc,exports.verifySignature=er;
//# sourceMappingURL=index.cjs.js.map
