(function(L,Qe){typeof exports=="object"&&typeof module<"u"?Qe(exports):typeof define=="function"&&define.amd?define(["exports"],Qe):(L=typeof globalThis<"u"?globalThis:L||self,Qe(L["@walletconnect/core"]={}))})(this,function(L){"use strict";var Qe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bo(t){var e=t.default;if(typeof e=="function"){var r=function(){return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}),r}var Ve={exports:{}},Yt=typeof Reflect=="object"?Reflect:null,wo=Yt&&typeof Yt.apply=="function"?Yt.apply:function(e,r,n){return Function.prototype.apply.call(e,r,n)},dn;Yt&&typeof Yt.ownKeys=="function"?dn=Yt.ownKeys:Object.getOwnPropertySymbols?dn=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:dn=function(e){return Object.getOwnPropertyNames(e)};function qh(t){console&&console.warn&&console.warn(t)}var mo=Number.isNaN||function(e){return e!==e};function J(){J.init.call(this)}Ve.exports=J,Ve.exports.once=Zh,J.EventEmitter=J,J.prototype._events=void 0,J.prototype._eventsCount=0,J.prototype._maxListeners=void 0;var Eo=10;function gn(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(J,"defaultMaxListeners",{enumerable:!0,get:function(){return Eo},set:function(t){if(typeof t!="number"||t<0||mo(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Eo=t}}),J.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},J.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||mo(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function vo(t){return t._maxListeners===void 0?J.defaultMaxListeners:t._maxListeners}J.prototype.getMaxListeners=function(){return vo(this)},J.prototype.emit=function(e){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")wo(c,this,r);else for(var u=c.length,l=Oo(c,u),n=0;n<u;++n)wo(l[n],this,r);return!0};function _o(t,e,r,n){var i,s,o;if(gn(r),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),o=s[e]),o===void 0)o=s[e]=r,++t._eventsCount;else if(typeof o=="function"?o=s[e]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),i=vo(t),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,qh(a)}return t}J.prototype.addListener=function(e,r){return _o(this,e,r,!1)},J.prototype.on=J.prototype.addListener,J.prototype.prependListener=function(e,r){return _o(this,e,r,!0)};function Wh(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function So(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=Wh.bind(n);return i.listener=r,n.wrapFn=i,i}J.prototype.once=function(e,r){return gn(r),this.on(e,So(this,e,r)),this},J.prototype.prependOnceListener=function(e,r){return gn(r),this.prependListener(e,So(this,e,r)),this},J.prototype.removeListener=function(e,r){var n,i,s,o,a;if(gn(r),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||r));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===r||n[o].listener===r){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():Gh(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||r)}return this},J.prototype.off=J.prototype.removeListener,J.prototype.removeAllListeners=function(e){var r,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(i=r.length-1;i>=0;i--)this.removeListener(e,r[i]);return this};function Io(t,e,r){var n=t._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?r?[i.listener||i]:[i]:r?Yh(i):Oo(i,i.length)}J.prototype.listeners=function(e){return Io(this,e,!0)},J.prototype.rawListeners=function(e){return Io(this,e,!1)},J.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Do.call(t,e)},J.prototype.listenerCount=Do;function Do(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}J.prototype.eventNames=function(){return this._eventsCount>0?dn(this._events):[]};function Oo(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function Gh(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Yh(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function Zh(t,e){return new Promise(function(r,n){function i(o){t.removeListener(e,s),n(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),r([].slice.call(arguments))}xo(t,e,s,{once:!0}),e!=="error"&&Xh(t,i,{once:!0})})}function Xh(t,e,r){typeof t.on=="function"&&xo(t,"error",e,r)}function xo(t,e,r,n){if(typeof t.on=="function")n.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(s){n.once&&t.removeEventListener(e,i),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var k={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var oi=function(t,e){return oi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},oi(t,e)};function Jh(t,e){oi(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var ai=function(){return ai=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},ai.apply(this,arguments)};function Qh(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function ef(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function tf(t,e){return function(r,n){e(r,n,t)}}function rf(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function nf(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(t,e||[])).next())})}function sf(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function of(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function af(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function ci(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ao(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function cf(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Ao(arguments[e]));return t}function uf(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n}function xr(t){return this instanceof xr?(this.v=t,this):new xr(t)}function lf(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){n[f]&&(i[f]=function(p){return new Promise(function(g,y){s.push([f,p,g,y])>1||a(f,p)})})}function a(f,p){try{c(n[f](p))}catch(g){h(s[0][3],g)}}function c(f){f.value instanceof xr?Promise.resolve(f.value.v).then(u,l):h(s[0][2],f)}function u(f){a("next",f)}function l(f){a("throw",f)}function h(f,p){f(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function hf(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(o){return(r=!r)?{value:xr(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function ff(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof ci=="function"?ci(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function df(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function gf(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function pf(t){return t&&t.__esModule?t:{default:t}}function yf(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function bf(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var wf=Object.freeze({__proto__:null,__extends:Jh,get __assign(){return ai},__rest:Qh,__decorate:ef,__param:tf,__metadata:rf,__awaiter:nf,__generator:sf,__createBinding:of,__exportStar:af,__values:ci,__read:Ao,__spread:cf,__spreadArrays:uf,__await:xr,__asyncGenerator:lf,__asyncDelegator:hf,__asyncValues:ff,__makeTemplateObject:df,__importStar:gf,__importDefault:pf,__classPrivateFieldGet:yf,__classPrivateFieldSet:bf}),pn=bo(wf),ui={},Ar={},To;function mf(){if(To)return Ar;To=1,Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return Ar.delay=t,Ar}var Tt={},li={},Bt={},Bo;function Ef(){return Bo||(Bo=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.ONE_THOUSAND=Bt.ONE_HUNDRED=void 0,Bt.ONE_HUNDRED=100,Bt.ONE_THOUSAND=1e3),Bt}var hi={},Ro;function vf(){return Ro||(Ro=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(hi)),hi}var Co;function No(){return Co||(Co=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=pn;e.__exportStar(Ef(),t),e.__exportStar(vf(),t)}(li)),li}var Po;function _f(){if(Po)return Tt;Po=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.fromMiliseconds=Tt.toMiliseconds=void 0;const t=No();function e(n){return n*t.ONE_THOUSAND}Tt.toMiliseconds=e;function r(n){return Math.floor(n/t.ONE_THOUSAND)}return Tt.fromMiliseconds=r,Tt}var Lo;function Sf(){return Lo||(Lo=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=pn;e.__exportStar(mf(),t),e.__exportStar(_f(),t)}(ui)),ui}var Zt={},$o;function If(){if($o)return Zt;$o=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const n=this.get(r);if(typeof n.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const i=Date.now()-n.started;this.timestamps.set(r,{started:n.started,elapsed:i})}get(r){const n=this.timestamps.get(r);if(typeof n>"u")throw new Error(`No timestamp found for label: ${r}`);return n}elapsed(r){const n=this.get(r);return n.elapsed||Date.now()-n.started}}return Zt.Watch=t,Zt.default=t,Zt}var fi={},Tr={},Uo;function Df(){if(Uo)return Tr;Uo=1,Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.IWatch=void 0;class t{}return Tr.IWatch=t,Tr}var Fo;function Of(){return Fo||(Fo=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),pn.__exportStar(Df(),t)}(fi)),fi}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=pn;e.__exportStar(Sf(),t),e.__exportStar(If(),t),e.__exportStar(Of(),t),e.__exportStar(No(),t)})(k);class Rt{}class xf extends Rt{constructor(e){super()}}const zo=k.FIVE_SECONDS,Ct={pulse:"heartbeat_pulse"};class di extends xf{constructor(e){super(e),this.events=new Ve.exports.EventEmitter,this.interval=zo,this.interval=e?.interval||zo}static async init(e){const r=new di(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),k.toMiliseconds(this.interval))}pulse(){this.events.emit(Ct.pulse)}}const Af=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Tf=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Bf=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Rf(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){Cf(t);return}return e}function Cf(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function yn(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!Bf.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(Af.test(t)||Tf.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,Rf)}return JSON.parse(t)}catch(n){if(e.strict)throw n;return t}}function Nf(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function le(t,...e){try{return Nf(t(...e))}catch(r){return Promise.reject(r)}}function Pf(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function Lf(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function bn(t){if(Pf(t))return String(t);if(Lf(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return bn(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const gi="base64:";function $f(t){return typeof t=="string"?t:gi+zf(t)}function Uf(t){return typeof t!="string"||!t.startsWith(gi)?t:Ff(t.slice(gi.length))}function Ff(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function zf(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Te(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function jf(...t){return Te(t.join(":"))}function wn(t){return t=Te(t),t?t+":":""}function kf(t,e){if(e===void 0)return!0;let r=0,n=t.indexOf(":");for(;n>-1;)r++,n=t.indexOf(":",n+1);return r<=e}function Mf(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}function N2(t){return t}const Vf="memory",Kf=()=>{const t=new Map;return{name:Vf,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function Hf(t={}){const e={mounts:{"":t.driver||Kf()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=u=>{for(const l of e.mountpoints)if(u.startsWith(l))return{base:l,relativeKey:u.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:u,driver:e.mounts[""]}},n=(u,l)=>e.mountpoints.filter(h=>h.startsWith(u)||l&&u.startsWith(h)).map(h=>({relativeBase:u.length>h.length?u.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),i=(u,l)=>{if(e.watching){l=Te(l);for(const h of e.watchListeners)h(u,l)}},s=async()=>{if(!e.watching){e.watching=!0;for(const u in e.mounts)e.unwatch[u]=await jo(e.mounts[u],i,u)}},o=async()=>{if(e.watching){for(const u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,l,h)=>{const f=new Map,p=g=>{let y=f.get(g.base);return y||(y={driver:g.driver,base:g.base,items:[]},f.set(g.base,y)),y};for(const g of u){const y=typeof g=="string",d=Te(y?g:g.key),E=y?void 0:g.value,m=y||!g.options?l:{...l,...g.options},w=r(d);p(w).items.push({key:d,value:E,relativeKey:w.relativeKey,options:m})}return Promise.all([...f.values()].map(g=>h(g))).then(g=>g.flat())},c={hasItem(u,l={}){u=Te(u);const{relativeKey:h,driver:f}=r(u);return le(f.hasItem,h,l)},getItem(u,l={}){u=Te(u);const{relativeKey:h,driver:f}=r(u);return le(f.getItem,h,l).then(p=>yn(p))},getItems(u,l={}){return a(u,l,h=>h.driver.getItems?le(h.driver.getItems,h.items.map(f=>({key:f.relativeKey,options:f.options})),l).then(f=>f.map(p=>({key:jf(h.base,p.key),value:yn(p.value)}))):Promise.all(h.items.map(f=>le(h.driver.getItem,f.relativeKey,f.options).then(p=>({key:f.key,value:yn(p)})))))},getItemRaw(u,l={}){u=Te(u);const{relativeKey:h,driver:f}=r(u);return f.getItemRaw?le(f.getItemRaw,h,l):le(f.getItem,h,l).then(p=>Uf(p))},async setItem(u,l,h={}){if(l===void 0)return c.removeItem(u);u=Te(u);const{relativeKey:f,driver:p}=r(u);p.setItem&&(await le(p.setItem,f,bn(l),h),p.watch||i("update",u))},async setItems(u,l){await a(u,l,async h=>{if(h.driver.setItems)return le(h.driver.setItems,h.items.map(f=>({key:f.relativeKey,value:bn(f.value),options:f.options})),l);h.driver.setItem&&await Promise.all(h.items.map(f=>le(h.driver.setItem,f.relativeKey,bn(f.value),f.options)))})},async setItemRaw(u,l,h={}){if(l===void 0)return c.removeItem(u,h);u=Te(u);const{relativeKey:f,driver:p}=r(u);if(p.setItemRaw)await le(p.setItemRaw,f,l,h);else if(p.setItem)await le(p.setItem,f,$f(l),h);else return;p.watch||i("update",u)},async removeItem(u,l={}){typeof l=="boolean"&&(l={removeMeta:l}),u=Te(u);const{relativeKey:h,driver:f}=r(u);f.removeItem&&(await le(f.removeItem,h,l),(l.removeMeta||l.removeMata)&&await le(f.removeItem,h+"$",l),f.watch||i("remove",u))},async getMeta(u,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),u=Te(u);const{relativeKey:h,driver:f}=r(u),p=Object.create(null);if(f.getMeta&&Object.assign(p,await le(f.getMeta,h,l)),!l.nativeOnly){const g=await le(f.getItem,h+"$",l).then(y=>yn(y));g&&typeof g=="object"&&(typeof g.atime=="string"&&(g.atime=new Date(g.atime)),typeof g.mtime=="string"&&(g.mtime=new Date(g.mtime)),Object.assign(p,g))}return p},setMeta(u,l,h={}){return this.setItem(u+"$",l,h)},removeMeta(u,l={}){return this.removeItem(u+"$",l)},async getKeys(u,l={}){u=wn(u);const h=n(u,!0);let f=[];const p=[];let g=!0;for(const d of h){d.driver.flags?.maxDepth||(g=!1);const E=await le(d.driver.getKeys,d.relativeBase,l);for(const m of E){const w=d.mountpoint+Te(m);f.some(S=>w.startsWith(S))||p.push(w)}f=[d.mountpoint,...f.filter(m=>!m.startsWith(d.mountpoint))]}const y=l.maxDepth!==void 0&&!g;return p.filter(d=>(!y||kf(d,l.maxDepth))&&Mf(d,u))},async clear(u,l={}){u=wn(u),await Promise.all(n(u,!1).map(async h=>{if(h.driver.clear)return le(h.driver.clear,h.relativeBase,l);if(h.driver.removeItem){const f=await h.driver.getKeys(h.relativeBase||"",l);return Promise.all(f.map(p=>h.driver.removeItem(p,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>ko(u)))},async watch(u){return await s(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,l){if(u=wn(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((h,f)=>f.length-h.length)),e.mounts[u]=l,e.watching&&Promise.resolve(jo(l,i,u)).then(h=>{e.unwatch[u]=h}).catch(console.error),c},async unmount(u,l=!0){u=wn(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&(e.unwatch[u]?.(),delete e.unwatch[u]),l&&await ko(e.mounts[u]),e.mountpoints=e.mountpoints.filter(h=>h!==u),delete e.mounts[u])},getMount(u=""){u=Te(u)+":";const l=r(u);return{driver:l.driver,base:l.base}},getMounts(u="",l={}){return u=Te(u),n(u,l.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(u,l={})=>c.getKeys(u,l),get:(u,l={})=>c.getItem(u,l),set:(u,l,h={})=>c.setItem(u,l,h),has:(u,l={})=>c.hasItem(u,l),del:(u,l={})=>c.removeItem(u,l),remove:(u,l={})=>c.removeItem(u,l)};return c}function jo(t,e,r){return t.watch?t.watch((n,i)=>e(n,r+i)):()=>{}}async function ko(t){typeof t.dispose=="function"&&await le(t.dispose)}function Nt(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function Mo(t,e){const r=indexedDB.open(t);r.onupgradeneeded=()=>r.result.createObjectStore(e);const n=Nt(r);return(i,s)=>n.then(o=>s(o.transaction(e,i).objectStore(e)))}let pi;function Br(){return pi||(pi=Mo("keyval-store","keyval")),pi}function Vo(t,e=Br()){return e("readonly",r=>Nt(r.get(t)))}function qf(t,e,r=Br()){return r("readwrite",n=>(n.put(e,t),Nt(n.transaction)))}function Wf(t,e=Br()){return e("readwrite",r=>(r.delete(t),Nt(r.transaction)))}function Gf(t=Br()){return t("readwrite",e=>(e.clear(),Nt(e.transaction)))}function Yf(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Nt(t.transaction)}function Zf(t=Br()){return t("readonly",e=>{if(e.getAllKeys)return Nt(e.getAllKeys());const r=[];return Yf(e,n=>r.push(n.key)).then(()=>r)})}const Xf=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),Jf=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(n,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function Xt(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Jf(t)}catch{return t}}function Pt(t){return typeof t=="string"?t:Xf(t)||""}const Qf="idb-keyval";var ed=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=i=>e+i;let n;return t.dbName&&t.storeName&&(n=Mo(t.dbName,t.storeName)),{name:Qf,options:t,async hasItem(i){return!(typeof await Vo(r(i),n)>"u")},async getItem(i){return await Vo(r(i),n)??null},setItem(i,s){return qf(r(i),s,n)},removeItem(i){return Wf(r(i),n)},getKeys(){return Zf(n)},clear(){return Gf(n)}}};const td="WALLET_CONNECT_V2_INDEXED_DB",rd="keyvaluestorage";class nd{constructor(){this.indexedDb=Hf({driver:ed({dbName:td,storeName:rd})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,Pt(r))}async removeItem(e){await this.indexedDb.removeItem(e)}}var yi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},mn={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,n){this[r]=String(n)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof yi<"u"&&yi.localStorage?mn.exports=yi.localStorage:typeof window<"u"&&window.localStorage?mn.exports=window.localStorage:mn.exports=new e})();function id(t){var e;return[t[0],Xt((e=t[1])!=null?e:"")]}class sd{constructor(){this.localStorage=mn.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(id)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return Xt(r)}async setItem(e,r){this.localStorage.setItem(e,Pt(r))}async removeItem(e){this.localStorage.removeItem(e)}}const od="wc_storage_version",Ko=1,ad=async(t,e,r)=>{const n=od,i=await e.getItem(n);if(i&&i>=Ko){r(e);return}const s=await t.getKeys();if(!s.length){r(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const u=await t.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(n,Ko),r(e),cd(t,o)},cd=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};class ud{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new sd;this.storage=e;try{const r=new nd;ad(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}}function ld(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var hd=fd;function fd(t,e,r){var n=r&&r.stringify||ld,i=1;if(typeof t=="object"&&t!==null){var s=e.length+i;if(s===1)return t;var o=new Array(s);o[0]=n(t);for(var a=1;a<s;a++)o[a]=n(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var u="",l=1-i,h=-1,f=t&&t.length||0,p=0;p<f;){if(t.charCodeAt(p)===37&&p+1<f){switch(h=h>-1?h:0,t.charCodeAt(p+1)){case 100:case 102:if(l>=c||e[l]==null)break;h<p&&(u+=t.slice(h,p)),u+=Number(e[l]),h=p+2,p++;break;case 105:if(l>=c||e[l]==null)break;h<p&&(u+=t.slice(h,p)),u+=Math.floor(Number(e[l])),h=p+2,p++;break;case 79:case 111:case 106:if(l>=c||e[l]===void 0)break;h<p&&(u+=t.slice(h,p));var g=typeof e[l];if(g==="string"){u+="'"+e[l]+"'",h=p+2,p++;break}if(g==="function"){u+=e[l].name||"<anonymous>",h=p+2,p++;break}u+=n(e[l]),h=p+2,p++;break;case 115:if(l>=c)break;h<p&&(u+=t.slice(h,p)),u+=String(e[l]),h=p+2,p++;break;case 37:h<p&&(u+=t.slice(h,p)),u+="%",h=p+2,p++,l--;break}++l}++p}return h===-1?t:(h<f&&(u+=t.slice(h)),u)}const Ho=hd;var Et=et;const Rr=_d().console||{},dd={mapHttpRequest:vn,mapHttpResponse:vn,wrapRequestSerializer:wi,wrapResponseSerializer:wi,wrapErrorSerializer:wi,req:vn,res:vn,err:wd};function gd(t,e){return Array.isArray(t)?t.filter(function(n){return n!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function et(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||Rr;t.browser.write&&(t.browser.asObject=!0);const n=t.serializers||{},i=gd(t.browser.serialize,n);let s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const a=t.level||"info",c=Object.create(r);c.log||(c.log=Cr),Object.defineProperty(c,"levelVal",{get:l}),Object.defineProperty(c,"level",{get:h,set:f});const u={transmit:e,serialize:i,asObject:t.browser.asObject,levels:o,timestamp:md(t)};c.levels=et.levels,c.level=a,c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=Cr,c.serializers=n,c._serialize=i,c._stdErrSerialize=s,c.child=p,e&&(c._logEvent=bi());function l(){return this.level==="silent"?1/0:this.levels.values[this.level]}function h(){return this._level}function f(g){if(g!=="silent"&&!this.levels.values[g])throw Error("unknown level "+g);this._level=g,Jt(u,c,"error","log"),Jt(u,c,"fatal","error"),Jt(u,c,"warn","error"),Jt(u,c,"info","log"),Jt(u,c,"debug","log"),Jt(u,c,"trace","log")}function p(g,y){if(!g)throw new Error("missing bindings for child Pino");y=y||{},i&&g.serializers&&(y.serializers=g.serializers);const d=y.serializers;if(i&&d){var E=Object.assign({},n,d),m=t.browser.serialize===!0?Object.keys(E):i;delete g.serializers,En([g],m,E,this._stdErrSerialize)}function w(S){this._childLevel=(S._childLevel|0)+1,this.error=Qt(S,g,"error"),this.fatal=Qt(S,g,"fatal"),this.warn=Qt(S,g,"warn"),this.info=Qt(S,g,"info"),this.debug=Qt(S,g,"debug"),this.trace=Qt(S,g,"trace"),E&&(this.serializers=E,this._serialize=m),e&&(this._logEvent=bi([].concat(S._logEvent.bindings,g)))}return w.prototype=this,new w(this)}return c}et.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},et.stdSerializers=dd,et.stdTimeFunctions=Object.assign({},{nullTime:qo,epochTime:Wo,unixTime:Ed,isoTime:vd});function Jt(t,e,r,n){const i=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?Cr:i[r]?i[r]:Rr[r]||Rr[n]||Cr,pd(t,e,r)}function pd(t,e,r){!t.transmit&&e[r]===Cr||(e[r]=function(n){return function(){const s=t.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Rr?Rr:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];if(t.serialize&&!t.asObject&&En(o,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?n.call(a,yd(this,r,o,s)):n.apply(a,o),t.transmit){const u=t.transmit.level||e.level,l=et.levels.values[u],h=et.levels.values[r];if(h<l)return;bd(this,{ts:s,methodLevel:r,methodValue:h,transmitLevel:u,transmitValue:et.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},o)}}}(e[r]))}function yd(t,e,r,n){t._serialize&&En(r,t._serialize,t.serializers,t._stdErrSerialize);const i=r.slice();let s=i[0];const o={};n&&(o.time=n),o.level=et.levels.values[e];let a=(t._childLevel|0)+1;if(a<1&&(a=1),s!==null&&typeof s=="object"){for(;a--&&typeof i[0]=="object";)Object.assign(o,i.shift());s=i.length?Ho(i.shift(),i):void 0}else typeof s=="string"&&(s=Ho(i.shift(),i));return s!==void 0&&(o.msg=s),o}function En(t,e,r,n){for(const i in t)if(n&&t[i]instanceof Error)t[i]=et.stdSerializers.err(t[i]);else if(typeof t[i]=="object"&&!Array.isArray(t[i]))for(const s in t[i])e&&e.indexOf(s)>-1&&s in r&&(t[i][s]=r[s](t[i][s]))}function Qt(t,e,r){return function(){const n=new Array(1+arguments.length);n[0]=e;for(var i=1;i<n.length;i++)n[i]=arguments[i-1];return t[r].apply(this,n)}}function bd(t,e,r){const n=e.send,i=e.ts,s=e.methodLevel,o=e.methodValue,a=e.val,c=t._logEvent.bindings;En(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=i,t._logEvent.messages=r.filter(function(u){return c.indexOf(u)===-1}),t._logEvent.level.label=s,t._logEvent.level.value=o,n(s,t._logEvent,a),t._logEvent=bi(c)}function bi(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function wd(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function md(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?qo:Wo}function vn(){return{}}function wi(t){return t}function Cr(){}function qo(){return!1}function Wo(){return Date.now()}function Ed(){return Math.round(Date.now()/1e3)}function vd(){return new Date(Date.now()).toISOString()}function _d(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}const Sd={level:"info"},Nr="custom_context",mi=1e3*1024;class Id{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class Go{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new Id(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}}class Yo{constructor(e,r=mi){this.level=e??"error",this.levelValue=Et.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new Go(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===Et.levels.values.error?console.error(e):r===Et.levels.values.warn?console.warn(e):r===Et.levels.values.debug?console.debug(e):r===Et.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Pt({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new Go(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(Pt({extraMetadata:e})),new Blob(r,{type:"application/json"})}}class Dd{constructor(e,r=mi){this.baseChunkLogger=new Yo(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),n=document.createElement("a");n.href=r,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}}class Od{constructor(e,r=mi){this.baseChunkLogger=new Yo(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}}var xd=Object.defineProperty,Ad=Object.defineProperties,Td=Object.getOwnPropertyDescriptors,Zo=Object.getOwnPropertySymbols,Bd=Object.prototype.hasOwnProperty,Rd=Object.prototype.propertyIsEnumerable,Xo=(t,e,r)=>e in t?xd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_n=(t,e)=>{for(var r in e||(e={}))Bd.call(e,r)&&Xo(t,r,e[r]);if(Zo)for(var r of Zo(e))Rd.call(e,r)&&Xo(t,r,e[r]);return t},Sn=(t,e)=>Ad(t,Td(e));function Jo(t){return Sn(_n({},t),{level:t?.level||Sd.level})}function Cd(t,e=Nr){return t[e]||""}function Nd(t,e,r=Nr){return t[r]=e,t}function Ue(t,e=Nr){let r="";return typeof t.bindings>"u"?r=Cd(t,e):r=t.bindings().context||"",r}function Pd(t,e,r=Nr){const n=Ue(t,r);return n.trim()?`${n}/${e}`:e}function Be(t,e,r=Nr){const n=Pd(t,e,r),i=t.child({context:n});return Nd(i,n,r)}function Ld(t){var e,r;const n=new Dd((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Et(Sn(_n({},t.opts),{level:"trace",browser:Sn(_n({},(r=t.opts)==null?void 0:r.browser),{write:i=>n.write(i)})})),chunkLoggerController:n}}function $d(t){var e;const r=new Od((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Et(Sn(_n({},t.opts),{level:"trace"})),chunkLoggerController:r}}function Ud(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?Ld(t):$d(t)}var Fd=Object.defineProperty,zd=(t,e,r)=>e in t?Fd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Qo=(t,e,r)=>zd(t,typeof e!="symbol"?e+"":e,r);class jd extends Rt{constructor(e){super(),this.opts=e,Qo(this,"protocol","wc"),Qo(this,"version",2)}}var kd=Object.defineProperty,Md=(t,e,r)=>e in t?kd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Vd=(t,e,r)=>Md(t,typeof e!="symbol"?e+"":e,r);class Kd extends Rt{constructor(e,r){super(),this.core=e,this.logger=r,Vd(this,"records",new Map)}}class Hd{constructor(e,r){this.logger=e,this.core=r}}class qd extends Rt{constructor(e,r){super(),this.relayer=e,this.logger=r}}class Wd extends Rt{constructor(e){super()}}class Gd{constructor(e,r,n,i){this.core=e,this.logger=r,this.name=n}}class Yd extends Rt{constructor(e,r){super(),this.relayer=e,this.logger=r}}class Zd extends Rt{constructor(e,r){super(),this.core=e,this.logger=r}}class Xd{constructor(e,r,n){this.core=e,this.logger=r,this.store=n}}class Jd{constructor(e,r){this.projectId=e,this.logger=r}}class Qd{constructor(e,r,n){this.core=e,this.logger=r,this.telemetryEnabled=n}}const Ei="wc",vi=2,Pr="core",We=`${Ei}@2:${Pr}:`,ea={name:Pr,logger:"error"},ta={database:":memory:"},ra="crypto",_i="client_ed25519_seed",na=k.ONE_DAY,ia="keychain",sa="0.3",oa="messages",aa="0.3",Si=k.SIX_HOURS,ca="publisher",ua="irn",la="error",Ii="wss://relay.walletconnect.org",ha="relayer",be={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},fa="_subscription",Fe={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},da=.1,eg={database:":memory:"},In="2.21.0",tg=1e4,Lt={link_mode:"link_mode",relay:"relay"},Lr={inbound:"inbound",outbound:"outbound"},ga="0.3",pa="WALLETCONNECT_CLIENT_ID",Di="WALLETCONNECT_LINK_MODE_APPS",Re={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},rg=k.THIRTY_DAYS,ya="subscription",ba="0.3",ng=k.FIVE_SECONDS*1e3,wa="pairing",ma="0.3",ig=k.THIRTY_DAYS,er={wc_pairingDelete:{req:{ttl:k.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:k.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:k.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:k.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:k.ONE_DAY,prompt:!1,tag:0},res:{ttl:k.ONE_DAY,prompt:!1,tag:0}}},tr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Ke={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Ea="history",va="0.3",_a="expirer",He={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Sa="0.3",sg=k.ONE_DAY,Ia="verify-api",og="https://verify.walletconnect.com",Da="https://verify.walletconnect.org",$r=Da,Oa=`${$r}/v3`,xa=[og,Da],Aa="echo",Ta="https://echo.walletconnect.com",ag="event-client",tt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},ot={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},cg={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},ug={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},lg={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},hg={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},Ba=.1,Ra="event-client",Ca=86400,Na="https://pulse.walletconnect.org/batch";function fg(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Pa(t,...e){if(!fg(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function La(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function dg(t,e){Pa(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const rr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Oi=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function gg(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function $a(t){return typeof t=="string"&&(t=gg(t)),Pa(t),t}class pg{clone(){return this._cloneInto()}}function yg(t){const e=n=>t().update($a(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Ua(t=32){if(rr&&typeof rr.getRandomValues=="function")return rr.getRandomValues(new Uint8Array(t));if(rr&&typeof rr.randomBytes=="function")return rr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function bg(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}class wg extends pg{constructor(e,r,n,i){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Oi(this.buffer)}update(e){La(this);const{view:r,buffer:n,blockLen:i}=this;e=$a(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Oi(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){La(this),dg(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)r[h]=0;bg(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Oi(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%r&&e.buffer.set(n),e}}const Dn=BigInt(2**32-1),xi=BigInt(32);function Fa(t,e=!1){return e?{h:Number(t&Dn),l:Number(t>>xi&Dn)}:{h:Number(t>>xi&Dn)|0,l:Number(t&Dn)|0}}function mg(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=Fa(t[i],e);[r[i],n[i]]=[s,o]}return[r,n]}const Eg=(t,e)=>BigInt(t>>>0)<<xi|BigInt(e>>>0),vg=(t,e,r)=>t>>>r,_g=(t,e,r)=>t<<32-r|e>>>r,Sg=(t,e,r)=>t>>>r|e<<32-r,Ig=(t,e,r)=>t<<32-r|e>>>r,Dg=(t,e,r)=>t<<64-r|e>>>r-32,Og=(t,e,r)=>t>>>r-32|e<<64-r,xg=(t,e)=>e,Ag=(t,e)=>t,Tg=(t,e,r)=>t<<r|e>>>32-r,Bg=(t,e,r)=>e<<r|t>>>32-r,Rg=(t,e,r)=>e<<r-32|t>>>64-r,Cg=(t,e,r)=>t<<r-32|e>>>64-r;function Ng(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const Pg=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Lg=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,$g=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),Ug=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,Fg=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),zg=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,K={fromBig:Fa,split:mg,toBig:Eg,shrSH:vg,shrSL:_g,rotrSH:Sg,rotrSL:Ig,rotrBH:Dg,rotrBL:Og,rotr32H:xg,rotr32L:Ag,rotlSH:Tg,rotlSL:Bg,rotlBH:Rg,rotlBL:Cg,add:Ng,add3L:Pg,add3H:Lg,add4L:$g,add4H:Ug,add5H:zg,add5L:Fg},[jg,kg]=K.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),vt=new Uint32Array(80),_t=new Uint32Array(80);class Mg extends wg{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:f,Gh:p,Gl:g,Hh:y,Hl:d}=this;return[e,r,n,i,s,o,a,c,u,l,h,f,p,g,y,d]}set(e,r,n,i,s,o,a,c,u,l,h,f,p,g,y,d){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=f|0,this.Gh=p|0,this.Gl=g|0,this.Hh=y|0,this.Hl=d|0}process(e,r){for(let w=0;w<16;w++,r+=4)vt[w]=e.getUint32(r),_t[w]=e.getUint32(r+=4);for(let w=16;w<80;w++){const S=vt[w-15]|0,R=_t[w-15]|0,B=K.rotrSH(S,R,1)^K.rotrSH(S,R,8)^K.shrSH(S,R,7),D=K.rotrSL(S,R,1)^K.rotrSL(S,R,8)^K.shrSL(S,R,7),A=vt[w-2]|0,O=_t[w-2]|0,U=K.rotrSH(A,O,19)^K.rotrBH(A,O,61)^K.shrSH(A,O,6),C=K.rotrSL(A,O,19)^K.rotrBL(A,O,61)^K.shrSL(A,O,6),N=K.add4L(D,C,_t[w-7],_t[w-16]),j=K.add4H(N,B,U,vt[w-7],vt[w-16]);vt[w]=j|0,_t[w]=N|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:f,Fh:p,Fl:g,Gh:y,Gl:d,Hh:E,Hl:m}=this;for(let w=0;w<80;w++){const S=K.rotrSH(h,f,14)^K.rotrSH(h,f,18)^K.rotrBH(h,f,41),R=K.rotrSL(h,f,14)^K.rotrSL(h,f,18)^K.rotrBL(h,f,41),B=h&p^~h&y,D=f&g^~f&d,A=K.add5L(m,R,D,kg[w],_t[w]),O=K.add5H(A,E,S,B,jg[w],vt[w]),U=A|0,C=K.rotrSH(n,i,28)^K.rotrBH(n,i,34)^K.rotrBH(n,i,39),N=K.rotrSL(n,i,28)^K.rotrBL(n,i,34)^K.rotrBL(n,i,39),j=n&s^n&a^s&a,_=i&o^i&c^o&c;E=y|0,m=d|0,y=p|0,d=g|0,p=h|0,g=f|0,{h,l:f}=K.add(u|0,l|0,O|0,U|0),u=a|0,l=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const v=K.add3L(U,N,_);n=K.add3H(v,O,C,j),i=v|0}({h:n,l:i}=K.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=K.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=K.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=K.add(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:f}=K.add(this.Eh|0,this.El|0,h|0,f|0),{h:p,l:g}=K.add(this.Fh|0,this.Fl|0,p|0,g|0),{h:y,l:d}=K.add(this.Gh|0,this.Gl|0,y|0,d|0),{h:E,l:m}=K.add(this.Hh|0,this.Hl|0,E|0,m|0),this.set(n,i,s,o,a,c,u,l,h,f,p,g,y,d,E,m)}roundClean(){vt.fill(0),_t.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Vg=yg(()=>new Mg);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ai=BigInt(0),za=BigInt(1),Kg=BigInt(2);function Ti(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Bi(t){if(!Ti(t))throw new Error("Uint8Array expected")}function Ri(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const Hg=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ci(t){Bi(t);let e="";for(let r=0;r<t.length;r++)e+=Hg[t[r]];return e}function ja(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Ai:BigInt("0x"+t)}const at={_0:48,_9:57,A:65,F:70,a:97,f:102};function ka(t){if(t>=at._0&&t<=at._9)return t-at._0;if(t>=at.A&&t<=at.F)return t-(at.A-10);if(t>=at.a&&t<=at.f)return t-(at.a-10)}function Ma(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=ka(t.charCodeAt(s)),a=ka(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function qg(t){return ja(Ci(t))}function On(t){return Bi(t),ja(Ci(Uint8Array.from(t).reverse()))}function Va(t,e){return Ma(t.toString(16).padStart(e*2,"0"))}function Ni(t,e){return Va(t,e).reverse()}function ct(t,e,r){let n;if(typeof e=="string")try{n=Ma(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Ti(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function Ka(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Bi(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const Pi=t=>typeof t=="bigint"&&Ai<=t;function Wg(t,e,r){return Pi(t)&&Pi(e)&&Pi(r)&&e<=t&&t<r}function Ur(t,e,r,n){if(!Wg(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Gg(t){let e;for(e=0;t>Ai;t>>=za,e+=1);return e}const Yg=t=>(Kg<<BigInt(t-1))-za,Zg={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Ti(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Li(t,e,r={}){const n=(i,s,o)=>{const a=Zg[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function Ha(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const he=BigInt(0),ne=BigInt(1),$t=BigInt(2),Xg=BigInt(3),$i=BigInt(4),qa=BigInt(5),Wa=BigInt(8);function ae(t,e){const r=t%e;return r>=he?r:e+r}function Jg(t,e,r){if(e<he)throw new Error("invalid exponent, negatives unsupported");if(r<=he)throw new Error("invalid modulus");if(r===ne)return he;let n=ne;for(;e>he;)e&ne&&(n=n*t%r),t=t*t%r,e>>=ne;return n}function rt(t,e,r){let n=t;for(;e-- >he;)n*=n,n%=r;return n}function Ga(t,e){if(t===he)throw new Error("invert: expected non-zero number");if(e<=he)throw new Error("invert: expected positive modulus, got "+e);let r=ae(t,e),n=e,i=he,s=ne;for(;r!==he;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==ne)throw new Error("invert: does not exist");return ae(i,e)}function Qg(t){const e=(t-ne)/$t;let r,n,i;for(r=t-ne,n=0;r%$t===he;r/=$t,n++);for(i=$t;i<t&&Jg(i,e,t)!==t-ne;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+ne)/$i;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(r+ne)/$t;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,u=o.pow(o.mul(o.ONE,i),r),l=o.pow(a,s),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let f=1;for(let g=o.sqr(h);f<c&&!o.eql(g,o.ONE);f++)g=o.sqr(g);const p=o.pow(u,ne<<BigInt(c-f-1));u=o.sqr(p),l=o.mul(l,p),h=o.mul(h,u),c=f}return l}}function ep(t){if(t%$i===Xg){const e=(t+ne)/$i;return function(r,n){const i=r.pow(n,e);if(!r.eql(r.sqr(i),n))throw new Error("Cannot find square root");return i}}if(t%Wa===qa){const e=(t-qa)/Wa;return function(r,n){const i=r.mul(n,$t),s=r.pow(i,e),o=r.mul(n,s),a=r.mul(r.mul(o,$t),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return Qg(t)}const tp=(t,e)=>(ae(t,e)&ne)===ne,rp=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function np(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=rp.reduce((n,i)=>(n[i]="function",n),e);return Li(t,r)}function ip(t,e,r){if(r<he)throw new Error("invalid exponent, negatives unsupported");if(r===he)return t.ONE;if(r===ne)return e;let n=t.ONE,i=e;for(;r>he;)r&ne&&(n=t.mul(n,i)),i=t.sqr(i),r>>=ne;return n}function sp(t,e){const r=new Array(e.length),n=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),i=t.inv(n);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),i),r}function Ya(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Za(t,e,r=!1,n={}){if(t<=he)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Ya(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:Yg(i),ZERO:he,ONE:ne,create:c=>ae(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return he<=c&&c<t},is0:c=>c===he,isOdd:c=>(c&ne)===ne,neg:c=>ae(-c,t),eql:(c,u)=>c===u,sqr:c=>ae(c*c,t),add:(c,u)=>ae(c+u,t),sub:(c,u)=>ae(c-u,t),mul:(c,u)=>ae(c*u,t),pow:(c,u)=>ip(a,c,u),div:(c,u)=>ae(c*Ga(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Ga(c,t),sqrt:n.sqrt||(c=>(o||(o=ep(t)),o(a,c))),invertBatch:c=>sp(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>r?Ni(c,s):Va(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?On(c):qg(c)}});return Object.freeze(a)}const Xa=BigInt(0),xn=BigInt(1);function Ui(t,e){const r=e.negate();return t?r:e}function Ja(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Fi(t,e){Ja(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function op(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function ap(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const zi=new WeakMap,Qa=new WeakMap;function ji(t){return Qa.get(t)||1}function cp(t,e){return{constTimeNegate:Ui,hasPrecomputes(r){return ji(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>Xa;)n&xn&&(i=i.add(s)),s=s.double(),n>>=xn;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=Fi(n,e),o=[];let a=r,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){const{windows:s,windowSize:o}=Fi(r,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let f=0;f<s;f++){const p=f*o;let g=Number(i&u);i>>=h,g>o&&(g-=l,i+=xn);const y=p,d=p+Math.abs(g)-1,E=f%2!==0,m=g<0;g===0?c=c.add(Ui(E,n[y])):a=a.add(Ui(m,n[d]))}return{p:a,f:c}},wNAFUnsafe(r,n,i,s=t.ZERO){const{windows:o,windowSize:a}=Fi(r,e),c=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let h=0;h<o;h++){const f=h*a;if(i===Xa)break;let p=Number(i&c);if(i>>=l,p>a&&(p-=u,i+=xn),p===0)continue;let g=n[f+Math.abs(p)-1];p<0&&(g=g.negate()),s=s.add(g)}return s},getPrecomputes(r,n,i){let s=zi.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&zi.set(n,i(s))),s},wNAFCached(r,n,i){const s=ji(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=ji(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){Ja(n,e),Qa.set(r,n),zi.delete(r)}}}function up(t,e,r,n){if(op(r,t),ap(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=Gg(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o;let l=i;for(let h=u;h>=0;h-=o){c.fill(i);for(let p=0;p<n.length;p++){const g=n[p],y=Number(g>>BigInt(h)&BigInt(a));c[y]=c[y].add(r[p])}let f=i;for(let p=c.length-1,g=i;p>0;p--)g=g.add(c[p]),f=f.add(g);if(l=l.add(f),h!==0)for(let p=0;p<o;p++)l=l.double()}return l}function lp(t){return np(t.Fp),Li(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Ya(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const Ge=BigInt(0),Ce=BigInt(1),An=BigInt(2),hp=BigInt(8),fp={zip215:!0};function dp(t){const e=lp(t);return Li(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function gp(t){const e=dp(t),{Fp:r,n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,u=An<<BigInt(a*8)-Ce,l=r.create,h=Za(e.n,e.nBitLength),f=e.uvRatio||((v,b)=>{try{return{isValid:!0,value:r.sqrt(v*r.inv(b))}}catch{return{isValid:!1,value:Ge}}}),p=e.adjustScalarBytes||(v=>v),g=e.domain||((v,b,I)=>{if(Ri("phflag",I),b.length||I)throw new Error("Contexts/pre-hash are not supported");return v});function y(v,b){Ur("coordinate "+v,b,Ge,u)}function d(v){if(!(v instanceof w))throw new Error("ExtendedPoint expected")}const E=Ha((v,b)=>{const{ex:I,ey:T,ez:x}=v,P=v.is0();b==null&&(b=P?hp:r.inv(x));const $=l(I*b),F=l(T*b),z=l(x*b);if(P)return{x:Ge,y:Ce};if(z!==Ce)throw new Error("invZ was invalid");return{x:$,y:F}}),m=Ha(v=>{const{a:b,d:I}=e;if(v.is0())throw new Error("bad point: ZERO");const{ex:T,ey:x,ez:P,et:$}=v,F=l(T*T),z=l(x*x),M=l(P*P),V=l(M*M),H=l(F*b),re=l(M*l(H+z)),Y=l(V+l(I*l(F*z)));if(re!==Y)throw new Error("bad point: equation left != right (1)");const Z=l(T*x),Se=l(P*$);if(Z!==Se)throw new Error("bad point: equation left != right (2)");return!0});class w{constructor(b,I,T,x){this.ex=b,this.ey=I,this.ez=T,this.et=x,y("x",b),y("y",I),y("z",T),y("t",x),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(b){if(b instanceof w)throw new Error("extended point not allowed");const{x:I,y:T}=b||{};return y("x",I),y("y",T),new w(I,T,Ce,l(I*T))}static normalizeZ(b){const I=r.invertBatch(b.map(T=>T.ez));return b.map((T,x)=>T.toAffine(I[x])).map(w.fromAffine)}static msm(b,I){return up(w,h,b,I)}_setWindowSize(b){B.setWindowSize(this,b)}assertValidity(){m(this)}equals(b){d(b);const{ex:I,ey:T,ez:x}=this,{ex:P,ey:$,ez:F}=b,z=l(I*F),M=l(P*x),V=l(T*F),H=l($*x);return z===M&&V===H}is0(){return this.equals(w.ZERO)}negate(){return new w(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:b}=e,{ex:I,ey:T,ez:x}=this,P=l(I*I),$=l(T*T),F=l(An*l(x*x)),z=l(b*P),M=I+T,V=l(l(M*M)-P-$),H=z+$,re=H-F,Y=z-$,Z=l(V*re),Se=l(H*Y),ce=l(V*Y),ue=l(re*H);return new w(Z,Se,ue,ce)}add(b){d(b);const{a:I,d:T}=e,{ex:x,ey:P,ez:$,et:F}=this,{ex:z,ey:M,ez:V,et:H}=b;if(I===BigInt(-1)){const zh=l((P-x)*(M+z)),jh=l((P+x)*(M-z)),yo=l(jh-zh);if(yo===Ge)return this.double();const kh=l($*An*H),Mh=l(F*An*V),Vh=Mh+kh,Kh=jh+zh,Hh=Mh-kh,T2=l(Vh*yo),B2=l(Kh*Hh),R2=l(Vh*Hh),C2=l(yo*Kh);return new w(T2,B2,C2,R2)}const re=l(x*z),Y=l(P*M),Z=l(F*T*H),Se=l($*V),ce=l((x+P)*(z+M)-re-Y),ue=Se-Z,De=Se+Z,Oe=l(Y-I*re),Gt=l(ce*ue),O2=l(De*Oe),x2=l(ce*Oe),A2=l(ue*De);return new w(Gt,O2,A2,x2)}subtract(b){return this.add(b.negate())}wNAF(b){return B.wNAFCached(this,b,w.normalizeZ)}multiply(b){const I=b;Ur("scalar",I,Ce,n);const{p:T,f:x}=this.wNAF(I);return w.normalizeZ([T,x])[0]}multiplyUnsafe(b,I=w.ZERO){const T=b;return Ur("scalar",T,Ge,n),T===Ge?R:this.is0()||T===Ce?this:B.wNAFCachedUnsafe(this,T,w.normalizeZ,I)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return B.unsafeLadder(this,n).is0()}toAffine(b){return E(this,b)}clearCofactor(){const{h:b}=e;return b===Ce?this:this.multiplyUnsafe(b)}static fromHex(b,I=!1){const{d:T,a:x}=e,P=r.BYTES;b=ct("pointHex",b,P),Ri("zip215",I);const $=b.slice(),F=b[P-1];$[P-1]=F&-129;const z=On($),M=I?u:r.ORDER;Ur("pointHex.y",z,Ge,M);const V=l(z*z),H=l(V-Ce),re=l(T*V-x);let{isValid:Y,value:Z}=f(H,re);if(!Y)throw new Error("Point.fromHex: invalid y coordinate");const Se=(Z&Ce)===Ce,ce=(F&128)!==0;if(!I&&Z===Ge&&ce)throw new Error("Point.fromHex: x=0 and x_0=1");return ce!==Se&&(Z=l(-Z)),w.fromAffine({x:Z,y:z})}static fromPrivateKey(b){return O(b).point}toRawBytes(){const{x:b,y:I}=this.toAffine(),T=Ni(I,r.BYTES);return T[T.length-1]|=b&Ce?128:0,T}toHex(){return Ci(this.toRawBytes())}}w.BASE=new w(e.Gx,e.Gy,Ce,l(e.Gx*e.Gy)),w.ZERO=new w(Ge,Ce,Ce,Ge);const{BASE:S,ZERO:R}=w,B=cp(w,a*8);function D(v){return ae(v,n)}function A(v){return D(On(v))}function O(v){const b=r.BYTES;v=ct("private key",v,b);const I=ct("hashed private key",s(v),2*b),T=p(I.slice(0,b)),x=I.slice(b,2*b),P=A(T),$=S.multiply(P),F=$.toRawBytes();return{head:T,prefix:x,scalar:P,point:$,pointBytes:F}}function U(v){return O(v).pointBytes}function C(v=new Uint8Array,...b){const I=Ka(...b);return A(s(g(I,ct("context",v),!!i)))}function N(v,b,I={}){v=ct("message",v),i&&(v=i(v));const{prefix:T,scalar:x,pointBytes:P}=O(b),$=C(I.context,T,v),F=S.multiply($).toRawBytes(),z=C(I.context,F,P,v),M=D($+z*x);Ur("signature.s",M,Ge,n);const V=Ka(F,Ni(M,r.BYTES));return ct("result",V,r.BYTES*2)}const j=fp;function _(v,b,I,T=j){const{context:x,zip215:P}=T,$=r.BYTES;v=ct("signature",v,2*$),b=ct("message",b),I=ct("publicKey",I,$),P!==void 0&&Ri("zip215",P),i&&(b=i(b));const F=On(v.slice($,2*$));let z,M,V;try{z=w.fromHex(I,P),M=w.fromHex(v.slice(0,$),P),V=S.multiplyUnsafe(F)}catch{return!1}if(!P&&z.isSmallOrder())return!1;const H=C(x,M.toRawBytes(),z.toRawBytes(),b);return M.add(z.multiplyUnsafe(H)).subtract(V).clearCofactor().equals(w.ZERO)}return S._setWindowSize(8),{CURVE:e,getPublicKey:U,sign:N,verify:_,ExtendedPoint:w,utils:{getExtendedPublicKey:O,randomPrivateKey:()=>o(r.BYTES),precompute(v=8,b=w.BASE){return b._setWindowSize(v),b.multiply(BigInt(3)),b}}}}BigInt(0),BigInt(1);const ki=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),ec=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const pp=BigInt(1),tc=BigInt(2);BigInt(3);const yp=BigInt(5),bp=BigInt(8);function wp(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=ki,o=t*t%s*t%s,a=rt(o,tc,s)*o%s,c=rt(a,pp,s)*t%s,u=rt(c,yp,s)*c%s,l=rt(u,e,s)*u%s,h=rt(l,r,s)*l%s,f=rt(h,n,s)*h%s,p=rt(f,i,s)*f%s,g=rt(p,i,s)*f%s,y=rt(g,e,s)*u%s;return{pow_p_5_8:rt(y,tc,s)*t%s,b2:o}}function mp(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function Ep(t,e){const r=ki,n=ae(e*e*e,r),i=ae(n*n*e,r),s=wp(t*i).pow_p_5_8;let o=ae(t*n*s,r);const a=ae(e*o*o,r),c=o,u=ae(o*ec,r),l=a===t,h=a===ae(-t,r),f=a===ae(-t*ec,r);return l&&(o=c),(h||f)&&(o=u),tp(o,r)&&(o=ae(-o,r)),{isValid:l||h,value:o}}const vp=Za(ki,void 0,!0),_p={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:vp,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:bp,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Vg,randomBytes:Ua,adjustScalarBytes:mp,uvRatio:Ep},rc=gp(_p),Sp="EdDSA",Ip="JWT",Tn=".",Bn="base64url",nc="utf8",ic="utf8",Dp=":",Op="did",xp="key",sc="base58btc",Ap="z",Tp="K36",Bp=32;function Mi(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function oc(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Mi(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function ac(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=oc(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return Mi(r)}function Rp(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var y=0,d=0,E=0,m=g.length;E!==m&&g[E]===0;)E++,y++;for(var w=(m-E)*l+1>>>0,S=new Uint8Array(w);E!==m;){for(var R=g[E],B=0,D=w-1;(R!==0||B<d)&&D!==-1;D--,B++)R+=256*S[D]>>>0,S[D]=R%a>>>0,R=R/a>>>0;if(R!==0)throw new Error("Non-zero carry");d=B,E++}for(var A=w-d;A!==w&&S[A]===0;)A++;for(var O=c.repeat(y);A<w;++A)O+=t.charAt(S[A]);return O}function f(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var y=0;if(g[y]!==" "){for(var d=0,E=0;g[y]===c;)d++,y++;for(var m=(g.length-y)*u+1>>>0,w=new Uint8Array(m);g[y];){var S=r[g.charCodeAt(y)];if(S===255)return;for(var R=0,B=m-1;(S!==0||R<E)&&B!==-1;B--,R++)S+=a*w[B]>>>0,w[B]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");E=R,y++}if(g[y]!==" "){for(var D=m-E;D!==m&&w[D]===0;)D++;for(var A=new Uint8Array(d+(m-D)),O=d;D!==m;)A[O++]=w[D++];return A}}}function p(g){var y=f(g);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var Cp=Rp,Np=Cp;const cc=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Pp=t=>new TextEncoder().encode(t),Lp=t=>new TextDecoder().decode(t);class $p{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Up{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return uc(this,e)}}class Fp{constructor(e){this.decoders=e}or(e){return uc(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const uc=(t,e)=>new Fp({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class zp{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new $p(e,r,n),this.decoder=new Up(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Rn=({name:t,prefix:e,encode:r,decode:n})=>new zp(t,e,r,n),Fr=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=Np(r,e);return Rn({prefix:t,name:e,encode:n,decode:s=>cc(i(s))})},jp=(t,e,r,n)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},kp=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},we=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Rn({prefix:e,name:t,encode(i){return kp(i,n,r)},decode(i){return jp(i,n,r,t)}}),Mp=Rn({prefix:"\0",name:"identity",encode:t=>Lp(t),decode:t=>Pp(t)});var Vp=Object.freeze({__proto__:null,identity:Mp});const Kp=we({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Hp=Object.freeze({__proto__:null,base2:Kp});const qp=we({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Wp=Object.freeze({__proto__:null,base8:qp});const Gp=Fr({prefix:"9",name:"base10",alphabet:"0123456789"});var Yp=Object.freeze({__proto__:null,base10:Gp});const Zp=we({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Xp=we({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Jp=Object.freeze({__proto__:null,base16:Zp,base16upper:Xp});const Qp=we({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ey=we({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ty=we({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ry=we({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ny=we({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),iy=we({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),sy=we({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),oy=we({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ay=we({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var cy=Object.freeze({__proto__:null,base32:Qp,base32upper:ey,base32pad:ty,base32padupper:ry,base32hex:ny,base32hexupper:iy,base32hexpad:sy,base32hexpadupper:oy,base32z:ay});const uy=Fr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ly=Fr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var hy=Object.freeze({__proto__:null,base36:uy,base36upper:ly});const fy=Fr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),dy=Fr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var gy=Object.freeze({__proto__:null,base58btc:fy,base58flickr:dy});const py=we({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),yy=we({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),by=we({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),wy=we({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var my=Object.freeze({__proto__:null,base64:py,base64pad:yy,base64url:by,base64urlpad:wy});const lc=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Ey=lc.reduce((t,e,r)=>(t[r]=e,t),[]),vy=lc.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function _y(t){return t.reduce((e,r)=>(e+=Ey[r],e),"")}function Sy(t){const e=[];for(const r of t){const n=vy[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const Iy=Rn({prefix:"\u{1F680}",name:"base256emoji",encode:_y,decode:Sy});var Dy=Object.freeze({__proto__:null,base256emoji:Iy}),Oy=fc,hc=128,xy=127,Ay=~xy,Ty=Math.pow(2,31);function fc(t,e,r){e=e||[],r=r||0;for(var n=r;t>=Ty;)e[r++]=t&255|hc,t/=128;for(;t&Ay;)e[r++]=t&255|hc,t>>>=7;return e[r]=t|0,fc.bytes=r-n+1,e}var By=Vi,Ry=128,dc=127;function Vi(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw Vi.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&dc)<<i:(o&dc)*Math.pow(2,i),i+=7}while(o>=Ry);return Vi.bytes=s-n,r}var Cy=Math.pow(2,7),Ny=Math.pow(2,14),Py=Math.pow(2,21),Ly=Math.pow(2,28),$y=Math.pow(2,35),Uy=Math.pow(2,42),Fy=Math.pow(2,49),zy=Math.pow(2,56),jy=Math.pow(2,63),ky=function(t){return t<Cy?1:t<Ny?2:t<Py?3:t<Ly?4:t<$y?5:t<Uy?6:t<Fy?7:t<zy?8:t<jy?9:10},My={encode:Oy,decode:By,encodingLength:ky},gc=My;const pc=(t,e,r=0)=>(gc.encode(t,e,r),e),yc=t=>gc.encodingLength(t),Ki=(t,e)=>{const r=e.byteLength,n=yc(t),i=n+yc(r),s=new Uint8Array(i+r);return pc(t,s,0),pc(r,s,n),s.set(e,i),new Vy(t,r,e,s)};class Vy{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}}const bc=({name:t,code:e,encode:r})=>new Ky(t,e,r);class Ky{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Ki(this.code,r):r.then(n=>Ki(this.code,n))}else throw Error("Unknown type, must be binary type")}}const wc=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Hy=bc({name:"sha2-256",code:18,encode:wc("SHA-256")}),qy=bc({name:"sha2-512",code:19,encode:wc("SHA-512")});var Wy=Object.freeze({__proto__:null,sha256:Hy,sha512:qy});const mc=0,Gy="identity",Ec=cc;var Yy=Object.freeze({__proto__:null,identity:{code:mc,name:Gy,encode:Ec,digest:t=>Ki(mc,Ec(t))}});new TextEncoder,new TextDecoder;const vc={...Vp,...Hp,...Wp,...Yp,...Jp,...cy,...hy,...gy,...my,...Dy};({...Wy,...Yy});function _c(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const Sc=_c("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Hi=_c("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=oc(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Ic={utf8:Sc,"utf-8":Sc,hex:vc.base16,latin1:Hi,ascii:Hi,binary:Hi,...vc};function Cn(t,e="utf8"){const r=Ic[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function nr(t,e="utf8"){const r=Ic[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Mi(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Dc(t){return Xt(Cn(nr(t,Bn),nc))}function Nn(t){return Cn(nr(Pt(t),nc),Bn)}function Oc(t){const e=nr(Tp,sc),r=Ap+Cn(ac([e,t]),sc);return[Op,xp,r].join(Dp)}function Zy(t){return Cn(t,Bn)}function Xy(t){return nr(t,Bn)}function Jy(t){return nr([Nn(t.header),Nn(t.payload)].join(Tn),ic)}function Qy(t){return[Nn(t.header),Nn(t.payload),Zy(t.signature)].join(Tn)}function qi(t){const e=t.split(Tn),r=Dc(e[0]),n=Dc(e[1]),i=Xy(e[2]),s=nr(e.slice(0,2).join(Tn),ic);return{header:r,payload:n,signature:i,data:s}}function xc(t=Ua(Bp)){const e=rc.getPublicKey(t);return{secretKey:ac([t,e]),publicKey:e}}async function eb(t,e,r,n,i=k.fromMiliseconds(Date.now())){const s={alg:Sp,typ:Ip},o=Oc(n.publicKey),a=i+r,c={iss:o,sub:t,aud:e,iat:i,exp:a},u=Jy({header:s,payload:c}),l=rc.sign(u,n.secretKey.slice(0,32));return Qy({header:s,payload:c,signature:l})}function tb(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var y=0,d=0,E=0,m=g.length;E!==m&&g[E]===0;)E++,y++;for(var w=(m-E)*l+1>>>0,S=new Uint8Array(w);E!==m;){for(var R=g[E],B=0,D=w-1;(R!==0||B<d)&&D!==-1;D--,B++)R+=256*S[D]>>>0,S[D]=R%a>>>0,R=R/a>>>0;if(R!==0)throw new Error("Non-zero carry");d=B,E++}for(var A=w-d;A!==w&&S[A]===0;)A++;for(var O=c.repeat(y);A<w;++A)O+=t.charAt(S[A]);return O}function f(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var y=0;if(g[y]!==" "){for(var d=0,E=0;g[y]===c;)d++,y++;for(var m=(g.length-y)*u+1>>>0,w=new Uint8Array(m);g[y];){var S=r[g.charCodeAt(y)];if(S===255)return;for(var R=0,B=m-1;(S!==0||R<E)&&B!==-1;B--,R++)S+=a*w[B]>>>0,w[B]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");E=R,y++}if(g[y]!==" "){for(var D=m-E;D!==m&&w[D]===0;)D++;for(var A=new Uint8Array(d+(m-D)),O=d;D!==m;)A[O++]=w[D++];return A}}}function p(g){var y=f(g);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var rb=tb,nb=rb;const Ac=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},ib=t=>new TextEncoder().encode(t),sb=t=>new TextDecoder().decode(t);class ob{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class ab{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Tc(this,e)}}class cb{constructor(e){this.decoders=e}or(e){return Tc(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Tc=(t,e)=>new cb({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class ub{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new ob(e,r,n),this.decoder=new ab(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Pn=({name:t,prefix:e,encode:r,decode:n})=>new ub(t,e,r,n),zr=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=nb(r,e);return Pn({prefix:t,name:e,encode:n,decode:s=>Ac(i(s))})},lb=(t,e,r,n)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},hb=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},me=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Pn({prefix:e,name:t,encode(i){return hb(i,n,r)},decode(i){return lb(i,n,r,t)}}),fb=Pn({prefix:"\0",name:"identity",encode:t=>sb(t),decode:t=>ib(t)});var db=Object.freeze({__proto__:null,identity:fb});const gb=me({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var pb=Object.freeze({__proto__:null,base2:gb});const yb=me({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var bb=Object.freeze({__proto__:null,base8:yb});const wb=zr({prefix:"9",name:"base10",alphabet:"0123456789"});var mb=Object.freeze({__proto__:null,base10:wb});const Eb=me({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),vb=me({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var _b=Object.freeze({__proto__:null,base16:Eb,base16upper:vb});const Sb=me({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ib=me({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Db=me({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ob=me({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),xb=me({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ab=me({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Tb=me({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Bb=me({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Rb=me({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Cb=Object.freeze({__proto__:null,base32:Sb,base32upper:Ib,base32pad:Db,base32padupper:Ob,base32hex:xb,base32hexupper:Ab,base32hexpad:Tb,base32hexpadupper:Bb,base32z:Rb});const Nb=zr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Pb=zr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Lb=Object.freeze({__proto__:null,base36:Nb,base36upper:Pb});const $b=zr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ub=zr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Fb=Object.freeze({__proto__:null,base58btc:$b,base58flickr:Ub});const zb=me({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),jb=me({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),kb=me({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Mb=me({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Vb=Object.freeze({__proto__:null,base64:zb,base64pad:jb,base64url:kb,base64urlpad:Mb});const Bc=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Kb=Bc.reduce((t,e,r)=>(t[r]=e,t),[]),Hb=Bc.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function qb(t){return t.reduce((e,r)=>(e+=Kb[r],e),"")}function Wb(t){const e=[];for(const r of t){const n=Hb[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const Gb=Pn({prefix:"\u{1F680}",name:"base256emoji",encode:qb,decode:Wb});var Yb=Object.freeze({__proto__:null,base256emoji:Gb}),Zb=Cc,Rc=128,Xb=127,Jb=~Xb,Qb=Math.pow(2,31);function Cc(t,e,r){e=e||[],r=r||0;for(var n=r;t>=Qb;)e[r++]=t&255|Rc,t/=128;for(;t&Jb;)e[r++]=t&255|Rc,t>>>=7;return e[r]=t|0,Cc.bytes=r-n+1,e}var ew=Wi,tw=128,Nc=127;function Wi(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw Wi.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&Nc)<<i:(o&Nc)*Math.pow(2,i),i+=7}while(o>=tw);return Wi.bytes=s-n,r}var rw=Math.pow(2,7),nw=Math.pow(2,14),iw=Math.pow(2,21),sw=Math.pow(2,28),ow=Math.pow(2,35),aw=Math.pow(2,42),cw=Math.pow(2,49),uw=Math.pow(2,56),lw=Math.pow(2,63),hw=function(t){return t<rw?1:t<nw?2:t<iw?3:t<sw?4:t<ow?5:t<aw?6:t<cw?7:t<uw?8:t<lw?9:10},fw={encode:Zb,decode:ew,encodingLength:hw},Pc=fw;const Lc=(t,e,r=0)=>(Pc.encode(t,e,r),e),$c=t=>Pc.encodingLength(t),Gi=(t,e)=>{const r=e.byteLength,n=$c(t),i=n+$c(r),s=new Uint8Array(i+r);return Lc(t,s,0),Lc(r,s,n),s.set(e,i),new dw(t,r,e,s)};class dw{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}}const Uc=({name:t,code:e,encode:r})=>new gw(t,e,r);class gw{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Gi(this.code,r):r.then(n=>Gi(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Fc=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),pw=Uc({name:"sha2-256",code:18,encode:Fc("SHA-256")}),yw=Uc({name:"sha2-512",code:19,encode:Fc("SHA-512")});var bw=Object.freeze({__proto__:null,sha256:pw,sha512:yw});const zc=0,ww="identity",jc=Ac;var mw=Object.freeze({__proto__:null,identity:{code:zc,name:ww,encode:jc,digest:t=>Gi(zc,jc(t))}});new TextEncoder,new TextDecoder;const kc={...db,...pb,...bb,...mb,..._b,...Cb,...Lb,...Fb,...Vb,...Yb};({...bw,...mw});function Mc(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Vc(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const Kc=Vc("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Yi=Vc("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Mc(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Hc={utf8:Kc,"utf-8":Kc,hex:kc.base16,latin1:Yi,ascii:Yi,binary:Yi,...kc};function ze(t,e="utf8"){const r=Hc[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}var qc=function(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},Ew=function(){function t(e,r,n){this.name=e,this.version=r,this.os=n,this.type="browser"}return t}(),vw=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),_w=function(){function t(e,r,n,i){this.name=e,this.version=r,this.os=n,this.bot=i,this.type="bot-device"}return t}(),Sw=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),Iw=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),Dw=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Ow=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Wc=3,xw=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Dw]],Gc=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Aw(t){return t?Yc(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Iw:typeof navigator<"u"?Yc(navigator.userAgent):Rw()}function Tw(t){return t!==""&&xw.reduce(function(e,r){var n=r[0],i=r[1];if(e)return e;var s=i.exec(t);return!!s&&[n,s]},!1)}function Yc(t){var e=Tw(t);if(!e)return null;var r=e[0],n=e[1];if(r==="searchbot")return new Sw;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<Wc&&(i=qc(qc([],i,!0),Cw(Wc-i.length),!0)):i=[];var s=i.join("."),o=Bw(t),a=Ow.exec(t);return a&&a[1]?new _w(r,s,o,a[1]):new Ew(r,s,o)}function Bw(t){for(var e=0,r=Gc.length;e<r;e++){var n=Gc[e],i=n[0],s=n[1],o=s.exec(t);if(o)return i}return null}function Rw(){var t=typeof process<"u"&&process.version;return t?new vw(process.version.slice(1)):null}function Cw(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var ee={};Object.defineProperty(ee,"__esModule",{value:!0}),ee.getLocalStorage=ee.getLocalStorageOrThrow=ee.getCrypto=ee.getCryptoOrThrow=Zc=ee.getLocation=ee.getLocationOrThrow=Zi=ee.getNavigator=ee.getNavigatorOrThrow=sr=ee.getDocument=ee.getDocumentOrThrow=ee.getFromWindowOrThrow=ee.getFromWindow=void 0;function Ut(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}ee.getFromWindow=Ut;function ir(t){const e=Ut(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}ee.getFromWindowOrThrow=ir;function Nw(){return ir("document")}ee.getDocumentOrThrow=Nw;function Pw(){return Ut("document")}var sr=ee.getDocument=Pw;function Lw(){return ir("navigator")}ee.getNavigatorOrThrow=Lw;function $w(){return Ut("navigator")}var Zi=ee.getNavigator=$w;function Uw(){return ir("location")}ee.getLocationOrThrow=Uw;function Fw(){return Ut("location")}var Zc=ee.getLocation=Fw;function zw(){return ir("crypto")}ee.getCryptoOrThrow=zw;function jw(){return Ut("crypto")}ee.getCrypto=jw;function kw(){return ir("localStorage")}ee.getLocalStorageOrThrow=kw;function Mw(){return Ut("localStorage")}ee.getLocalStorage=Mw;var Xi={};Object.defineProperty(Xi,"__esModule",{value:!0});var Xc=Xi.getWindowMetadata=void 0;const Jc=ee;function Vw(){let t,e;try{t=Jc.getDocumentOrThrow(),e=Jc.getLocationOrThrow()}catch{return null}function r(){const h=t.getElementsByTagName("link"),f=[];for(let p=0;p<h.length;p++){const g=h[p],y=g.getAttribute("rel");if(y&&y.toLowerCase().indexOf("icon")>-1){const d=g.getAttribute("href");if(d)if(d.toLowerCase().indexOf("https:")===-1&&d.toLowerCase().indexOf("http:")===-1&&d.indexOf("//")!==0){let E=e.protocol+"//"+e.host;if(d.indexOf("/")===0)E+=d;else{const m=e.pathname.split("/");m.pop();const w=m.join("/");E+=w+"/"+d}f.push(E)}else if(d.indexOf("//")===0){const E=e.protocol+d;f.push(E)}else f.push(d)}}return f}function n(...h){const f=t.getElementsByTagName("meta");for(let p=0;p<f.length;p++){const g=f[p],y=["itemprop","property","name"].map(d=>g.getAttribute(d)).filter(d=>d?h.includes(d):!1);if(y.length&&y){const d=g.getAttribute("content");if(d)return d}}return""}function i(){let h=n("name","og:site_name","og:title","twitter:title");return h||(h=t.title),h}function s(){return n("description","og:description","twitter:description","keywords")}const o=i(),a=s(),c=e.origin,u=r();return{description:a,url:c,icons:u,name:o}}Xc=Xi.getWindowMetadata=Vw;function Ln(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Kw(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function jr(t,...e){if(!Kw(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Hw(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ln(t.outputLen),Ln(t.blockLen)}function or(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Qc(t,e){jr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const $n=BigInt(2**32-1),eu=BigInt(32);function qw(t,e=!1){return e?{h:Number(t&$n),l:Number(t>>eu&$n)}:{h:Number(t>>eu&$n)|0,l:Number(t&$n)|0}}function Ww(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=qw(t[i],e);[r[i],n[i]]=[s,o]}return[r,n]}const Gw=(t,e,r)=>t<<r|e>>>32-r,Yw=(t,e,r)=>e<<r|t>>>32-r,Zw=(t,e,r)=>e<<r-32|t>>>64-r,Xw=(t,e,r)=>t<<r-32|e>>>64-r,ar=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Jw(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Ji(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function nt(t,e){return t<<32-e|t>>>e}const tu=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Qw(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function ru(t){for(let e=0;e<t.length;e++)t[e]=Qw(t[e])}function e0(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Un(t){return typeof t=="string"&&(t=e0(t)),jr(t),t}function t0(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];jr(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}class Qi{clone(){return this._cloneInto()}}function nu(t){const e=n=>t().update(Un(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function r0(t=32){if(ar&&typeof ar.getRandomValues=="function")return ar.getRandomValues(new Uint8Array(t));if(ar&&typeof ar.randomBytes=="function")return ar.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const iu=[],su=[],ou=[],n0=BigInt(0),kr=BigInt(1),i0=BigInt(2),s0=BigInt(7),o0=BigInt(256),a0=BigInt(113);for(let t=0,e=kr,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],iu.push(2*(5*n+r)),su.push((t+1)*(t+2)/2%64);let i=n0;for(let s=0;s<7;s++)e=(e<<kr^(e>>s0)*a0)%o0,e&i0&&(i^=kr<<(kr<<BigInt(s))-kr);ou.push(i)}const[c0,u0]=Ww(ou,!0),au=(t,e,r)=>r>32?Zw(t,e,r):Gw(t,e,r),cu=(t,e,r)=>r>32?Xw(t,e,r):Yw(t,e,r);function l0(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=au(u,l,1)^r[a],f=cu(u,l,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=f}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=su[o],c=au(i,s,a),u=cu(i,s,a),l=iu[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=c0[n],t[1]^=u0[n]}r.fill(0)}class es extends Qi{constructor(e,r,n,i=!1,s=24){if(super(),this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Ln(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Jw(this.state)}keccak(){tu||ru(this.state32),l0(this.state32,this.rounds),tu||ru(this.state32),this.posOut=0,this.pos=0}update(e){or(this);const{blockLen:r,state:n}=this;e=Un(e);const i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){or(this,!1),jr(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Ln(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Qc(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new es(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const h0=((t,e,r)=>nu(()=>new es(e,t,r)))(1,136,256/8);class f0 extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}function d0(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function g0(t,e,r){return t&e^~t&r}function p0(t,e,r){return t&e^t&r^e&r}class y0 extends Qi{constructor(e,r,n,i){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ji(this.buffer)}update(e){or(this);const{view:r,buffer:n,blockLen:i}=this;e=Un(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Ji(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){or(this),Qc(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)r[h]=0;d0(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Ji(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%r&&e.buffer.set(n),e}}const b0=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),St=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),It=new Uint32Array(64);class w0 extends y0{constructor(){super(64,32,8,!1),this.A=St[0]|0,this.B=St[1]|0,this.C=St[2]|0,this.D=St[3]|0,this.E=St[4]|0,this.F=St[5]|0,this.G=St[6]|0,this.H=St[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)It[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=It[h-15],p=It[h-2],g=nt(f,7)^nt(f,18)^f>>>3,y=nt(p,17)^nt(p,19)^p>>>10;It[h]=y+It[h-7]+g+It[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const f=nt(a,6)^nt(a,11)^nt(a,25),p=l+f+g0(a,c,u)+b0[h]+It[h]|0,y=(nt(n,2)^nt(n,13)^nt(n,22))+p0(n,i,s)|0;l=u,u=c,c=a,a=o+p|0,o=s,s=i,i=n,n=p+y|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){It.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const m0=nu(()=>new w0);new f0(128);const E0=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),uu=new Uint8Array(new Array(16).fill(0).map((t,e)=>e)),v0=uu.map(t=>(9*t+5)%16);let _0=[uu],S0=[v0];for(let t=0;t<4;t++)for(let e of[_0,S0])e.push(e[t].map(r=>E0[r]));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Fn=BigInt(0),zn=BigInt(1),I0=BigInt(2);function Ft(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Mr(t){if(!Ft(t))throw new Error("Uint8Array expected")}function cr(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const D0=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ur(t){Mr(t);let e="";for(let r=0;r<t.length;r++)e+=D0[t[r]];return e}function lr(t){const e=t.toString(16);return e.length&1?"0"+e:e}function ts(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Fn:BigInt("0x"+t)}const ut={_0:48,_9:57,A:65,F:70,a:97,f:102};function lu(t){if(t>=ut._0&&t<=ut._9)return t-ut._0;if(t>=ut.A&&t<=ut.F)return t-(ut.A-10);if(t>=ut.a&&t<=ut.f)return t-(ut.a-10)}function hr(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=lu(t.charCodeAt(s)),a=lu(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function zt(t){return ts(ur(t))}function rs(t){return Mr(t),ts(ur(Uint8Array.from(t).reverse()))}function fr(t,e){return hr(t.toString(16).padStart(e*2,"0"))}function ns(t,e){return fr(t,e).reverse()}function O0(t){return hr(lr(t))}function Ye(t,e,r){let n;if(typeof e=="string")try{n=hr(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Ft(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function Vr(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Mr(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}function x0(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}function A0(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}const is=t=>typeof t=="bigint"&&Fn<=t;function jn(t,e,r){return is(t)&&is(e)&&is(r)&&e<=t&&t<r}function jt(t,e,r,n){if(!jn(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function hu(t){let e;for(e=0;t>Fn;t>>=zn,e+=1);return e}function T0(t,e){return t>>BigInt(e)&zn}function B0(t,e,r){return t|(r?zn:Fn)<<BigInt(e)}const ss=t=>(I0<<BigInt(t-1))-zn,os=t=>new Uint8Array(t),fu=t=>Uint8Array.from(t);function du(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=os(t),i=os(t),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...h)=>r(i,n,...h),c=(h=os())=>{i=a(fu([0]),h),n=a(),h.length!==0&&(i=a(fu([1]),h),n=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const f=[];for(;h<e;){n=a();const p=n.slice();f.push(p),h+=n.length}return Vr(...f)};return(h,f)=>{o(),c(h);let p;for(;!(p=f(u()));)c();return o(),p}}const R0={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Ft(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Kr(t,e,r={}){const n=(i,s,o)=>{const a=R0[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}const C0=()=>{throw new Error("not implemented")};function as(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}var N0=Object.freeze({__proto__:null,isBytes:Ft,abytes:Mr,abool:cr,bytesToHex:ur,numberToHexUnpadded:lr,hexToNumber:ts,hexToBytes:hr,bytesToNumberBE:zt,bytesToNumberLE:rs,numberToBytesBE:fr,numberToBytesLE:ns,numberToVarBytesBE:O0,ensureBytes:Ye,concatBytes:Vr,equalBytes:x0,utf8ToBytes:A0,inRange:jn,aInRange:jt,bitLen:hu,bitGet:T0,bitSet:B0,bitMask:ss,createHmacDrbg:du,validateObject:Kr,notImplemented:C0,memoized:as});const P0="0.1.1";function L0(){return P0}class xe extends Error{constructor(e,r={}){const n=(()=>{if(r.cause instanceof xe){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause?.message?r.cause.message:r.details})(),i=r.cause instanceof xe&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${i??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...n||i?["",n?`Details: ${n}`:void 0,i?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${L0()}`}),this.cause=r.cause,this.details=n,this.docs=o,this.docsPath=i,this.shortMessage=e}walk(e){return gu(this,e)}}function gu(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?gu(t.cause,e):e?null:t}function $0(t,e){if(bu(t)>e)throw new K0({givenSize:bu(t),maxSize:e})}const lt={zero:48,nine:57,A:65,F:70,a:97,f:102};function pu(t){if(t>=lt.zero&&t<=lt.nine)return t-lt.zero;if(t>=lt.A&&t<=lt.F)return t-(lt.A-10);if(t>=lt.a&&t<=lt.f)return t-(lt.a-10)}function U0(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;if(t.length>n)throw new H0({size:t.length,targetSize:n,type:"Bytes"});const i=new Uint8Array(n);for(let s=0;s<n;s++){const o=r==="right";i[o?s:n-s-1]=t[o?s:t.length-s-1]}return i}function cs(t,e){if(ls(t)>e)throw new J0({givenSize:ls(t),maxSize:e})}function yu(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;const i=t.replace("0x","");if(i.length>n*2)throw new Q0({size:Math.ceil(i.length/2),targetSize:n,type:"Hex"});return`0x${i[r==="right"?"padEnd":"padStart"](n*2,"0")}`}const F0=new TextEncoder;function z0(t){return t instanceof Uint8Array?t:typeof t=="string"?k0(t):j0(t)}function j0(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function k0(t,e={}){const{size:r}=e;let n=t;r&&(cs(t,r),n=us(t,r));let i=n.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const u=pu(i.charCodeAt(c++)),l=pu(i.charCodeAt(c++));if(u===void 0||l===void 0)throw new xe(`Invalid byte sequence ("${i[c-2]}${i[c-1]}" in "${i}").`);o[a]=u*16+l}return o}function M0(t,e={}){const{size:r}=e,n=F0.encode(t);return typeof r=="number"?($0(n,r),V0(n,r)):n}function V0(t,e){return U0(t,{dir:"right",size:e})}function bu(t){return t.length}class K0 extends xe{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class H0 extends xe{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}const q0=new TextEncoder,W0=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function wu(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function G0(t,e={}){const r=`0x${Number(t)}`;return typeof e.size=="number"?(cs(r,e.size),kn(r,e.size)):r}function mu(t,e={}){let r="";for(let i=0;i<t.length;i++)r+=W0[t[i]];const n=`0x${r}`;return typeof e.size=="number"?(cs(n,e.size),us(n,e.size)):n}function Y0(t,e={}){const{signed:r,size:n}=e,i=BigInt(t);let s;n?r?s=(1n<<BigInt(n)*8n-1n)-1n:s=2n**(BigInt(n)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&i>s||i<o){const u=typeof t=="bigint"?"n":"";throw new X0({max:s?`${s}${u}`:void 0,min:`${o}${u}`,signed:r,size:n,value:`${t}${u}`})}const c=`0x${(r&&i<0?(1n<<BigInt(n*8))+BigInt(i):i).toString(16)}`;return n?kn(c,n):c}function Z0(t,e={}){return mu(q0.encode(t),e)}function kn(t,e){return yu(t,{dir:"left",size:e})}function us(t,e){return yu(t,{dir:"right",size:e})}function ls(t){return Math.ceil((t.length-2)/2)}class X0 extends xe{constructor({max:e,min:r,signed:n,size:i,value:s}){super(`Number \`${s}\` is not in safe${i?` ${i*8}-bit`:""}${n?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class J0 extends xe{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class Q0 extends xe{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}function em(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,n=h0(z0(t));return r==="Bytes"?n:mu(n)}class tm extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}const hs={checksum:new tm(8192)}.checksum,rm=/^0x[a-fA-F0-9]{40}$/;function Eu(t,e={}){const{strict:r=!0}=e;if(!rm.test(t))throw new vu({address:t,cause:new im});if(r){if(t.toLowerCase()===t)return;if(nm(t)!==t)throw new vu({address:t,cause:new sm})}}function nm(t){if(hs.has(t))return hs.get(t);Eu(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=em(M0(e),{as:"Bytes"}),n=e.split("");for(let s=0;s<40;s+=2)r[s>>1]>>4>=8&&n[s]&&(n[s]=n[s].toUpperCase()),(r[s>>1]&15)>=8&&n[s+1]&&(n[s+1]=n[s+1].toUpperCase());const i=`0x${n.join("")}`;return hs.set(t,i),i}class vu extends xe{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class im extends xe{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class sm extends xe{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}const om=/^(.*)\[([0-9]*)\]$/,am=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,cm=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function fs(t,e){if(t.length!==e.length)throw new lm({expectedLength:t.length,givenLength:e.length});const r=[];for(let n=0;n<t.length;n++){const i=t[n],s=e[n];r.push(fs.encode(i,s))}return wu(...r)}(function(t){function e(r,n,i=!1){if(r==="address"){const c=n;return Eu(c),kn(c.toLowerCase(),i?32:0)}if(r==="string")return Z0(n);if(r==="bytes")return n;if(r==="bool")return kn(G0(n),i?32:1);const s=r.match(cm);if(s){const[c,u,l="256"]=s,h=Number.parseInt(l)/8;return Y0(n,{size:i?32:h,signed:u==="int"})}const o=r.match(am);if(o){const[c,u]=o;if(Number.parseInt(u)!==(n.length-2)/2)throw new um({expectedSize:Number.parseInt(u),value:n});return us(n,i?32:0)}const a=r.match(om);if(a&&Array.isArray(n)){const[c,u]=a,l=[];for(let h=0;h<n.length;h++)l.push(e(u,n[h],!0));return l.length===0?"0x":wu(...l)}throw new hm(r)}t.encode=e})(fs||(fs={}));class um extends xe{constructor({expectedSize:e,value:r}){super(`Size of bytes "${r}" (bytes${ls(r)}) does not match expected size (bytes${e}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.BytesSizeMismatchError"})}}class lm extends xe{constructor({expectedLength:e,givenLength:r}){super(["ABI encoding parameters/values length mismatch.",`Expected length (parameters): ${e}`,`Given length (values): ${r}`].join(`
`)),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.LengthMismatchError"})}}class hm extends xe{constructor(e){super(`Type \`${e}\` is not a valid ABI Type.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidTypeError"})}}class _u extends Qi{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Hw(e);const n=Un(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return or(this),this.iHash.update(e),this}digestInto(e){or(this),jr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Su=(t,e,r)=>new _u(t,e).update(r).digest();Su.create=(t,e)=>new _u(t,e);const fe=BigInt(0),ie=BigInt(1),kt=BigInt(2),fm=BigInt(3),ds=BigInt(4),Iu=BigInt(5),Du=BigInt(8);function Ne(t,e){const r=t%e;return r>=fe?r:e+r}function dm(t,e,r){if(e<fe)throw new Error("invalid exponent, negatives unsupported");if(r<=fe)throw new Error("invalid modulus");if(r===ie)return fe;let n=ie;for(;e>fe;)e&ie&&(n=n*t%r),t=t*t%r,e>>=ie;return n}function qe(t,e,r){let n=t;for(;e-- >fe;)n*=n,n%=r;return n}function gs(t,e){if(t===fe)throw new Error("invert: expected non-zero number");if(e<=fe)throw new Error("invert: expected positive modulus, got "+e);let r=Ne(t,e),n=e,i=fe,s=ie;for(;r!==fe;){const a=n/r,c=n%r,u=i-s*a;n=r,r=c,i=s,s=u}if(n!==ie)throw new Error("invert: does not exist");return Ne(i,e)}function gm(t){const e=(t-ie)/kt;let r,n,i;for(r=t-ie,n=0;r%kt===fe;r/=kt,n++);for(i=kt;i<t&&dm(i,e,t)!==t-ie;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+ie)/ds;return function(c,u){const l=c.pow(u,o);if(!c.eql(c.sqr(l),u))throw new Error("Cannot find square root");return l}}const s=(r+ie)/kt;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let u=n,l=a.pow(a.mul(a.ONE,i),r),h=a.pow(c,s),f=a.pow(c,r);for(;!a.eql(f,a.ONE);){if(a.eql(f,a.ZERO))return a.ZERO;let p=1;for(let y=a.sqr(f);p<u&&!a.eql(y,a.ONE);p++)y=a.sqr(y);const g=a.pow(l,ie<<BigInt(u-p-1));l=a.sqr(g),h=a.mul(h,g),f=a.mul(f,l),u=p}return h}}function pm(t){if(t%ds===fm){const e=(t+ie)/ds;return function(n,i){const s=n.pow(i,e);if(!n.eql(n.sqr(s),i))throw new Error("Cannot find square root");return s}}if(t%Du===Iu){const e=(t-Iu)/Du;return function(n,i){const s=n.mul(i,kt),o=n.pow(s,e),a=n.mul(i,o),c=n.mul(n.mul(a,kt),o),u=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(u),i))throw new Error("Cannot find square root");return u}}return gm(t)}const ym=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function bm(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=ym.reduce((n,i)=>(n[i]="function",n),e);return Kr(t,r)}function wm(t,e,r){if(r<fe)throw new Error("invalid exponent, negatives unsupported");if(r===fe)return t.ONE;if(r===ie)return e;let n=t.ONE,i=e;for(;r>fe;)r&ie&&(n=t.mul(n,i)),i=t.sqr(i),r>>=ie;return n}function mm(t,e){const r=new Array(e.length),n=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),i=t.inv(n);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),i),r}function Ou(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function xu(t,e,r=!1,n={}){if(t<=fe)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Ou(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:ss(i),ZERO:fe,ONE:ie,create:c=>Ne(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return fe<=c&&c<t},is0:c=>c===fe,isOdd:c=>(c&ie)===ie,neg:c=>Ne(-c,t),eql:(c,u)=>c===u,sqr:c=>Ne(c*c,t),add:(c,u)=>Ne(c+u,t),sub:(c,u)=>Ne(c-u,t),mul:(c,u)=>Ne(c*u,t),pow:(c,u)=>wm(a,c,u),div:(c,u)=>Ne(c*gs(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>gs(c,t),sqrt:n.sqrt||(c=>(o||(o=pm(t)),o(a,c))),invertBatch:c=>mm(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>r?ns(c,s):fr(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?rs(c):zt(c)}});return Object.freeze(a)}function Au(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Tu(t){const e=Au(t);return e+Math.ceil(e/2)}function Em(t,e,r=!1){const n=t.length,i=Au(e),s=Tu(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?rs(t):zt(t),a=Ne(o,e-ie)+ie;return r?ns(a,i):fr(a,i)}const Bu=BigInt(0),Mn=BigInt(1);function ps(t,e){const r=e.negate();return t?r:e}function Ru(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function ys(t,e){Ru(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function vm(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function _m(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const bs=new WeakMap,Cu=new WeakMap;function ws(t){return Cu.get(t)||1}function Sm(t,e){return{constTimeNegate:ps,hasPrecomputes(r){return ws(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>Bu;)n&Mn&&(i=i.add(s)),s=s.double(),n>>=Mn;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=ys(n,e),o=[];let a=r,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){const{windows:s,windowSize:o}=ys(r,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let f=0;f<s;f++){const p=f*o;let g=Number(i&u);i>>=h,g>o&&(g-=l,i+=Mn);const y=p,d=p+Math.abs(g)-1,E=f%2!==0,m=g<0;g===0?c=c.add(ps(E,n[y])):a=a.add(ps(m,n[d]))}return{p:a,f:c}},wNAFUnsafe(r,n,i,s=t.ZERO){const{windows:o,windowSize:a}=ys(r,e),c=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let h=0;h<o;h++){const f=h*a;if(i===Bu)break;let p=Number(i&c);if(i>>=l,p>a&&(p-=u,i+=Mn),p===0)continue;let g=n[f+Math.abs(p)-1];p<0&&(g=g.negate()),s=s.add(g)}return s},getPrecomputes(r,n,i){let s=bs.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&bs.set(n,i(s))),s},wNAFCached(r,n,i){const s=ws(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=ws(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){Ru(n,e),Cu.set(r,n),bs.delete(r)}}}function Im(t,e,r,n){if(vm(r,t),_m(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=hu(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o;let l=i;for(let h=u;h>=0;h-=o){c.fill(i);for(let p=0;p<n.length;p++){const g=n[p],y=Number(g>>BigInt(h)&BigInt(a));c[y]=c[y].add(r[p])}let f=i;for(let p=c.length-1,g=i;p>0;p--)g=g.add(c[p]),f=f.add(g);if(l=l.add(f),h!==0)for(let p=0;p<o;p++)l=l.double()}return l}function Nu(t){return bm(t.Fp),Kr(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Ou(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function Pu(t){t.lowS!==void 0&&cr("lowS",t.lowS),t.prehash!==void 0&&cr("prehash",t.prehash)}function Dm(t){const e=Nu(t);Kr(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:n,a:i}=e;if(r){if(!n.eql(i,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:Om,hexToBytes:xm}=N0;class Am extends Error{constructor(e=""){super(e)}}const ht={Err:Am,_tlv:{encode:(t,e)=>{const{Err:r}=ht;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=lr(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?lr(i.length/2|128):"";return lr(t)+s+i+e},decode(t,e){const{Err:r}=ht;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=ht;if(t<ft)throw new e("integer: negative integers are not allowed");let r=lr(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=ht;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Om(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=ht,i=typeof t=="string"?xm(t):t;Mr(i);const{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=ht,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}},ft=BigInt(0),de=BigInt(1);BigInt(2);const Lu=BigInt(3);BigInt(4);function Tm(t){const e=Dm(t),{Fp:r}=e,n=xu(e.n,e.nBitLength),i=e.toBytes||((y,d,E)=>{const m=d.toAffine();return Vr(Uint8Array.from([4]),r.toBytes(m.x),r.toBytes(m.y))}),s=e.fromBytes||(y=>{const d=y.subarray(1),E=r.fromBytes(d.subarray(0,r.BYTES)),m=r.fromBytes(d.subarray(r.BYTES,2*r.BYTES));return{x:E,y:m}});function o(y){const{a:d,b:E}=e,m=r.sqr(y),w=r.mul(m,y);return r.add(r.add(w,r.mul(y,d)),E)}if(!r.eql(r.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(y){return jn(y,de,e.n)}function c(y){const{allowedPrivateKeyLengths:d,nByteLength:E,wrapPrivateKey:m,n:w}=e;if(d&&typeof y!="bigint"){if(Ft(y)&&(y=ur(y)),typeof y!="string"||!d.includes(y.length))throw new Error("invalid private key");y=y.padStart(E*2,"0")}let S;try{S=typeof y=="bigint"?y:zt(Ye("private key",y,E))}catch{throw new Error("invalid private key, expected hex or "+E+" bytes, got "+typeof y)}return m&&(S=Ne(S,w)),jt("private key",S,de,w),S}function u(y){if(!(y instanceof f))throw new Error("ProjectivePoint expected")}const l=as((y,d)=>{const{px:E,py:m,pz:w}=y;if(r.eql(w,r.ONE))return{x:E,y:m};const S=y.is0();d==null&&(d=S?r.ONE:r.inv(w));const R=r.mul(E,d),B=r.mul(m,d),D=r.mul(w,d);if(S)return{x:r.ZERO,y:r.ZERO};if(!r.eql(D,r.ONE))throw new Error("invZ was invalid");return{x:R,y:B}}),h=as(y=>{if(y.is0()){if(e.allowInfinityPoint&&!r.is0(y.py))return;throw new Error("bad point: ZERO")}const{x:d,y:E}=y.toAffine();if(!r.isValid(d)||!r.isValid(E))throw new Error("bad point: x or y not FE");const m=r.sqr(E),w=o(d);if(!r.eql(m,w))throw new Error("bad point: equation left != right");if(!y.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class f{constructor(d,E,m){if(this.px=d,this.py=E,this.pz=m,d==null||!r.isValid(d))throw new Error("x required");if(E==null||!r.isValid(E))throw new Error("y required");if(m==null||!r.isValid(m))throw new Error("z required");Object.freeze(this)}static fromAffine(d){const{x:E,y:m}=d||{};if(!d||!r.isValid(E)||!r.isValid(m))throw new Error("invalid affine point");if(d instanceof f)throw new Error("projective point not allowed");const w=S=>r.eql(S,r.ZERO);return w(E)&&w(m)?f.ZERO:new f(E,m,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){const E=r.invertBatch(d.map(m=>m.pz));return d.map((m,w)=>m.toAffine(E[w])).map(f.fromAffine)}static fromHex(d){const E=f.fromAffine(s(Ye("pointHex",d)));return E.assertValidity(),E}static fromPrivateKey(d){return f.BASE.multiply(c(d))}static msm(d,E){return Im(f,n,d,E)}_setWindowSize(d){g.setWindowSize(this,d)}assertValidity(){h(this)}hasEvenY(){const{y:d}=this.toAffine();if(r.isOdd)return!r.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){u(d);const{px:E,py:m,pz:w}=this,{px:S,py:R,pz:B}=d,D=r.eql(r.mul(E,B),r.mul(S,w)),A=r.eql(r.mul(m,B),r.mul(R,w));return D&&A}negate(){return new f(this.px,r.neg(this.py),this.pz)}double(){const{a:d,b:E}=e,m=r.mul(E,Lu),{px:w,py:S,pz:R}=this;let B=r.ZERO,D=r.ZERO,A=r.ZERO,O=r.mul(w,w),U=r.mul(S,S),C=r.mul(R,R),N=r.mul(w,S);return N=r.add(N,N),A=r.mul(w,R),A=r.add(A,A),B=r.mul(d,A),D=r.mul(m,C),D=r.add(B,D),B=r.sub(U,D),D=r.add(U,D),D=r.mul(B,D),B=r.mul(N,B),A=r.mul(m,A),C=r.mul(d,C),N=r.sub(O,C),N=r.mul(d,N),N=r.add(N,A),A=r.add(O,O),O=r.add(A,O),O=r.add(O,C),O=r.mul(O,N),D=r.add(D,O),C=r.mul(S,R),C=r.add(C,C),O=r.mul(C,N),B=r.sub(B,O),A=r.mul(C,U),A=r.add(A,A),A=r.add(A,A),new f(B,D,A)}add(d){u(d);const{px:E,py:m,pz:w}=this,{px:S,py:R,pz:B}=d;let D=r.ZERO,A=r.ZERO,O=r.ZERO;const U=e.a,C=r.mul(e.b,Lu);let N=r.mul(E,S),j=r.mul(m,R),_=r.mul(w,B),v=r.add(E,m),b=r.add(S,R);v=r.mul(v,b),b=r.add(N,j),v=r.sub(v,b),b=r.add(E,w);let I=r.add(S,B);return b=r.mul(b,I),I=r.add(N,_),b=r.sub(b,I),I=r.add(m,w),D=r.add(R,B),I=r.mul(I,D),D=r.add(j,_),I=r.sub(I,D),O=r.mul(U,b),D=r.mul(C,_),O=r.add(D,O),D=r.sub(j,O),O=r.add(j,O),A=r.mul(D,O),j=r.add(N,N),j=r.add(j,N),_=r.mul(U,_),b=r.mul(C,b),j=r.add(j,_),_=r.sub(N,_),_=r.mul(U,_),b=r.add(b,_),N=r.mul(j,b),A=r.add(A,N),N=r.mul(I,b),D=r.mul(v,D),D=r.sub(D,N),N=r.mul(v,j),O=r.mul(I,O),O=r.add(O,N),new f(D,A,O)}subtract(d){return this.add(d.negate())}is0(){return this.equals(f.ZERO)}wNAF(d){return g.wNAFCached(this,d,f.normalizeZ)}multiplyUnsafe(d){const{endo:E,n:m}=e;jt("scalar",d,ft,m);const w=f.ZERO;if(d===ft)return w;if(this.is0()||d===de)return this;if(!E||g.hasPrecomputes(this))return g.wNAFCachedUnsafe(this,d,f.normalizeZ);let{k1neg:S,k1:R,k2neg:B,k2:D}=E.splitScalar(d),A=w,O=w,U=this;for(;R>ft||D>ft;)R&de&&(A=A.add(U)),D&de&&(O=O.add(U)),U=U.double(),R>>=de,D>>=de;return S&&(A=A.negate()),B&&(O=O.negate()),O=new f(r.mul(O.px,E.beta),O.py,O.pz),A.add(O)}multiply(d){const{endo:E,n:m}=e;jt("scalar",d,de,m);let w,S;if(E){const{k1neg:R,k1:B,k2neg:D,k2:A}=E.splitScalar(d);let{p:O,f:U}=this.wNAF(B),{p:C,f:N}=this.wNAF(A);O=g.constTimeNegate(R,O),C=g.constTimeNegate(D,C),C=new f(r.mul(C.px,E.beta),C.py,C.pz),w=O.add(C),S=U.add(N)}else{const{p:R,f:B}=this.wNAF(d);w=R,S=B}return f.normalizeZ([w,S])[0]}multiplyAndAddUnsafe(d,E,m){const w=f.BASE,S=(B,D)=>D===ft||D===de||!B.equals(w)?B.multiplyUnsafe(D):B.multiply(D),R=S(this,E).add(S(d,m));return R.is0()?void 0:R}toAffine(d){return l(this,d)}isTorsionFree(){const{h:d,isTorsionFree:E}=e;if(d===de)return!0;if(E)return E(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:d,clearCofactor:E}=e;return d===de?this:E?E(f,this):this.multiplyUnsafe(e.h)}toRawBytes(d=!0){return cr("isCompressed",d),this.assertValidity(),i(f,this,d)}toHex(d=!0){return cr("isCompressed",d),ur(this.toRawBytes(d))}}f.BASE=new f(e.Gx,e.Gy,r.ONE),f.ZERO=new f(r.ZERO,r.ONE,r.ZERO);const p=e.nBitLength,g=Sm(f,e.endo?Math.ceil(p/2):p);return{CURVE:e,ProjectivePoint:f,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function Bm(t){const e=Nu(t);return Kr(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Rm(t){const e=Bm(t),{Fp:r,n}=e,i=r.BYTES+1,s=2*r.BYTES+1;function o(_){return Ne(_,n)}function a(_){return gs(_,n)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:l,isWithinCurveOrder:h}=Tm({...e,toBytes(_,v,b){const I=v.toAffine(),T=r.toBytes(I.x),x=Vr;return cr("isCompressed",b),b?x(Uint8Array.from([v.hasEvenY()?2:3]),T):x(Uint8Array.from([4]),T,r.toBytes(I.y))},fromBytes(_){const v=_.length,b=_[0],I=_.subarray(1);if(v===i&&(b===2||b===3)){const T=zt(I);if(!jn(T,de,r.ORDER))throw new Error("Point is not on curve");const x=l(T);let P;try{P=r.sqrt(x)}catch(z){const M=z instanceof Error?": "+z.message:"";throw new Error("Point is not on curve"+M)}const $=(P&de)===de;return(b&1)===1!==$&&(P=r.neg(P)),{x:T,y:P}}else if(v===s&&b===4){const T=r.fromBytes(I.subarray(0,r.BYTES)),x=r.fromBytes(I.subarray(r.BYTES,2*r.BYTES));return{x:T,y:x}}else{const T=i,x=s;throw new Error("invalid Point, expected length of "+T+", or uncompressed "+x+", got "+v)}}}),f=_=>ur(fr(_,e.nByteLength));function p(_){const v=n>>de;return _>v}function g(_){return p(_)?o(-_):_}const y=(_,v,b)=>zt(_.slice(v,b));class d{constructor(v,b,I){this.r=v,this.s=b,this.recovery=I,this.assertValidity()}static fromCompact(v){const b=e.nByteLength;return v=Ye("compactSignature",v,b*2),new d(y(v,0,b),y(v,b,2*b))}static fromDER(v){const{r:b,s:I}=ht.toSig(Ye("DER",v));return new d(b,I)}assertValidity(){jt("r",this.r,de,n),jt("s",this.s,de,n)}addRecoveryBit(v){return new d(this.r,this.s,v)}recoverPublicKey(v){const{r:b,s:I,recovery:T}=this,x=B(Ye("msgHash",v));if(T==null||![0,1,2,3].includes(T))throw new Error("recovery id invalid");const P=T===2||T===3?b+e.n:b;if(P>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const $=(T&1)===0?"02":"03",F=c.fromHex($+f(P)),z=a(P),M=o(-x*z),V=o(I*z),H=c.BASE.multiplyAndAddUnsafe(F,M,V);if(!H)throw new Error("point at infinify");return H.assertValidity(),H}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new d(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return hr(this.toDERHex())}toDERHex(){return ht.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hr(this.toCompactHex())}toCompactHex(){return f(this.r)+f(this.s)}}const E={isValidPrivateKey(_){try{return u(_),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const _=Tu(e.n);return Em(e.randomBytes(_),e.n)},precompute(_=8,v=c.BASE){return v._setWindowSize(_),v.multiply(BigInt(3)),v}};function m(_,v=!0){return c.fromPrivateKey(_).toRawBytes(v)}function w(_){const v=Ft(_),b=typeof _=="string",I=(v||b)&&_.length;return v?I===i||I===s:b?I===2*i||I===2*s:_ instanceof c}function S(_,v,b=!0){if(w(_))throw new Error("first arg must be private key");if(!w(v))throw new Error("second arg must be public key");return c.fromHex(v).multiply(u(_)).toRawBytes(b)}const R=e.bits2int||function(_){if(_.length>8192)throw new Error("input is too large");const v=zt(_),b=_.length*8-e.nBitLength;return b>0?v>>BigInt(b):v},B=e.bits2int_modN||function(_){return o(R(_))},D=ss(e.nBitLength);function A(_){return jt("num < 2^"+e.nBitLength,_,ft,D),fr(_,e.nByteLength)}function O(_,v,b=U){if(["recovered","canonical"].some(Y=>Y in b))throw new Error("sign() legacy options not supported");const{hash:I,randomBytes:T}=e;let{lowS:x,prehash:P,extraEntropy:$}=b;x==null&&(x=!0),_=Ye("msgHash",_),Pu(b),P&&(_=Ye("prehashed msgHash",I(_)));const F=B(_),z=u(v),M=[A(z),A(F)];if($!=null&&$!==!1){const Y=$===!0?T(r.BYTES):$;M.push(Ye("extraEntropy",Y))}const V=Vr(...M),H=F;function re(Y){const Z=R(Y);if(!h(Z))return;const Se=a(Z),ce=c.BASE.multiply(Z).toAffine(),ue=o(ce.x);if(ue===ft)return;const De=o(Se*o(H+ue*z));if(De===ft)return;let Oe=(ce.x===ue?0:2)|Number(ce.y&de),Gt=De;return x&&p(De)&&(Gt=g(De),Oe^=1),new d(ue,Gt,Oe)}return{seed:V,k2sig:re}}const U={lowS:e.lowS,prehash:!1},C={lowS:e.lowS,prehash:!1};function N(_,v,b=U){const{seed:I,k2sig:T}=O(_,v,b),x=e;return du(x.hash.outputLen,x.nByteLength,x.hmac)(I,T)}c.BASE._setWindowSize(8);function j(_,v,b,I=C){const T=_;v=Ye("msgHash",v),b=Ye("publicKey",b);const{lowS:x,prehash:P,format:$}=I;if(Pu(I),"strict"in I)throw new Error("options.strict was renamed to lowS");if($!==void 0&&$!=="compact"&&$!=="der")throw new Error("format must be compact or der");const F=typeof T=="string"||Ft(T),z=!F&&!$&&typeof T=="object"&&T!==null&&typeof T.r=="bigint"&&typeof T.s=="bigint";if(!F&&!z)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let M,V;try{if(z&&(M=new d(T.r,T.s)),F){try{$!=="compact"&&(M=d.fromDER(T))}catch(Oe){if(!(Oe instanceof ht.Err))throw Oe}!M&&$!=="der"&&(M=d.fromCompact(T))}V=c.fromHex(b)}catch{return!1}if(!M||x&&M.hasHighS())return!1;P&&(v=e.hash(v));const{r:H,s:re}=M,Y=B(v),Z=a(re),Se=o(Y*Z),ce=o(H*Z),ue=c.BASE.multiplyAndAddUnsafe(V,Se,ce)?.toAffine();return ue?o(ue.x)===H:!1}return{CURVE:e,getPublicKey:m,getSharedSecret:S,sign:N,verify:j,ProjectivePoint:c,Signature:d,utils:E}}function Cm(t){return{hash:t,hmac:(e,...r)=>Su(t,e,t0(...r)),randomBytes:r0}}function Nm(t,e){const r=n=>Rm({...t,...Cm(n)});return{...r(e),create:r}}const $u=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Uu=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Pm=BigInt(1),ms=BigInt(2),Fu=(t,e)=>(t+e/ms)/e;function Lm(t){const e=$u,r=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,l=u*u*t%e,h=qe(l,r,e)*l%e,f=qe(h,r,e)*l%e,p=qe(f,ms,e)*u%e,g=qe(p,i,e)*p%e,y=qe(g,s,e)*g%e,d=qe(y,a,e)*y%e,E=qe(d,c,e)*d%e,m=qe(E,a,e)*y%e,w=qe(m,r,e)*l%e,S=qe(w,o,e)*g%e,R=qe(S,n,e)*u%e,B=qe(R,ms,e);if(!Es.eql(Es.sqr(B),t))throw new Error("Cannot find square root");return B}const Es=xu($u,void 0,void 0,{sqrt:Lm});Nm({a:BigInt(0),b:BigInt(7),Fp:Es,n:Uu,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Uu,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Pm*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=Fu(s*t,e),c=Fu(-n*t,e);let u=Ne(t-a*r-c*i,e),l=Ne(-a*n-c*s,e);const h=u>o,f=l>o;if(h&&(u=e-u),f&&(l=e-l),u>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:u,k2neg:f,k2:l}}}},m0),BigInt(0);function $m(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<t.length;u++){const l=t.charAt(u),h=l.charCodeAt(0);if(e[h]!==255)throw new TypeError(l+" is ambiguous");e[h]=u}const r=t.length,n=t.charAt(0),i=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let l=0,h=0,f=0;const p=u.length;for(;f!==p&&u[f]===0;)f++,l++;const g=(p-f)*s+1>>>0,y=new Uint8Array(g);for(;f!==p;){let m=u[f],w=0;for(let S=g-1;(m!==0||w<h)&&S!==-1;S--,w++)m+=256*y[S]>>>0,y[S]=m%r>>>0,m=m/r>>>0;if(m!==0)throw new Error("Non-zero carry");h=w,f++}let d=g-h;for(;d!==g&&y[d]===0;)d++;let E=n.repeat(l);for(;d<g;++d)E+=t.charAt(y[d]);return E}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let l=0,h=0,f=0;for(;u[l]===n;)h++,l++;const p=(u.length-l)*i+1>>>0,g=new Uint8Array(p);for(;l<u.length;){const m=u.charCodeAt(l);if(m>255)return;let w=e[m];if(w===255)return;let S=0;for(let R=p-1;(w!==0||S<f)&&R!==-1;R--,S++)w+=r*g[R]>>>0,g[R]=w%256>>>0,w=w/256>>>0;if(w!==0)throw new Error("Non-zero carry");f=S,l++}let y=p-f;for(;y!==p&&g[y]===0;)y++;const d=new Uint8Array(h+(p-y));let E=h;for(;y!==p;)d[E++]=g[y++];return d}function c(u){const l=a(u);if(l)return l;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var Um="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";$m(Um);function Hr(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=Mc(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return r}function Pe(t,e="utf8"){const r=Hc[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const Fm={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var zm=Object.defineProperty,jm=Object.defineProperties,km=Object.getOwnPropertyDescriptors,zu=Object.getOwnPropertySymbols,Mm=Object.prototype.hasOwnProperty,Vm=Object.prototype.propertyIsEnumerable,ju=(t,e,r)=>e in t?zm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,dt=(t,e)=>{for(var r in e||(e={}))Mm.call(e,r)&&ju(t,r,e[r]);if(zu)for(var r of zu(e))Vm.call(e,r)&&ju(t,r,e[r]);return t},vs=(t,e)=>jm(t,km(e));const Km="ReactNative",Ze={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Hm="js";function Vn(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Mt(){return!sr()&&!!Zi()&&navigator.product===Km}function qm(){return Mt()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function Wm(){return Mt()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function qr(){return!Vn()&&!!Zi()&&!!sr()}function Kn(){return Mt()?Ze.reactNative:Vn()?Ze.node:qr()?Ze.browser:Ze.unknown}function ku(){var t;try{return Mt()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function Gm(t,e){const r=new URLSearchParams(t);for(const n of Object.keys(e).sort())if(e.hasOwnProperty(n)){const i=e[n];i!==void 0&&r.set(n,i)}return r.toString()}function Ym(){return Xc()||{name:"",description:"",url:"",icons:[""]}}function Zm(){if(Kn()===Ze.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:n}=global.Platform;return[r,n].join("-")}const t=Aw();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function Xm(){var t;const e=Kn();return e===Ze.browser?[e,((t=Zc())==null?void 0:t.host)||"unknown"].join(":"):e}function Mu(t,e,r){const n=Zm(),i=Xm();return[[t,e].join("-"),[Hm,r].join("-"),n,i].join("/")}function Jm({protocol:t,version:e,relayUrl:r,sdkVersion:n,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const u=r.split("?"),l=Mu(t,e,n),h={auth:i,ua:l,projectId:s,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},f=Gm(u[1]||"",h);return u[0]+"?"+f}function _s(t){return Object.fromEntries(t.entries())}function Ss(t){return new Map(Object.entries(t))}function Qm(t=k.FIVE_MINUTES,e){const r=k.toMiliseconds(t||k.FIVE_MINUTES);let n,i,s,o;return{resolve:a=>{s&&n&&(clearTimeout(s),n(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const u=new Error(e);o=Promise.reject(u),c(u)},r),n=a,i=c})}}function Dt(t,e,r){return new Promise(async(n,i)=>{const s=setTimeout(()=>i(new Error(r)),e);try{const o=await t;n(o)}catch(o){i(o)}clearTimeout(s)})}function Vu(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function e1(t){return Vu("topic",t)}function t1(t){return Vu("id",t)}function r1(t){const[e,r]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")n.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return n}function Wr(t,e){return k.fromMiliseconds((e||Date.now())+k.toMiliseconds(t))}function Ku(t){return Date.now()>=k.toMiliseconds(t)}function Is(t,e){return`${t}${e?`:${e}`:""}`}function Hu(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function qu(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function Wu(t){return Buffer.from(t,"base64").toString("utf-8")}function n1(t){return new Promise(e=>setTimeout(e,t))}function Gr(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function i1(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Yr(t,...e){if(!i1(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Ds(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Gr(t.outputLen),Gr(t.blockLen)}function dr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Gu(t,e){Yr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const Hn=BigInt(2**32-1),Yu=BigInt(32);function s1(t,e=!1){return e?{h:Number(t&Hn),l:Number(t>>Yu&Hn)}:{h:Number(t>>Yu&Hn)|0,l:Number(t&Hn)|0}}function o1(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=s1(t[i],e);[r[i],n[i]]=[s,o]}return[r,n]}const a1=(t,e,r)=>t<<r|e>>>32-r,c1=(t,e,r)=>e<<r|t>>>32-r,u1=(t,e,r)=>e<<r-32|t>>>64-r,l1=(t,e,r)=>t<<r-32|e>>>64-r,gr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function h1(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Os(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function it(t,e){return t<<32-e|t>>>e}const Zu=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function f1(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Xu(t){for(let e=0;e<t.length;e++)t[e]=f1(t[e])}function d1(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function pr(t){return typeof t=="string"&&(t=d1(t)),Yr(t),t}function g1(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Yr(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}class xs{clone(){return this._cloneInto()}}function Ju(t){const e=n=>t().update(pr(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function yr(t=32){if(gr&&typeof gr.getRandomValues=="function")return gr.getRandomValues(new Uint8Array(t));if(gr&&typeof gr.randomBytes=="function")return gr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const Qu=[],el=[],tl=[],p1=BigInt(0),Zr=BigInt(1),y1=BigInt(2),b1=BigInt(7),w1=BigInt(256),m1=BigInt(113);for(let t=0,e=Zr,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],Qu.push(2*(5*n+r)),el.push((t+1)*(t+2)/2%64);let i=p1;for(let s=0;s<7;s++)e=(e<<Zr^(e>>b1)*m1)%w1,e&y1&&(i^=Zr<<(Zr<<BigInt(s))-Zr);tl.push(i)}const[E1,v1]=o1(tl,!0),rl=(t,e,r)=>r>32?u1(t,e,r):a1(t,e,r),nl=(t,e,r)=>r>32?l1(t,e,r):c1(t,e,r);function _1(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=rl(u,l,1)^r[a],f=nl(u,l,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=f}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=el[o],c=rl(i,s,a),u=nl(i,s,a),l=Qu[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=E1[n],t[1]^=v1[n]}r.fill(0)}class As extends xs{constructor(e,r,n,i=!1,s=24){if(super(),this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Gr(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=h1(this.state)}keccak(){Zu||Xu(this.state32),_1(this.state32,this.rounds),Zu||Xu(this.state32),this.posOut=0,this.pos=0}update(e){dr(this);const{blockLen:r,state:n}=this;e=pr(e);const i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){dr(this,!1),Yr(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Gr(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Gu(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new As(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}((t,e,r)=>Ju(()=>new As(e,t,r)))(1,136,256/8);function Ts(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function il(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function je(t,...e){if(!il(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function sl(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function S1(t,e){je(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function ol(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}const Ot=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),I1=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);if(!(new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68))throw new Error("Non little-endian hardware is not supported");function D1(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Bs(t){if(typeof t=="string")t=D1(t);else if(il(t))t=Rs(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function O1(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function x1(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const A1=(t,e)=>{function r(n,...i){if(je(n),t.nonceLength!==void 0){const u=i[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?je(u):je(u,t.nonceLength)}const s=t.tagLength;s&&i[1]!==void 0&&je(i[1]);const o=e(n,...i),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");je(l)}};let c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,je(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(je(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(r,t),r};function al(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!T1(e))throw new Error("invalid output, must be aligned");return e}function cl(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function T1(t){return t.byteOffset%4===0}function Rs(t){return Uint8Array.from(t)}function br(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const ul=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),B1=ul("expand 16-byte k"),R1=ul("expand 32-byte k"),C1=Ot(B1),N1=Ot(R1);function W(t,e){return t<<e|t>>>32-e}function Cs(t){return t.byteOffset%4===0}const qn=64,P1=16,ll=2**32-1,hl=new Uint32Array;function L1(t,e,r,n,i,s,o,a){const c=i.length,u=new Uint8Array(qn),l=Ot(u),h=Cs(i)&&Cs(s),f=h?Ot(i):hl,p=h?Ot(s):hl;for(let g=0;g<c;o++){if(t(e,r,n,l,o,a),o>=ll)throw new Error("arx: counter overflow");const y=Math.min(qn,c-g);if(h&&y===qn){const d=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let E=0,m;E<P1;E++)m=d+E,p[m]=f[m]^l[E];g+=qn;continue}for(let d=0,E;d<y;d++)E=g+d,s[E]=i[E]^u[d];g+=y}}function $1(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=O1({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Ts(i),Ts(o),ol(s),ol(r),(a,c,u,l,h=0)=>{je(a),je(c),je(u);const f=u.length;if(l===void 0&&(l=new Uint8Array(f)),je(l),Ts(h),h<0||h>=ll)throw new Error("arx: counter overflow");if(l.length<f)throw new Error(`arx: output (${l.length}) is shorter than data (${f})`);const p=[];let g=a.length,y,d;if(g===32)p.push(y=Rs(a)),d=N1;else if(g===16&&r)y=new Uint8Array(32),y.set(a),y.set(a,16),d=C1,p.push(y);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);Cs(c)||p.push(c=Rs(c));const E=Ot(y);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(d,E,Ot(c.subarray(0,16)),E),c=c.subarray(16)}const m=16-i;if(m!==c.length)throw new Error(`arx: nonce must be ${m} or 16 bytes`);if(m!==12){const S=new Uint8Array(12);S.set(c,s?0:12-c.length),c=S,p.push(c)}const w=Ot(c);return L1(t,d,E,w,u,l,h,o),br(...p),l}}const Ee=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class U1{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Bs(e),je(e,32);const r=Ee(e,0),n=Ee(e,2),i=Ee(e,4),s=Ee(e,6),o=Ee(e,8),a=Ee(e,10),c=Ee(e,12),u=Ee(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=Ee(e,16+2*l)}process(e,r,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],h=o[4],f=o[5],p=o[6],g=o[7],y=o[8],d=o[9],E=Ee(e,r+0),m=Ee(e,r+2),w=Ee(e,r+4),S=Ee(e,r+6),R=Ee(e,r+8),B=Ee(e,r+10),D=Ee(e,r+12),A=Ee(e,r+14);let O=s[0]+(E&8191),U=s[1]+((E>>>13|m<<3)&8191),C=s[2]+((m>>>10|w<<6)&8191),N=s[3]+((w>>>7|S<<9)&8191),j=s[4]+((S>>>4|R<<12)&8191),_=s[5]+(R>>>1&8191),v=s[6]+((R>>>14|B<<2)&8191),b=s[7]+((B>>>11|D<<5)&8191),I=s[8]+((D>>>8|A<<8)&8191),T=s[9]+(A>>>5|i),x=0,P=x+O*a+U*(5*d)+C*(5*y)+N*(5*g)+j*(5*p);x=P>>>13,P&=8191,P+=_*(5*f)+v*(5*h)+b*(5*l)+I*(5*u)+T*(5*c),x+=P>>>13,P&=8191;let $=x+O*c+U*a+C*(5*d)+N*(5*y)+j*(5*g);x=$>>>13,$&=8191,$+=_*(5*p)+v*(5*f)+b*(5*h)+I*(5*l)+T*(5*u),x+=$>>>13,$&=8191;let F=x+O*u+U*c+C*a+N*(5*d)+j*(5*y);x=F>>>13,F&=8191,F+=_*(5*g)+v*(5*p)+b*(5*f)+I*(5*h)+T*(5*l),x+=F>>>13,F&=8191;let z=x+O*l+U*u+C*c+N*a+j*(5*d);x=z>>>13,z&=8191,z+=_*(5*y)+v*(5*g)+b*(5*p)+I*(5*f)+T*(5*h),x+=z>>>13,z&=8191;let M=x+O*h+U*l+C*u+N*c+j*a;x=M>>>13,M&=8191,M+=_*(5*d)+v*(5*y)+b*(5*g)+I*(5*p)+T*(5*f),x+=M>>>13,M&=8191;let V=x+O*f+U*h+C*l+N*u+j*c;x=V>>>13,V&=8191,V+=_*a+v*(5*d)+b*(5*y)+I*(5*g)+T*(5*p),x+=V>>>13,V&=8191;let H=x+O*p+U*f+C*h+N*l+j*u;x=H>>>13,H&=8191,H+=_*c+v*a+b*(5*d)+I*(5*y)+T*(5*g),x+=H>>>13,H&=8191;let re=x+O*g+U*p+C*f+N*h+j*l;x=re>>>13,re&=8191,re+=_*u+v*c+b*a+I*(5*d)+T*(5*y),x+=re>>>13,re&=8191;let Y=x+O*y+U*g+C*p+N*f+j*h;x=Y>>>13,Y&=8191,Y+=_*l+v*u+b*c+I*a+T*(5*d),x+=Y>>>13,Y&=8191;let Z=x+O*d+U*y+C*g+N*p+j*f;x=Z>>>13,Z&=8191,Z+=_*h+v*l+b*u+I*c+T*a,x+=Z>>>13,Z&=8191,x=(x<<2)+x|0,x=x+P|0,P=x&8191,x=x>>>13,$+=x,s[0]=P,s[1]=$,s[2]=F,s[3]=z,s[4]=M,s[5]=V,s[6]=H,s[7]=re,s[8]=Y,s[9]=Z}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;br(n)}update(e){sl(this);const{buffer:r,blockLen:n}=this;e=Bs(e);const i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){br(this.h,this.r,this.buffer,this.pad)}digestInto(e){sl(this),S1(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:i}=this;if(i){for(r[i++]=1;i<16;i++)r[i]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}}function F1(t){const e=(n,i)=>t(i).update(Bs(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const z1=F1(t=>new U1(t));function j1(t,e,r,n,i,s=20){let o=t[0],a=t[1],c=t[2],u=t[3],l=e[0],h=e[1],f=e[2],p=e[3],g=e[4],y=e[5],d=e[6],E=e[7],m=i,w=r[0],S=r[1],R=r[2],B=o,D=a,A=c,O=u,U=l,C=h,N=f,j=p,_=g,v=y,b=d,I=E,T=m,x=w,P=S,$=R;for(let z=0;z<s;z+=2)B=B+U|0,T=W(T^B,16),_=_+T|0,U=W(U^_,12),B=B+U|0,T=W(T^B,8),_=_+T|0,U=W(U^_,7),D=D+C|0,x=W(x^D,16),v=v+x|0,C=W(C^v,12),D=D+C|0,x=W(x^D,8),v=v+x|0,C=W(C^v,7),A=A+N|0,P=W(P^A,16),b=b+P|0,N=W(N^b,12),A=A+N|0,P=W(P^A,8),b=b+P|0,N=W(N^b,7),O=O+j|0,$=W($^O,16),I=I+$|0,j=W(j^I,12),O=O+j|0,$=W($^O,8),I=I+$|0,j=W(j^I,7),B=B+C|0,$=W($^B,16),b=b+$|0,C=W(C^b,12),B=B+C|0,$=W($^B,8),b=b+$|0,C=W(C^b,7),D=D+N|0,T=W(T^D,16),I=I+T|0,N=W(N^I,12),D=D+N|0,T=W(T^D,8),I=I+T|0,N=W(N^I,7),A=A+j|0,x=W(x^A,16),_=_+x|0,j=W(j^_,12),A=A+j|0,x=W(x^A,8),_=_+x|0,j=W(j^_,7),O=O+U|0,P=W(P^O,16),v=v+P|0,U=W(U^v,12),O=O+U|0,P=W(P^O,8),v=v+P|0,U=W(U^v,7);let F=0;n[F++]=o+B|0,n[F++]=a+D|0,n[F++]=c+A|0,n[F++]=u+O|0,n[F++]=l+U|0,n[F++]=h+C|0,n[F++]=f+N|0,n[F++]=p+j|0,n[F++]=g+_|0,n[F++]=y+v|0,n[F++]=d+b|0,n[F++]=E+I|0,n[F++]=m+T|0,n[F++]=w+x|0,n[F++]=S+P|0,n[F++]=R+$|0}const k1=$1(j1,{counterRight:!1,counterLength:4,allowShortKeys:!1}),M1=new Uint8Array(16),fl=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(M1.subarray(r))},V1=new Uint8Array(32);function dl(t,e,r,n,i){const s=t(e,r,V1),o=z1.create(s);i&&fl(o,i),fl(o,n);const a=new Uint8Array(16),c=I1(a);cl(c,0,BigInt(i?i.length:0),!0),cl(c,8,BigInt(n.length),!0),o.update(a);const u=o.digest();return br(s,a),u}const K1=t=>(e,r,n)=>({encrypt(i,s){const o=i.length;s=al(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=dl(t,e,r,a,n);return s.set(c,o),br(c),s},decrypt(i,s){s=al(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=dl(t,e,r,o,n);if(!x1(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,r,s,s,1),br(c),s}}),gl=A1({blockSize:64,nonceLength:12,tagLength:16},K1(k1));class pl extends xs{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Ds(e);const n=pr(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return dr(this),this.iHash.update(e),this}digestInto(e){dr(this),Yr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Wn=(t,e,r)=>new pl(t,e).update(r).digest();Wn.create=(t,e)=>new pl(t,e);function H1(t,e,r){return Ds(t),r===void 0&&(r=new Uint8Array(t.outputLen)),Wn(t,pr(r),pr(e))}const Ns=new Uint8Array([0]),yl=new Uint8Array;function q1(t,e,r,n=32){if(Ds(t),Gr(n),n>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(n/t.outputLen);r===void 0&&(r=yl);const s=new Uint8Array(i*t.outputLen),o=Wn.create(t,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let u=0;u<i;u++)Ns[0]=u+1,a.update(u===0?yl:c).update(r).update(Ns).digestInto(c),s.set(c,t.outputLen*u),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),Ns.fill(0),s.slice(0,n)}const W1=(t,e,r,n,i)=>q1(t,H1(t,e,r),n,i);function G1(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function Y1(t,e,r){return t&e^~t&r}function Z1(t,e,r){return t&e^t&r^e&r}class X1 extends xs{constructor(e,r,n,i){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Os(this.buffer)}update(e){dr(this);const{view:r,buffer:n,blockLen:i}=this;e=pr(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Os(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){dr(this),Gu(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)r[h]=0;G1(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Os(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%r&&e.buffer.set(n),e}}const J1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),xt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),At=new Uint32Array(64);class Q1 extends X1{constructor(){super(64,32,8,!1),this.A=xt[0]|0,this.B=xt[1]|0,this.C=xt[2]|0,this.D=xt[3]|0,this.E=xt[4]|0,this.F=xt[5]|0,this.G=xt[6]|0,this.H=xt[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)At[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=At[h-15],p=At[h-2],g=it(f,7)^it(f,18)^f>>>3,y=it(p,17)^it(p,19)^p>>>10;At[h]=y+At[h-7]+g+At[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const f=it(a,6)^it(a,11)^it(a,25),p=l+f+Y1(a,c,u)+J1[h]+At[h]|0,g=(it(n,2)^it(n,13)^it(n,22))+Z1(n,i,s)|0;l=u,u=c,c=a,a=o+p|0,o=s,s=i,i=n,n=p+g|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){At.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Xr=Ju(()=>new Q1);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Gn=BigInt(0),Yn=BigInt(1),eE=BigInt(2);function Vt(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Jr(t){if(!Vt(t))throw new Error("Uint8Array expected")}function wr(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const tE=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function mr(t){Jr(t);let e="";for(let r=0;r<t.length;r++)e+=tE[t[r]];return e}function Er(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Ps(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Gn:BigInt("0x"+t)}const gt={_0:48,_9:57,A:65,F:70,a:97,f:102};function bl(t){if(t>=gt._0&&t<=gt._9)return t-gt._0;if(t>=gt.A&&t<=gt.F)return t-(gt.A-10);if(t>=gt.a&&t<=gt.f)return t-(gt.a-10)}function vr(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=bl(t.charCodeAt(s)),a=bl(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function Kt(t){return Ps(mr(t))}function Qr(t){return Jr(t),Ps(mr(Uint8Array.from(t).reverse()))}function _r(t,e){return vr(t.toString(16).padStart(e*2,"0"))}function Zn(t,e){return _r(t,e).reverse()}function rE(t){return vr(Er(t))}function ke(t,e,r){let n;if(typeof e=="string")try{n=vr(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Vt(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function en(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Jr(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}function nE(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}function iE(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}const Ls=t=>typeof t=="bigint"&&Gn<=t;function Xn(t,e,r){return Ls(t)&&Ls(e)&&Ls(r)&&e<=t&&t<r}function pt(t,e,r,n){if(!Xn(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function wl(t){let e;for(e=0;t>Gn;t>>=Yn,e+=1);return e}function sE(t,e){return t>>BigInt(e)&Yn}function oE(t,e,r){return t|(r?Yn:Gn)<<BigInt(e)}const $s=t=>(eE<<BigInt(t-1))-Yn,Us=t=>new Uint8Array(t),ml=t=>Uint8Array.from(t);function El(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=Us(t),i=Us(t),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...l)=>r(i,n,...l),c=(l=Us())=>{i=a(ml([0]),l),n=a(),l.length!==0&&(i=a(ml([1]),l),n=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let l=0;const h=[];for(;l<e;){n=a();const f=n.slice();h.push(f),l+=n.length}return en(...h)};return(l,h)=>{o(),c(l);let f;for(;!(f=h(u()));)c();return o(),f}}const aE={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Vt(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Sr(t,e,r={}){const n=(i,s,o)=>{const a=aE[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}const cE=()=>{throw new Error("not implemented")};function Fs(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}var uE=Object.freeze({__proto__:null,isBytes:Vt,abytes:Jr,abool:wr,bytesToHex:mr,numberToHexUnpadded:Er,hexToNumber:Ps,hexToBytes:vr,bytesToNumberBE:Kt,bytesToNumberLE:Qr,numberToBytesBE:_r,numberToBytesLE:Zn,numberToVarBytesBE:rE,ensureBytes:ke,concatBytes:en,equalBytes:nE,utf8ToBytes:iE,inRange:Xn,aInRange:pt,bitLen:wl,bitGet:sE,bitSet:oE,bitMask:$s,createHmacDrbg:El,validateObject:Sr,notImplemented:cE,memoized:Fs});const ge=BigInt(0),se=BigInt(1),Ht=BigInt(2),lE=BigInt(3),zs=BigInt(4),vl=BigInt(5),_l=BigInt(8);function Le(t,e){const r=t%e;return r>=ge?r:e+r}function Sl(t,e,r){if(e<ge)throw new Error("invalid exponent, negatives unsupported");if(r<=ge)throw new Error("invalid modulus");if(r===se)return ge;let n=se;for(;e>ge;)e&se&&(n=n*t%r),t=t*t%r,e>>=se;return n}function Xe(t,e,r){let n=t;for(;e-- >ge;)n*=n,n%=r;return n}function js(t,e){if(t===ge)throw new Error("invert: expected non-zero number");if(e<=ge)throw new Error("invert: expected positive modulus, got "+e);let r=Le(t,e),n=e,i=ge,s=se;for(;r!==ge;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==se)throw new Error("invert: does not exist");return Le(i,e)}function hE(t){const e=(t-se)/Ht;let r,n,i;for(r=t-se,n=0;r%Ht===ge;r/=Ht,n++);for(i=Ht;i<t&&Sl(i,e,t)!==t-se;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+se)/zs;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(r+se)/Ht;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,u=o.pow(o.mul(o.ONE,i),r),l=o.pow(a,s),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let f=1;for(let g=o.sqr(h);f<c&&!o.eql(g,o.ONE);f++)g=o.sqr(g);const p=o.pow(u,se<<BigInt(c-f-1));u=o.sqr(p),l=o.mul(l,p),h=o.mul(h,u),c=f}return l}}function fE(t){if(t%zs===lE){const e=(t+se)/zs;return function(r,n){const i=r.pow(n,e);if(!r.eql(r.sqr(i),n))throw new Error("Cannot find square root");return i}}if(t%_l===vl){const e=(t-vl)/_l;return function(r,n){const i=r.mul(n,Ht),s=r.pow(i,e),o=r.mul(n,s),a=r.mul(r.mul(o,Ht),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return hE(t)}const dE=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function gE(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=dE.reduce((n,i)=>(n[i]="function",n),e);return Sr(t,r)}function pE(t,e,r){if(r<ge)throw new Error("invalid exponent, negatives unsupported");if(r===ge)return t.ONE;if(r===se)return e;let n=t.ONE,i=e;for(;r>ge;)r&se&&(n=t.mul(n,i)),i=t.sqr(i),r>>=se;return n}function yE(t,e){const r=new Array(e.length),n=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),i=t.inv(n);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),i),r}function Il(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Dl(t,e,r=!1,n={}){if(t<=ge)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Il(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:$s(i),ZERO:ge,ONE:se,create:c=>Le(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return ge<=c&&c<t},is0:c=>c===ge,isOdd:c=>(c&se)===se,neg:c=>Le(-c,t),eql:(c,u)=>c===u,sqr:c=>Le(c*c,t),add:(c,u)=>Le(c+u,t),sub:(c,u)=>Le(c-u,t),mul:(c,u)=>Le(c*u,t),pow:(c,u)=>pE(a,c,u),div:(c,u)=>Le(c*js(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>js(c,t),sqrt:n.sqrt||(c=>(o||(o=fE(t)),o(a,c))),invertBatch:c=>yE(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>r?Zn(c,s):_r(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Qr(c):Kt(c)}});return Object.freeze(a)}function Ol(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function xl(t){const e=Ol(t);return e+Math.ceil(e/2)}function bE(t,e,r=!1){const n=t.length,i=Ol(e),s=xl(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?Qr(t):Kt(t),a=Le(o,e-se)+se;return r?Zn(a,i):_r(a,i)}const Al=BigInt(0),Jn=BigInt(1);function ks(t,e){const r=e.negate();return t?r:e}function Tl(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Ms(t,e){Tl(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function wE(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function mE(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Vs=new WeakMap,Bl=new WeakMap;function Ks(t){return Bl.get(t)||1}function EE(t,e){return{constTimeNegate:ks,hasPrecomputes(r){return Ks(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>Al;)n&Jn&&(i=i.add(s)),s=s.double(),n>>=Jn;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=Ms(n,e),o=[];let a=r,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){const{windows:s,windowSize:o}=Ms(r,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let f=0;f<s;f++){const p=f*o;let g=Number(i&u);i>>=h,g>o&&(g-=l,i+=Jn);const y=p,d=p+Math.abs(g)-1,E=f%2!==0,m=g<0;g===0?c=c.add(ks(E,n[y])):a=a.add(ks(m,n[d]))}return{p:a,f:c}},wNAFUnsafe(r,n,i,s=t.ZERO){const{windows:o,windowSize:a}=Ms(r,e),c=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let h=0;h<o;h++){const f=h*a;if(i===Al)break;let p=Number(i&c);if(i>>=l,p>a&&(p-=u,i+=Jn),p===0)continue;let g=n[f+Math.abs(p)-1];p<0&&(g=g.negate()),s=s.add(g)}return s},getPrecomputes(r,n,i){let s=Vs.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&Vs.set(n,i(s))),s},wNAFCached(r,n,i){const s=Ks(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=Ks(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){Tl(n,e),Bl.set(r,n),Vs.delete(r)}}}function vE(t,e,r,n){if(wE(r,t),mE(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=wl(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o;let l=i;for(let h=u;h>=0;h-=o){c.fill(i);for(let p=0;p<n.length;p++){const g=n[p],y=Number(g>>BigInt(h)&BigInt(a));c[y]=c[y].add(r[p])}let f=i;for(let p=c.length-1,g=i;p>0;p--)g=g.add(c[p]),f=f.add(g);if(l=l.add(f),h!==0)for(let p=0;p<o;p++)l=l.double()}return l}function Rl(t){return gE(t.Fp),Sr(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze(vs(dt(dt({},Il(t.n,t.nBitLength)),t),{p:t.Fp.ORDER}))}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const Ir=BigInt(0),Hs=BigInt(1);function _E(t){return Sr(t,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze(dt({},t))}function SE(t){const e=_E(t),{P:r}=e,n=m=>Le(m,r),i=e.montgomeryBits,s=Math.ceil(i/8),o=e.nByteLength,a=e.adjustScalarBytes||(m=>m),c=e.powPminus2||(m=>Sl(m,r-BigInt(2),r));function u(m,w,S){const R=n(m*(w-S));return w=n(w-R),S=n(S+R),[w,S]}const l=(e.a-BigInt(2))/BigInt(4);function h(m,w){pt("u",m,Ir,r),pt("scalar",w,Ir,r);const S=w,R=m;let B=Hs,D=Ir,A=m,O=Hs,U=Ir,C;for(let j=BigInt(i-1);j>=Ir;j--){const _=S>>j&Hs;U^=_,C=u(U,B,A),B=C[0],A=C[1],C=u(U,D,O),D=C[0],O=C[1],U=_;const v=B+D,b=n(v*v),I=B-D,T=n(I*I),x=b-T,P=A+O,$=A-O,F=n($*v),z=n(P*I),M=F+z,V=F-z;A=n(M*M),O=n(R*n(V*V)),B=n(b*T),D=n(x*(b+n(l*x)))}C=u(U,B,A),B=C[0],A=C[1],C=u(U,D,O),D=C[0],O=C[1];const N=c(D);return n(B*N)}function f(m){return Zn(n(m),s)}function p(m){const w=ke("u coordinate",m,s);return o===32&&(w[31]&=127),Qr(w)}function g(m){const w=ke("scalar",m),S=w.length;if(S!==s&&S!==o){let R=""+s+" or "+o;throw new Error("invalid scalar, expected "+R+" bytes, got "+S)}return Qr(a(w))}function y(m,w){const S=p(w),R=g(m),B=h(S,R);if(B===Ir)throw new Error("invalid private or public key received");return f(B)}const d=f(e.Gu);function E(m){return y(m,d)}return{scalarMult:y,scalarMultBase:E,getSharedSecret:(m,w)=>y(m,w),getPublicKey:m=>E(m),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:d}}const qs=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const IE=BigInt(1),Cl=BigInt(2),DE=BigInt(3),OE=BigInt(5);BigInt(8);function xE(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=qs,o=t*t%s*t%s,a=Xe(o,Cl,s)*o%s,c=Xe(a,IE,s)*t%s,u=Xe(c,OE,s)*c%s,l=Xe(u,e,s)*u%s,h=Xe(l,r,s)*l%s,f=Xe(h,n,s)*h%s,p=Xe(f,i,s)*f%s,g=Xe(p,i,s)*f%s,y=Xe(g,e,s)*u%s;return{pow_p_5_8:Xe(y,Cl,s)*t%s,b2:o}}function AE(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const Ws=SE({P:qs,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:t=>{const e=qs,{pow_p_5_8:r,b2:n}=xE(t);return Le(Xe(r,DE,e)*n,e)},adjustScalarBytes:AE,randomBytes:yr});function Nl(t){t.lowS!==void 0&&wr("lowS",t.lowS),t.prehash!==void 0&&wr("prehash",t.prehash)}function TE(t){const e=Rl(t);Sr(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:n,a:i}=e;if(r){if(!n.eql(i,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze(dt({},e))}const{bytesToNumberBE:BE,hexToBytes:RE}=uE;class CE extends Error{constructor(e=""){super(e)}}const yt={Err:CE,_tlv:{encode:(t,e)=>{const{Err:r}=yt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=Er(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?Er(i.length/2|128):"";return Er(t)+s+i+e},decode(t,e){const{Err:r}=yt;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=yt;if(t<bt)throw new e("integer: negative integers are not allowed");let r=Er(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=yt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return BE(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=yt,i=typeof t=="string"?RE(t):t;Jr(i);const{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=yt,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}},bt=BigInt(0),pe=BigInt(1);BigInt(2);const Pl=BigInt(3);BigInt(4);function NE(t){const e=TE(t),{Fp:r}=e,n=Dl(e.n,e.nBitLength),i=e.toBytes||((y,d,E)=>{const m=d.toAffine();return en(Uint8Array.from([4]),r.toBytes(m.x),r.toBytes(m.y))}),s=e.fromBytes||(y=>{const d=y.subarray(1),E=r.fromBytes(d.subarray(0,r.BYTES)),m=r.fromBytes(d.subarray(r.BYTES,2*r.BYTES));return{x:E,y:m}});function o(y){const{a:d,b:E}=e,m=r.sqr(y),w=r.mul(m,y);return r.add(r.add(w,r.mul(y,d)),E)}if(!r.eql(r.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(y){return Xn(y,pe,e.n)}function c(y){const{allowedPrivateKeyLengths:d,nByteLength:E,wrapPrivateKey:m,n:w}=e;if(d&&typeof y!="bigint"){if(Vt(y)&&(y=mr(y)),typeof y!="string"||!d.includes(y.length))throw new Error("invalid private key");y=y.padStart(E*2,"0")}let S;try{S=typeof y=="bigint"?y:Kt(ke("private key",y,E))}catch{throw new Error("invalid private key, expected hex or "+E+" bytes, got "+typeof y)}return m&&(S=Le(S,w)),pt("private key",S,pe,w),S}function u(y){if(!(y instanceof f))throw new Error("ProjectivePoint expected")}const l=Fs((y,d)=>{const{px:E,py:m,pz:w}=y;if(r.eql(w,r.ONE))return{x:E,y:m};const S=y.is0();d==null&&(d=S?r.ONE:r.inv(w));const R=r.mul(E,d),B=r.mul(m,d),D=r.mul(w,d);if(S)return{x:r.ZERO,y:r.ZERO};if(!r.eql(D,r.ONE))throw new Error("invZ was invalid");return{x:R,y:B}}),h=Fs(y=>{if(y.is0()){if(e.allowInfinityPoint&&!r.is0(y.py))return;throw new Error("bad point: ZERO")}const{x:d,y:E}=y.toAffine();if(!r.isValid(d)||!r.isValid(E))throw new Error("bad point: x or y not FE");const m=r.sqr(E),w=o(d);if(!r.eql(m,w))throw new Error("bad point: equation left != right");if(!y.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class f{constructor(d,E,m){if(this.px=d,this.py=E,this.pz=m,d==null||!r.isValid(d))throw new Error("x required");if(E==null||!r.isValid(E))throw new Error("y required");if(m==null||!r.isValid(m))throw new Error("z required");Object.freeze(this)}static fromAffine(d){const{x:E,y:m}=d||{};if(!d||!r.isValid(E)||!r.isValid(m))throw new Error("invalid affine point");if(d instanceof f)throw new Error("projective point not allowed");const w=S=>r.eql(S,r.ZERO);return w(E)&&w(m)?f.ZERO:new f(E,m,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){const E=r.invertBatch(d.map(m=>m.pz));return d.map((m,w)=>m.toAffine(E[w])).map(f.fromAffine)}static fromHex(d){const E=f.fromAffine(s(ke("pointHex",d)));return E.assertValidity(),E}static fromPrivateKey(d){return f.BASE.multiply(c(d))}static msm(d,E){return vE(f,n,d,E)}_setWindowSize(d){g.setWindowSize(this,d)}assertValidity(){h(this)}hasEvenY(){const{y:d}=this.toAffine();if(r.isOdd)return!r.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){u(d);const{px:E,py:m,pz:w}=this,{px:S,py:R,pz:B}=d,D=r.eql(r.mul(E,B),r.mul(S,w)),A=r.eql(r.mul(m,B),r.mul(R,w));return D&&A}negate(){return new f(this.px,r.neg(this.py),this.pz)}double(){const{a:d,b:E}=e,m=r.mul(E,Pl),{px:w,py:S,pz:R}=this;let B=r.ZERO,D=r.ZERO,A=r.ZERO,O=r.mul(w,w),U=r.mul(S,S),C=r.mul(R,R),N=r.mul(w,S);return N=r.add(N,N),A=r.mul(w,R),A=r.add(A,A),B=r.mul(d,A),D=r.mul(m,C),D=r.add(B,D),B=r.sub(U,D),D=r.add(U,D),D=r.mul(B,D),B=r.mul(N,B),A=r.mul(m,A),C=r.mul(d,C),N=r.sub(O,C),N=r.mul(d,N),N=r.add(N,A),A=r.add(O,O),O=r.add(A,O),O=r.add(O,C),O=r.mul(O,N),D=r.add(D,O),C=r.mul(S,R),C=r.add(C,C),O=r.mul(C,N),B=r.sub(B,O),A=r.mul(C,U),A=r.add(A,A),A=r.add(A,A),new f(B,D,A)}add(d){u(d);const{px:E,py:m,pz:w}=this,{px:S,py:R,pz:B}=d;let D=r.ZERO,A=r.ZERO,O=r.ZERO;const U=e.a,C=r.mul(e.b,Pl);let N=r.mul(E,S),j=r.mul(m,R),_=r.mul(w,B),v=r.add(E,m),b=r.add(S,R);v=r.mul(v,b),b=r.add(N,j),v=r.sub(v,b),b=r.add(E,w);let I=r.add(S,B);return b=r.mul(b,I),I=r.add(N,_),b=r.sub(b,I),I=r.add(m,w),D=r.add(R,B),I=r.mul(I,D),D=r.add(j,_),I=r.sub(I,D),O=r.mul(U,b),D=r.mul(C,_),O=r.add(D,O),D=r.sub(j,O),O=r.add(j,O),A=r.mul(D,O),j=r.add(N,N),j=r.add(j,N),_=r.mul(U,_),b=r.mul(C,b),j=r.add(j,_),_=r.sub(N,_),_=r.mul(U,_),b=r.add(b,_),N=r.mul(j,b),A=r.add(A,N),N=r.mul(I,b),D=r.mul(v,D),D=r.sub(D,N),N=r.mul(v,j),O=r.mul(I,O),O=r.add(O,N),new f(D,A,O)}subtract(d){return this.add(d.negate())}is0(){return this.equals(f.ZERO)}wNAF(d){return g.wNAFCached(this,d,f.normalizeZ)}multiplyUnsafe(d){const{endo:E,n:m}=e;pt("scalar",d,bt,m);const w=f.ZERO;if(d===bt)return w;if(this.is0()||d===pe)return this;if(!E||g.hasPrecomputes(this))return g.wNAFCachedUnsafe(this,d,f.normalizeZ);let{k1neg:S,k1:R,k2neg:B,k2:D}=E.splitScalar(d),A=w,O=w,U=this;for(;R>bt||D>bt;)R&pe&&(A=A.add(U)),D&pe&&(O=O.add(U)),U=U.double(),R>>=pe,D>>=pe;return S&&(A=A.negate()),B&&(O=O.negate()),O=new f(r.mul(O.px,E.beta),O.py,O.pz),A.add(O)}multiply(d){const{endo:E,n:m}=e;pt("scalar",d,pe,m);let w,S;if(E){const{k1neg:R,k1:B,k2neg:D,k2:A}=E.splitScalar(d);let{p:O,f:U}=this.wNAF(B),{p:C,f:N}=this.wNAF(A);O=g.constTimeNegate(R,O),C=g.constTimeNegate(D,C),C=new f(r.mul(C.px,E.beta),C.py,C.pz),w=O.add(C),S=U.add(N)}else{const{p:R,f:B}=this.wNAF(d);w=R,S=B}return f.normalizeZ([w,S])[0]}multiplyAndAddUnsafe(d,E,m){const w=f.BASE,S=(B,D)=>D===bt||D===pe||!B.equals(w)?B.multiplyUnsafe(D):B.multiply(D),R=S(this,E).add(S(d,m));return R.is0()?void 0:R}toAffine(d){return l(this,d)}isTorsionFree(){const{h:d,isTorsionFree:E}=e;if(d===pe)return!0;if(E)return E(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:d,clearCofactor:E}=e;return d===pe?this:E?E(f,this):this.multiplyUnsafe(e.h)}toRawBytes(d=!0){return wr("isCompressed",d),this.assertValidity(),i(f,this,d)}toHex(d=!0){return wr("isCompressed",d),mr(this.toRawBytes(d))}}f.BASE=new f(e.Gx,e.Gy,r.ONE),f.ZERO=new f(r.ZERO,r.ONE,r.ZERO);const p=e.nBitLength,g=EE(f,e.endo?Math.ceil(p/2):p);return{CURVE:e,ProjectivePoint:f,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function PE(t){const e=Rl(t);return Sr(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze(dt({lowS:!0},e))}function LE(t){const e=PE(t),{Fp:r,n}=e,i=r.BYTES+1,s=2*r.BYTES+1;function o(_){return Le(_,n)}function a(_){return js(_,n)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:l,isWithinCurveOrder:h}=NE(vs(dt({},e),{toBytes(_,v,b){const I=v.toAffine(),T=r.toBytes(I.x),x=en;return wr("isCompressed",b),b?x(Uint8Array.from([v.hasEvenY()?2:3]),T):x(Uint8Array.from([4]),T,r.toBytes(I.y))},fromBytes(_){const v=_.length,b=_[0],I=_.subarray(1);if(v===i&&(b===2||b===3)){const T=Kt(I);if(!Xn(T,pe,r.ORDER))throw new Error("Point is not on curve");const x=l(T);let P;try{P=r.sqrt(x)}catch(F){const z=F instanceof Error?": "+F.message:"";throw new Error("Point is not on curve"+z)}const $=(P&pe)===pe;return(b&1)===1!==$&&(P=r.neg(P)),{x:T,y:P}}else if(v===s&&b===4){const T=r.fromBytes(I.subarray(0,r.BYTES)),x=r.fromBytes(I.subarray(r.BYTES,2*r.BYTES));return{x:T,y:x}}else{const T=i,x=s;throw new Error("invalid Point, expected length of "+T+", or uncompressed "+x+", got "+v)}}})),f=_=>mr(_r(_,e.nByteLength));function p(_){const v=n>>pe;return _>v}function g(_){return p(_)?o(-_):_}const y=(_,v,b)=>Kt(_.slice(v,b));class d{constructor(v,b,I){this.r=v,this.s=b,this.recovery=I,this.assertValidity()}static fromCompact(v){const b=e.nByteLength;return v=ke("compactSignature",v,b*2),new d(y(v,0,b),y(v,b,2*b))}static fromDER(v){const{r:b,s:I}=yt.toSig(ke("DER",v));return new d(b,I)}assertValidity(){pt("r",this.r,pe,n),pt("s",this.s,pe,n)}addRecoveryBit(v){return new d(this.r,this.s,v)}recoverPublicKey(v){const{r:b,s:I,recovery:T}=this,x=B(ke("msgHash",v));if(T==null||![0,1,2,3].includes(T))throw new Error("recovery id invalid");const P=T===2||T===3?b+e.n:b;if(P>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const $=(T&1)===0?"02":"03",F=c.fromHex($+f(P)),z=a(P),M=o(-x*z),V=o(I*z),H=c.BASE.multiplyAndAddUnsafe(F,M,V);if(!H)throw new Error("point at infinify");return H.assertValidity(),H}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new d(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return vr(this.toDERHex())}toDERHex(){return yt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return vr(this.toCompactHex())}toCompactHex(){return f(this.r)+f(this.s)}}const E={isValidPrivateKey(_){try{return u(_),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const _=xl(e.n);return bE(e.randomBytes(_),e.n)},precompute(_=8,v=c.BASE){return v._setWindowSize(_),v.multiply(BigInt(3)),v}};function m(_,v=!0){return c.fromPrivateKey(_).toRawBytes(v)}function w(_){const v=Vt(_),b=typeof _=="string",I=(v||b)&&_.length;return v?I===i||I===s:b?I===2*i||I===2*s:_ instanceof c}function S(_,v,b=!0){if(w(_))throw new Error("first arg must be private key");if(!w(v))throw new Error("second arg must be public key");return c.fromHex(v).multiply(u(_)).toRawBytes(b)}const R=e.bits2int||function(_){if(_.length>8192)throw new Error("input is too large");const v=Kt(_),b=_.length*8-e.nBitLength;return b>0?v>>BigInt(b):v},B=e.bits2int_modN||function(_){return o(R(_))},D=$s(e.nBitLength);function A(_){return pt("num < 2^"+e.nBitLength,_,bt,D),_r(_,e.nByteLength)}function O(_,v,b=U){if(["recovered","canonical"].some(Y=>Y in b))throw new Error("sign() legacy options not supported");const{hash:I,randomBytes:T}=e;let{lowS:x,prehash:P,extraEntropy:$}=b;x==null&&(x=!0),_=ke("msgHash",_),Nl(b),P&&(_=ke("prehashed msgHash",I(_)));const F=B(_),z=u(v),M=[A(z),A(F)];if($!=null&&$!==!1){const Y=$===!0?T(r.BYTES):$;M.push(ke("extraEntropy",Y))}const V=en(...M),H=F;function re(Y){const Z=R(Y);if(!h(Z))return;const Se=a(Z),ce=c.BASE.multiply(Z).toAffine(),ue=o(ce.x);if(ue===bt)return;const De=o(Se*o(H+ue*z));if(De===bt)return;let Oe=(ce.x===ue?0:2)|Number(ce.y&pe),Gt=De;return x&&p(De)&&(Gt=g(De),Oe^=1),new d(ue,Gt,Oe)}return{seed:V,k2sig:re}}const U={lowS:e.lowS,prehash:!1},C={lowS:e.lowS,prehash:!1};function N(_,v,b=U){const{seed:I,k2sig:T}=O(_,v,b),x=e;return El(x.hash.outputLen,x.nByteLength,x.hmac)(I,T)}c.BASE._setWindowSize(8);function j(_,v,b,I=C){var T;const x=_;v=ke("msgHash",v),b=ke("publicKey",b);const{lowS:P,prehash:$,format:F}=I;if(Nl(I),"strict"in I)throw new Error("options.strict was renamed to lowS");if(F!==void 0&&F!=="compact"&&F!=="der")throw new Error("format must be compact or der");const z=typeof x=="string"||Vt(x),M=!z&&!F&&typeof x=="object"&&x!==null&&typeof x.r=="bigint"&&typeof x.s=="bigint";if(!z&&!M)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let V,H;try{if(M&&(V=new d(x.r,x.s)),z){try{F!=="compact"&&(V=d.fromDER(x))}catch(Oe){if(!(Oe instanceof yt.Err))throw Oe}!V&&F!=="der"&&(V=d.fromCompact(x))}H=c.fromHex(b)}catch{return!1}if(!V||P&&V.hasHighS())return!1;$&&(v=e.hash(v));const{r:re,s:Y}=V,Z=B(v),Se=a(Y),ce=o(Z*Se),ue=o(re*Se),De=(T=c.BASE.multiplyAndAddUnsafe(H,ce,ue))==null?void 0:T.toAffine();return De?o(De.x)===re:!1}return{CURVE:e,getPublicKey:m,getSharedSecret:S,sign:N,verify:j,ProjectivePoint:c,Signature:d,utils:E}}function $E(t){return{hash:t,hmac:(e,...r)=>Wn(t,e,g1(...r)),randomBytes:yr}}function UE(t,e){const r=n=>LE(dt(dt({},t),$E(n)));return vs(dt({},r(e)),{create:r})}const Ll=Dl(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),FE=Ll.create(BigInt("-3")),zE=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),jE=UE({a:FE,b:zE,Fp:Ll,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},Xr),$l="base10",Ae="base16",qt="base64pad",Gs="base64url",tn="utf8",Ul=0,Dr=1,Qn=2,kE=0,Fl=1,rn=12,Ys=32;function ME(){const t=Ws.utils.randomPrivateKey(),e=Ws.getPublicKey(t);return{privateKey:Pe(t,Ae),publicKey:Pe(e,Ae)}}function Zs(){const t=yr(Ys);return Pe(t,Ae)}function VE(t,e){const r=Ws.getSharedSecret(ze(t,Ae),ze(e,Ae)),n=W1(Xr,r,void 0,void 0,Ys);return Pe(n,Ae)}function KE(t){const e=Xr(ze(t,Ae));return Pe(e,Ae)}function ei(t){const e=Xr(ze(t,tn));return Pe(e,Ae)}function zl(t){return ze(`${t}`,$l)}function Wt(t){return Number(Pe(t,$l))}function jl(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function kl(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function HE(t){const e=zl(typeof t.type<"u"?t.type:Ul);if(Wt(e)===Dr&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?ze(t.senderPublicKey,Ae):void 0,n=typeof t.iv<"u"?ze(t.iv,Ae):yr(rn),i=ze(t.symKey,Ae),s=gl(i,n).encrypt(ze(t.message,tn)),o=Ml({type:e,sealed:s,iv:n,senderPublicKey:r});return t.encoding===Gs?jl(o):o}function qE(t){const e=ze(t.symKey,Ae),{sealed:r,iv:n}=nn({encoded:t.encoded,encoding:t.encoding}),i=gl(e,n).decrypt(r);if(i===null)throw new Error("Failed to decrypt");return Pe(i,tn)}function WE(t,e){const r=zl(Qn),n=yr(rn),i=ze(t,tn),s=Ml({type:r,sealed:i,iv:n});return e===Gs?jl(s):s}function GE(t,e){const{sealed:r}=nn({encoded:t,encoding:e});return Pe(r,tn)}function Ml(t){if(Wt(t.type)===Qn)return Pe(Hr([t.type,t.sealed]),qt);if(Wt(t.type)===Dr){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Pe(Hr([t.type,t.senderPublicKey,t.iv,t.sealed]),qt)}return Pe(Hr([t.type,t.iv,t.sealed]),qt)}function nn(t){const e=(t.encoding||qt)===Gs?kl(t.encoded):t.encoded,r=ze(e,qt),n=r.slice(kE,Fl),i=Fl;if(Wt(n)===Dr){const c=i+Ys,u=c+rn,l=r.slice(i,c),h=r.slice(c,u),f=r.slice(u);return{type:n,sealed:f,iv:h,senderPublicKey:l}}if(Wt(n)===Qn){const c=r.slice(i),u=yr(rn);return{type:n,sealed:c,iv:u}}const s=i+rn,o=r.slice(i,s),a=r.slice(s);return{type:n,sealed:a,iv:o}}function YE(t,e){const r=nn({encoded:t,encoding:e?.encoding});return Vl({type:Wt(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Pe(r.senderPublicKey,Ae):void 0,receiverPublicKey:e?.receiverPublicKey})}function Vl(t){const e=t?.type||Ul;if(e===Dr){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Kl(t){return t.type===Dr&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Hl(t){return t.type===Qn}function ZE(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return Hr([new Uint8Array([4]),e,r])}function XE(t,e){const[r,n,i]=t.split("."),s=Buffer.from(kl(i),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${r}.${n}`,u=Xr(c),l=ZE(e);if(!jE.verify(Hr([o,a]),u,l))throw new Error("Invalid signature");return qi(t).payload}const JE="irn";function ti(t){return t?.relay||{protocol:JE}}function sn(t){const e=Fm[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function QE(t,e="-"){const r={},n="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(n)){const s=i.replace(n,""),o=t[i];r[s]=o}}),r}function ql(t){if(!t.includes("wc:")){const u=Wu(t);u!=null&&u.includes("wc:")&&(t=u)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,n=t.substring(0,e),i=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(s),a={};o.forEach((u,l)=>{a[l]=u});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:n,topic:ev(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:QE(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function ev(t){return t.startsWith("//")?t.substring(2):t}function tv(t,e="-"){const r="relay",n={};return Object.keys(t).forEach(i=>{const s=i,o=r+e+s;t[s]&&(n[o]=t[s])}),n}function Wl(t){const e=new URLSearchParams,r=tv(t.relay);Object.keys(r).sort().forEach(i=>{e.set(i,r[i])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const n=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${n}`}const rv={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},nv={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function X(t,e){const{message:r,code:n}=nv[t];return{message:e?`${r} ${e}`:r,code:n}}function on(t,e){const{message:r,code:n}=rv[t];return{message:e?`${r} ${e}`:r,code:n}}function ri(t){return typeof t>"u"}function Gl(t,e){return e&&ri(t)?!0:typeof t=="string"&&!!t.trim().length}function iv(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(Gl(t,!1)){if(e(t))return!0;const r=Wu(t);return e(r)}}catch{}return!1}function sv(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function ov(t){return t?.topic}function Xs(t){return typeof t<"u"&&typeof t!==null}function Yl(){const t=Kn();return new Promise(e=>{switch(t){case Ze.browser:e(av());break;case Ze.reactNative:e(cv());break;case Ze.node:e(uv());break;default:e(!0)}})}function av(){return qr()&&navigator?.onLine}async function cv(){if(Mt()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t?.isConnected}return!0}function uv(){return!0}function lv(t){switch(Kn()){case Ze.browser:hv(t);break;case Ze.reactNative:fv(t);break}}function hv(t){!Mt()&&qr()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function fv(t){Mt()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function dv(){var t;return qr()&&sr()?((t=sr())==null?void 0:t.visibilityState)==="visible":!0}var gv=Object.defineProperty,pv=(t,e,r)=>e in t?gv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,st=(t,e,r)=>pv(t,typeof e!="symbol"?e+"":e,r);class Zl{constructor(e,r){this.core=e,this.logger=r,st(this,"keychain",new Map),st(this,"name",ia),st(this,"version",sa),st(this,"initialized",!1),st(this,"storagePrefix",We),st(this,"init",async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}}),st(this,"has",n=>(this.isInitialized(),this.keychain.has(n))),st(this,"set",async(n,i)=>{this.isInitialized(),this.keychain.set(n,i),await this.persist()}),st(this,"get",n=>{this.isInitialized();const i=this.keychain.get(n);if(typeof i>"u"){const{message:s}=X("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(s)}return i}),st(this,"del",async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()}),this.core=e,this.logger=Be(r,this.name)}get context(){return Ue(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,_s(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ss(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=X("NOT_INITIALIZED",this.name);throw new Error(e)}}}var yv=Object.defineProperty,bv=(t,e,r)=>e in t?yv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ve=(t,e,r)=>bv(t,typeof e!="symbol"?e+"":e,r);class Xl{constructor(e,r,n){this.core=e,this.logger=r,ve(this,"name",ra),ve(this,"keychain"),ve(this,"randomSessionIdentifier",Zs()),ve(this,"initialized",!1),ve(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),ve(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),ve(this,"getClientId",async()=>{this.isInitialized();const i=await this.getClientSeed(),s=xc(i);return Oc(s.publicKey)}),ve(this,"generateKeyPair",()=>{this.isInitialized();const i=ME();return this.setPrivateKey(i.publicKey,i.privateKey)}),ve(this,"signJWT",async i=>{this.isInitialized();const s=await this.getClientSeed(),o=xc(s),a=this.randomSessionIdentifier;return await eb(a,i,na,o)}),ve(this,"generateSharedKey",(i,s,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=VE(a,s);return this.setSymKey(c,o)}),ve(this,"setSymKey",async(i,s)=>{this.isInitialized();const o=s||KE(i);return await this.keychain.set(o,i),o}),ve(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),ve(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),ve(this,"encode",async(i,s,o)=>{this.isInitialized();const a=Vl(o),c=Pt(s);if(Hl(a))return WE(c,o?.encoding);if(Kl(a)){const f=a.senderPublicKey,p=a.receiverPublicKey;i=await this.generateSharedKey(f,p)}const u=this.getSymKey(i),{type:l,senderPublicKey:h}=a;return HE({type:l,symKey:u,message:c,senderPublicKey:h,encoding:o?.encoding})}),ve(this,"decode",async(i,s,o)=>{this.isInitialized();const a=YE(s,o);if(Hl(a)){const c=GE(s,o?.encoding);return Xt(c)}if(Kl(a)){const c=a.receiverPublicKey,u=a.senderPublicKey;i=await this.generateSharedKey(c,u)}try{const c=this.getSymKey(i),u=qE({symKey:c,encoded:s,encoding:o?.encoding});return Xt(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),ve(this,"getPayloadType",(i,s=qt)=>{const o=nn({encoded:i,encoding:s});return Wt(o.type)}),ve(this,"getPayloadSenderPublicKey",(i,s=qt)=>{const o=nn({encoded:i,encoding:s});return o.senderPublicKey?Pe(o.senderPublicKey,Ae):void 0}),this.core=e,this.logger=Be(r,this.name),this.keychain=n||new Zl(this.core,this.logger)}get context(){return Ue(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(_i)}catch{e=Zs(),await this.keychain.set(_i,e)}return ze(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=X("NOT_INITIALIZED",this.name);throw new Error(e)}}}var wv=Object.defineProperty,mv=Object.defineProperties,Ev=Object.getOwnPropertyDescriptors,Jl=Object.getOwnPropertySymbols,vv=Object.prototype.hasOwnProperty,_v=Object.prototype.propertyIsEnumerable,Js=(t,e,r)=>e in t?wv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Sv=(t,e)=>{for(var r in e||(e={}))vv.call(e,r)&&Js(t,r,e[r]);if(Jl)for(var r of Jl(e))_v.call(e,r)&&Js(t,r,e[r]);return t},Iv=(t,e)=>mv(t,Ev(e)),Me=(t,e,r)=>Js(t,typeof e!="symbol"?e+"":e,r);class Ql extends Hd{constructor(e,r){super(e,r),this.logger=e,this.core=r,Me(this,"messages",new Map),Me(this,"messagesWithoutClientAck",new Map),Me(this,"name",oa),Me(this,"version",aa),Me(this,"initialized",!1),Me(this,"storagePrefix",We),Me(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}}),Me(this,"set",async(n,i,s)=>{this.isInitialized();const o=ei(i);let a=this.messages.get(n);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(n,a),s===Lr.inbound){const c=this.messagesWithoutClientAck.get(n)||{};this.messagesWithoutClientAck.set(n,Iv(Sv({},c),{[o]:i}))}return await this.persist(),o}),Me(this,"get",n=>{this.isInitialized();let i=this.messages.get(n);return typeof i>"u"&&(i={}),i}),Me(this,"getWithoutAck",n=>{this.isInitialized();const i={};for(const s of n){const o=this.messagesWithoutClientAck.get(s)||{};i[s]=Object.values(o)}return i}),Me(this,"has",(n,i)=>{this.isInitialized();const s=this.get(n),o=ei(i);return typeof s[o]<"u"}),Me(this,"ack",async(n,i)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(n);if(typeof s>"u")return;const o=ei(i);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(n):this.messagesWithoutClientAck.set(n,s),await this.persist()}),Me(this,"del",async n=>{this.isInitialized(),this.messages.delete(n),this.messagesWithoutClientAck.delete(n),await this.persist()}),this.logger=Be(e,this.name),this.core=r}get context(){return Ue(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,_s(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,_s(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ss(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Ss(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=X("NOT_INITIALIZED",this.name);throw new Error(e)}}}const Dv="PARSE_ERROR",Ov="INVALID_REQUEST",xv="METHOD_NOT_FOUND",Av="INVALID_PARAMS",eh="INTERNAL_ERROR",Qs="SERVER_ERROR",Tv=[-32700,-32600,-32601,-32602,-32603],an={[Dv]:{code:-32700,message:"Parse error"},[Ov]:{code:-32600,message:"Invalid Request"},[xv]:{code:-32601,message:"Method not found"},[Av]:{code:-32602,message:"Invalid params"},[eh]:{code:-32603,message:"Internal error"},[Qs]:{code:-32e3,message:"Server error"}},th=Qs;function Bv(t){return Tv.includes(t)}function rh(t){return Object.keys(an).includes(t)?an[t]:an[th]}function Rv(t){const e=Object.values(an).find(r=>r.code===t);return e||an[th]}function Cv(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var nh={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var eo=function(t,e){return eo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},eo(t,e)};function Nv(t,e){eo(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var to=function(){return to=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},to.apply(this,arguments)};function Pv(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function Lv(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function $v(t,e){return function(r,n){e(r,n,t)}}function Uv(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Fv(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(t,e||[])).next())})}function zv(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function jv(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function kv(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function ro(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ih(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function Mv(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ih(arguments[e]));return t}function Vv(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n}function cn(t){return this instanceof cn?(this.v=t,this):new cn(t)}function Kv(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){n[f]&&(i[f]=function(p){return new Promise(function(g,y){s.push([f,p,g,y])>1||a(f,p)})})}function a(f,p){try{c(n[f](p))}catch(g){h(s[0][3],g)}}function c(f){f.value instanceof cn?Promise.resolve(f.value.v).then(u,l):h(s[0][2],f)}function u(f){a("next",f)}function l(f){a("throw",f)}function h(f,p){f(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Hv(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(o){return(r=!r)?{value:cn(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function qv(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof ro=="function"?ro(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function Wv(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Gv(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Yv(t){return t&&t.__esModule?t:{default:t}}function Zv(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Xv(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var Jv=Object.freeze({__proto__:null,__extends:Nv,get __assign(){return to},__rest:Pv,__decorate:Lv,__param:$v,__metadata:Uv,__awaiter:Fv,__generator:zv,__createBinding:jv,__exportStar:kv,__values:ro,__read:ih,__spread:Mv,__spreadArrays:Vv,__await:cn,__asyncGenerator:Kv,__asyncDelegator:Hv,__asyncValues:qv,__makeTemplateObject:Wv,__importStar:Gv,__importDefault:Yv,__classPrivateFieldGet:Zv,__classPrivateFieldSet:Xv}),Qv=bo(Jv),wt={},sh;function e_(){if(sh)return wt;sh=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.isBrowserCryptoAvailable=wt.getSubtleCrypto=wt.getBrowerCrypto=void 0;function t(){return Qe?.crypto||Qe?.msCrypto||{}}wt.getBrowerCrypto=t;function e(){const n=t();return n.subtle||n.webkitSubtle}wt.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return wt.isBrowserCryptoAvailable=r,wt}var mt={},oh;function t_(){if(oh)return mt;oh=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.isBrowser=mt.isNode=mt.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}mt.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}mt.isNode=e;function r(){return!t()&&!e()}return mt.isBrowser=r,mt}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Qv;e.__exportStar(e_(),t),e.__exportStar(t_(),t)})(nh);function ah(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function no(t=6){return BigInt(ah(t))}function io(t,e,r){return{id:r||ah(),jsonrpc:"2.0",method:t,params:e}}function ch(t,e){return{id:t,jsonrpc:"2.0",result:e}}function uh(t,e,r){return{id:t,jsonrpc:"2.0",error:r_(e,r)}}function r_(t,e){return typeof t>"u"?rh(eh):(typeof t=="string"&&(t=Object.assign(Object.assign({},rh(Qs)),{message:t})),typeof e<"u"&&(t.data=e),Bv(t.code)&&(t=Rv(t.code)),t)}class n_{}class i_ extends n_{constructor(){super()}}class s_ extends i_{constructor(e){super()}}const o_="^wss?:";function a_(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function c_(t,e){const r=a_(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function lh(t){return c_(t,o_)}function u_(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function hh(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function fh(t){return hh(t)&&"method"in t}function so(t){return hh(t)&&(dh(t)||ni(t))}function dh(t){return"result"in t}function ni(t){return"error"in t}class l_ extends s_{constructor(e){super(e),this.events=new Ve.exports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(io(e.method,e.params||[],e.id||no().toString()),r)}async requestStrict(e,r){return new Promise(async(n,i)=>{if(!this.connection.connected)try{await this.open()}catch(s){i(s)}this.events.on(`${e.id}`,s=>{ni(s)?i(s.error):n(s.result)});try{await this.connection.send(e,r)}catch(s){i(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),so(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const h_=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),f_=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",gh=t=>t.split("?")[0],ph=10,d_=h_();class g_{constructor(e){if(this.url=e,this.events=new Ve.exports.EventEmitter,this.registering=!1,!lh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Pt(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!lh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,n)=>{const i=nh.isReactNative()?void 0:{rejectUnauthorized:!u_(e)},s=new d_(e,[],i);f_()?s.onerror=o=>{const a=o;n(this.emitError(a.error))}:s.on("error",o=>{n(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),r(s)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Xt(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const n=this.parseError(r),i=n.message||n.toString(),s=uh(e,i);this.events.emit("payload",s)}parseError(e,r=this.url){return Cv(e,gh(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>ph&&this.events.setMaxListeners(ph)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${gh(this.url)}`));return this.events.emit("register_error",r),r}}var p_=Object.defineProperty,y_=Object.defineProperties,b_=Object.getOwnPropertyDescriptors,yh=Object.getOwnPropertySymbols,w_=Object.prototype.hasOwnProperty,m_=Object.prototype.propertyIsEnumerable,oo=(t,e,r)=>e in t?p_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ii=(t,e)=>{for(var r in e||(e={}))w_.call(e,r)&&oo(t,r,e[r]);if(yh)for(var r of yh(e))m_.call(e,r)&&oo(t,r,e[r]);return t},ao=(t,e)=>y_(t,b_(e)),Je=(t,e,r)=>oo(t,typeof e!="symbol"?e+"":e,r);class E_ extends qd{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,Je(this,"events",new Ve.exports.EventEmitter),Je(this,"name",ca),Je(this,"queue",new Map),Je(this,"publishTimeout",k.toMiliseconds(k.ONE_MINUTE)),Je(this,"initialPublishTimeout",k.toMiliseconds(k.ONE_SECOND*15)),Je(this,"needsTransportRestart",!1),Je(this,"publish",async(n,i,s)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:i,opts:s}});const a=s?.ttl||Si,c=ti(s),u=s?.prompt||!1,l=s?.tag||0,h=s?.id||no().toString(),f={topic:n,message:i,opts:{ttl:a,relay:c,prompt:u,tag:l,id:h,attestation:s?.attestation,tvf:s?.tvf}},p=`Failed to publish payload, please try again. id:${h} tag:${l}`;try{const g=new Promise(async y=>{const d=({id:m})=>{f.opts.id===m&&(this.removeRequestFromQueue(m),this.relayer.events.removeListener(be.publish,d),y(f))};this.relayer.events.on(be.publish,d);const E=Dt(new Promise((m,w)=>{this.rpcPublish({topic:n,message:i,ttl:a,prompt:u,tag:l,id:h,attestation:s?.attestation,tvf:s?.tvf}).then(m).catch(S=>{this.logger.warn(S,S?.message),w(S)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${h} tag:${l}`);try{await E,this.events.removeListener(be.publish,d)}catch(m){this.queue.set(h,ao(ii({},f),{attempt:1})),this.logger.warn(m,m?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:h,topic:n,message:i,opts:s}}),await Dt(g,this.publishTimeout,p)}catch(g){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(g),(o=s?.internal)!=null&&o.throwOnFailedPublish)throw g}finally{this.queue.delete(h)}}),Je(this,"on",(n,i)=>{this.events.on(n,i)}),Je(this,"once",(n,i)=>{this.events.once(n,i)}),Je(this,"off",(n,i)=>{this.events.off(n,i)}),Je(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.relayer=e,this.logger=Be(r,this.name),this.registerEventListeners()}get context(){return Ue(this.logger)}async rpcPublish(e){var r,n,i,s;const{topic:o,message:a,ttl:c=Si,prompt:u,tag:l,id:h,attestation:f,tvf:p}=e,g={method:sn(ti().protocol).publish,params:ii({topic:o,message:a,ttl:c,prompt:u,tag:l,attestation:f},p),id:h};ri((r=g.params)==null?void 0:r.prompt)&&((n=g.params)==null||delete n.prompt),ri((i=g.params)==null?void 0:i.tag)&&((s=g.params)==null||delete s.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:g});const y=await this.relayer.request(g);return this.relayer.events.emit(be.publish,e),this.logger.debug("Successfully Published Payload"),y}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{const n=e.attempt+1;this.queue.set(r,ao(ii({},e),{attempt:n}));const{topic:i,message:s,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${n}`),await this.rpcPublish(ao(ii({},e),{topic:i,message:s,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Ct.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(be.connection_stalled);return}this.checkQueue()}),this.relayer.on(be.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var v_=Object.defineProperty,__=(t,e,r)=>e in t?v_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Or=(t,e,r)=>__(t,typeof e!="symbol"?e+"":e,r);class S_{constructor(){Or(this,"map",new Map),Or(this,"set",(e,r)=>{const n=this.get(e);this.exists(e,r)||this.map.set(e,[...n,r])}),Or(this,"get",e=>this.map.get(e)||[]),Or(this,"exists",(e,r)=>this.get(e).includes(r)),Or(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,r))return;const i=n.filter(s=>s!==r);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),Or(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var I_=Object.defineProperty,D_=Object.defineProperties,O_=Object.getOwnPropertyDescriptors,bh=Object.getOwnPropertySymbols,x_=Object.prototype.hasOwnProperty,A_=Object.prototype.propertyIsEnumerable,co=(t,e,r)=>e in t?I_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,un=(t,e)=>{for(var r in e||(e={}))x_.call(e,r)&&co(t,r,e[r]);if(bh)for(var r of bh(e))A_.call(e,r)&&co(t,r,e[r]);return t},uo=(t,e)=>D_(t,O_(e)),Q=(t,e,r)=>co(t,typeof e!="symbol"?e+"":e,r);class wh extends Yd{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,Q(this,"subscriptions",new Map),Q(this,"topicMap",new S_),Q(this,"events",new Ve.exports.EventEmitter),Q(this,"name",ya),Q(this,"version",ba),Q(this,"pending",new Map),Q(this,"cached",[]),Q(this,"initialized",!1),Q(this,"storagePrefix",We),Q(this,"subscribeTimeout",k.toMiliseconds(k.ONE_MINUTE)),Q(this,"initialSubscribeTimeout",k.toMiliseconds(k.ONE_SECOND*15)),Q(this,"clientId"),Q(this,"batchSubscribeTopicsLimit",500),Q(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Q(this,"subscribe",async(n,i)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}});try{const s=ti(i),o={topic:n,relay:s,transportType:i?.transportType};this.pending.set(n,o);const a=await this.rpcSubscribe(n,s,i);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}})),a}catch(s){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(s),s}}),Q(this,"unsubscribe",async(n,i)=>{this.isInitialized(),typeof i?.id<"u"?await this.unsubscribeById(n,i.id,i):await this.unsubscribeByTopic(n,i)}),Q(this,"isSubscribed",n=>new Promise(i=>{i(this.topicMap.topics.includes(n))})),Q(this,"isKnownTopic",n=>new Promise(i=>{i(this.topicMap.topics.includes(n)||this.pending.has(n)||this.cached.some(s=>s.topic===n))})),Q(this,"on",(n,i)=>{this.events.on(n,i)}),Q(this,"once",(n,i)=>{this.events.once(n,i)}),Q(this,"off",(n,i)=>{this.events.off(n,i)}),Q(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),Q(this,"start",async()=>{await this.onConnect()}),Q(this,"stop",async()=>{await this.onDisconnect()}),Q(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Q(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const n=[];this.pending.forEach(i=>{n.push(i)}),await this.batchSubscribe(n)}),Q(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Ct.pulse,async()=>{await this.checkPending()}),this.events.on(Re.created,async n=>{const i=Re.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()}),this.events.on(Re.deleted,async n=>{const i=Re.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()})}),this.relayer=e,this.logger=Be(r,this.name),this.clientId=""}get context(){return Ue(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let n=!1;try{n=this.getSubscription(e).topic===r}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const n=this.topicMap.get(e);await Promise.all(n.map(async i=>await this.unsubscribeById(e,i,r)))}async unsubscribeById(e,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}});try{const i=ti(n);await this.restartToComplete({topic:e,id:r,relay:i}),await this.rpcUnsubscribe(e,r,i);const s=on("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,r,n){var i;(!n||n?.transportType===Lt.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const s={method:sn(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});const o=(i=n?.internal)==null?void 0:i.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if(n?.transportType===Lt.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(s).catch(l=>this.logger.warn(l))},k.toMiliseconds(k.ONE_SECOND)),a;const c=new Promise(async l=>{const h=f=>{f.topic===e&&(this.events.removeListener(Re.created,h),l(f.id))};this.events.on(Re.created,h);try{const f=await Dt(new Promise((p,g)=>{this.relayer.request(s).catch(y=>{this.logger.warn(y,y?.message),g(y)}).then(p)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Re.created,h),l(f)}catch{}}),u=await Dt(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return u?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(be.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,n={method:sn(r.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Dt(new Promise(i=>{this.relayer.request(n).catch(s=>this.logger.warn(s)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(be.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,n={method:sn(r.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let i;try{i=await await Dt(new Promise((s,o)=>{this.relayer.request(n).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(be.connection_stalled)}return i}rpcUnsubscribe(e,r,n){const i={method:sn(n.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,r){this.setSubscription(e,uo(un({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,un({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,un({},r)),this.topicMap.set(r.topic,e),this.events.emit(Re.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(Re.deleted,uo(un({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Re.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<r;n++){const i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(Re.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>uo(un({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await n1(k.toMiliseconds(k.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=X("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return ei(e+await this.getClientId())}}var T_=Object.defineProperty,mh=Object.getOwnPropertySymbols,B_=Object.prototype.hasOwnProperty,R_=Object.prototype.propertyIsEnumerable,lo=(t,e,r)=>e in t?T_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Eh=(t,e)=>{for(var r in e||(e={}))B_.call(e,r)&&lo(t,r,e[r]);if(mh)for(var r of mh(e))R_.call(e,r)&&lo(t,r,e[r]);return t},G=(t,e,r)=>lo(t,typeof e!="symbol"?e+"":e,r);class vh extends Wd{constructor(e){super(e),G(this,"protocol","wc"),G(this,"version",2),G(this,"core"),G(this,"logger"),G(this,"events",new Ve.exports.EventEmitter),G(this,"provider"),G(this,"messages"),G(this,"subscriber"),G(this,"publisher"),G(this,"name",ha),G(this,"transportExplicitlyClosed",!1),G(this,"initialized",!1),G(this,"connectionAttemptInProgress",!1),G(this,"relayUrl"),G(this,"projectId"),G(this,"packageName"),G(this,"bundleId"),G(this,"hasExperiencedNetworkDisruption",!1),G(this,"pingTimeout"),G(this,"heartBeatTimeout",k.toMiliseconds(k.THIRTY_SECONDS+k.FIVE_SECONDS)),G(this,"reconnectTimeout"),G(this,"connectPromise"),G(this,"reconnectInProgress",!1),G(this,"requestsInFlight",[]),G(this,"connectTimeout",k.toMiliseconds(k.ONE_SECOND*15)),G(this,"request",async r=>{var n,i;this.logger.debug("Publishing Request Payload");const s=r.id||no().toString();await this.toEstablishConnection();try{this.logger.trace({id:s,method:r.method,topic:(n=r.params)==null?void 0:n.topic},"relayer.request - publishing...");const o=`${s}:${((i=r.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${s}`),o}}),G(this,"resetPingTimeout",()=>{Vn()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,n,i,s;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(s=(i=(n=(r=this.provider)==null?void 0:r.connection)==null?void 0:n.socket)==null?void 0:i.terminate)==null||s.call(i)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),G(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),G(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1F6DC}"),this.startPingTimeout(),this.events.emit(be.connect)}),G(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1F6D1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),G(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(be.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),G(this,"registerProviderListeners",()=>{this.provider.on(Fe.payload,this.onPayloadHandler),this.provider.on(Fe.connect,this.onConnectHandler),this.provider.on(Fe.disconnect,this.onDisconnectHandler),this.provider.on(Fe.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Be(e.logger,this.name):Et(Jo({level:e.logger||la})),this.messages=new Ql(this.logger,e.core),this.subscriber=new wh(this,this.logger),this.publisher=new E_(this,this.logger),this.relayUrl=e?.relayUrl||Ii,this.projectId=e.projectId,qm()?this.packageName=ku():Wm()&&(this.bundleId=ku()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}}get context(){return Ue(this.logger)}get connected(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===1||!1}get connecting(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,n){this.isInitialized(),await this.publisher.publish(e,r,n),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:Lt.relay},Lr.outbound)}async subscribe(e,r){var n,i,s;this.isInitialized(),(!(r!=null&&r.transportType)||r?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((n=r?.internal)==null?void 0:n.throwOnFailedPublish)>"u"?!0:(i=r?.internal)==null?void 0:i.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const u=l=>{l.topic===e&&(this.subscriber.off(Re.created,u),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on(Re.created,u)}),new Promise(async(l,h)=>{a=await this.subscriber.subscribe(e,Eh({internal:{throwOnFailedPublish:o}},r)).catch(f=>{o&&h(f)})||a,l()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Dt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,n)=>{await this.connect(e).then(r).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Yl())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((n,i)=>n.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const n of r)try{await this.onMessageEvent(n)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+i?.message)}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:n}=e;if(!r.sessionExists){const i=Wr(k.FIVE_MINUTES),s={topic:n,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(n,s)}this.events.emit(be.message,e),await this.recordMessageEvent(e,Lr.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(n,i)=>{const s=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Fe.disconnect,s),await Dt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(Fe.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Fe.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Fe.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,n()})}catch(n){await this.subscriber.stop();const i=n;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(n=>setTimeout(n,k.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,n,i,s;if(Vn())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((s=(i=(n=this.provider)==null?void 0:n.connection)==null?void 0:i.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new l_(new g_(Jm({sdkVersion:In,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:n,message:i}=e;await this.messages.set(n,i,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const i=this.messages.has(r,n);return i&&this.logger.warn(`Ignoring duplicate message: ${n}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),fh(e)){if(!e.method.endsWith(fa))return;const r=e.params,{topic:n,message:i,publishedAt:s,attestation:o}=r.data,a={topic:n,message:i,publishedAt:s,transportType:Lt.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Eh({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else so(e)&&this.events.emit(be.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Lr.inbound),this.events.emit(be.message,e))}async acknowledgePayload(e){const r=ch(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(Fe.payload,this.onPayloadHandler),this.provider.off(Fe.connect,this.onConnectHandler),this.provider.off(Fe.disconnect,this.onDisconnectHandler),this.provider.off(Fe.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Yl();lv(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(n=>this.logger.error(n,n?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Ct.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&dv())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(be.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},k.toMiliseconds(da)))))}isInitialized(){if(!this.initialized){const{message:e}=X("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function C_(){}function _h(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function Sh(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Ih(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const N_="[object RegExp]",P_="[object String]",L_="[object Number]",$_="[object Boolean]",Dh="[object Arguments]",U_="[object Symbol]",F_="[object Date]",z_="[object Map]",j_="[object Set]",k_="[object Array]",M_="[object Function]",V_="[object ArrayBuffer]",ho="[object Object]",K_="[object Error]",H_="[object DataView]",q_="[object Uint8Array]",W_="[object Uint8ClampedArray]",G_="[object Uint16Array]",Y_="[object Uint32Array]",Z_="[object BigUint64Array]",X_="[object Int8Array]",J_="[object Int16Array]",Q_="[object Int32Array]",e2="[object BigInt64Array]",t2="[object Float32Array]",r2="[object Float64Array]";function n2(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function i2(t,e,r){return ln(t,e,void 0,void 0,void 0,void 0,r)}function ln(t,e,r,n,i,s,o){const a=o(t,e,r,n,i,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return hn(t,e,s,o)}return hn(t,e,s,o)}function hn(t,e,r,n){if(Object.is(t,e))return!0;let i=Ih(t),s=Ih(e);if(i===Dh&&(i=ho),s===Dh&&(s=ho),i!==s)return!1;switch(i){case P_:return t.toString()===e.toString();case L_:{const c=t.valueOf(),u=e.valueOf();return n2(c,u)}case $_:case F_:case U_:return Object.is(t.valueOf(),e.valueOf());case N_:return t.source===e.source&&t.flags===e.flags;case M_:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(i){case z_:{if(t.size!==e.size)return!1;for(const[c,u]of t.entries())if(!e.has(c)||!ln(u,e.get(c),c,t,e,r,n))return!1;return!0}case j_:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),u=Array.from(e.values());for(let l=0;l<c.length;l++){const h=c[l],f=u.findIndex(p=>ln(h,p,void 0,t,e,r,n));if(f===-1)return!1;u.splice(f,1)}return!0}case k_:case q_:case W_:case G_:case Y_:case Z_:case X_:case J_:case Q_:case e2:case t2:case r2:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!ln(t[c],e[c],c,t,e,r,n))return!1;return!0}case V_:return t.byteLength!==e.byteLength?!1:hn(new Uint8Array(t),new Uint8Array(e),r,n);case H_:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:hn(new Uint8Array(t),new Uint8Array(e),r,n);case K_:return t.name===e.name&&t.message===e.message;case ho:{if(!(hn(t.constructor,e.constructor,r,n)||_h(t)&&_h(e)))return!1;const u=[...Object.keys(t),...Sh(t)],l=[...Object.keys(e),...Sh(e)];if(u.length!==l.length)return!1;for(let h=0;h<u.length;h++){const f=u[h],p=t[f];if(!Object.hasOwn(e,f))return!1;const g=e[f];if(!ln(p,g,f,t,e,r,n))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function s2(t,e){return i2(t,e,C_)}var o2=Object.defineProperty,Oh=Object.getOwnPropertySymbols,a2=Object.prototype.hasOwnProperty,c2=Object.prototype.propertyIsEnumerable,fo=(t,e,r)=>e in t?o2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xh=(t,e)=>{for(var r in e||(e={}))a2.call(e,r)&&fo(t,r,e[r]);if(Oh)for(var r of Oh(e))c2.call(e,r)&&fo(t,r,e[r]);return t},$e=(t,e,r)=>fo(t,typeof e!="symbol"?e+"":e,r);class Ah extends Gd{constructor(e,r,n,i=We,s=void 0){super(e,r,n,i),this.core=e,this.logger=r,this.name=n,$e(this,"map",new Map),$e(this,"version",ga),$e(this,"cached",[]),$e(this,"initialized",!1),$e(this,"getKey"),$e(this,"storagePrefix",We),$e(this,"recentlyDeleted",[]),$e(this,"recentlyDeletedLimit",200),$e(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!ri(o)?this.map.set(this.getKey(o),o):sv(o)?this.map.set(o.id,o):ov(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),$e(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),$e(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),$e(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>s2(a[c],o[c]))):this.values)),$e(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=xh(xh({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),$e(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Be(r,this.name),this.storagePrefix=i,this.getKey=s}get context(){return Ue(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:i}=X("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=X("NOT_INITIALIZED",this.name);throw new Error(e)}}}var u2=Object.defineProperty,l2=(t,e,r)=>e in t?u2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,q=(t,e,r)=>l2(t,typeof e!="symbol"?e+"":e,r);class Th{constructor(e,r){this.core=e,this.logger=r,q(this,"name",wa),q(this,"version",ma),q(this,"events",new Ve.exports),q(this,"pairings"),q(this,"initialized",!1),q(this,"storagePrefix",We),q(this,"ignoredPayloadTypes",[Dr]),q(this,"registeredMethods",[]),q(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),q(this,"register",({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]}),q(this,"create",async n=>{this.isInitialized();const i=Zs(),s=await this.core.crypto.setSymKey(i),o=Wr(k.FIVE_MINUTES),a={protocol:ua},c={topic:s,expiry:o,relay:a,active:!1,methods:n?.methods},u=Wl({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a,expiryTimestamp:o,methods:n?.methods});return this.events.emit(tr.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:n?.transportType}),{topic:s,uri:u}}),q(this,"pair",async n=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:n?.uri,trace:[tt.pairing_started]}});this.isValidPair(n,i);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:u}=ql(n.uri);i.props.properties.topic=s,i.addTrace(tt.pairing_uri_validation_success),i.addTrace(tt.pairing_uri_not_expired);let l;if(this.pairings.keys.includes(s)){if(l=this.pairings.get(s),i.addTrace(tt.existing_pairing),l.active)throw i.setError(ot.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);i.addTrace(tt.pairing_not_expired)}const h=c||Wr(k.FIVE_MINUTES),f={topic:s,relay:a,expiry:h,active:!1,methods:u};this.core.expirer.set(s,h),await this.pairings.set(s,f),i.addTrace(tt.store_new_pairing),n.activatePairing&&await this.activate({topic:s}),this.events.emit(tr.create,f),i.addTrace(tt.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),i.addTrace(tt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(ot.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(p){throw i.setError(ot.subscribe_pairing_topic_failure),p}return i.addTrace(tt.subscribe_pairing_topic_success),f}),q(this,"activate",async({topic:n})=>{this.isInitialized();const i=Wr(k.FIVE_MINUTES);this.core.expirer.set(n,i),await this.pairings.update(n,{active:!0,expiry:i})}),q(this,"ping",async n=>{this.isInitialized(),await this.isValidPing(n),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=n;if(this.pairings.keys.includes(i)){const s=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Qm();this.events.once(Is("pairing_ping",s),({error:u})=>{u?c(u):a()}),await o()}}),q(this,"updateExpiry",async({topic:n,expiry:i})=>{this.isInitialized(),await this.pairings.update(n,{expiry:i})}),q(this,"updateMetadata",async({topic:n,metadata:i})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:i})}),q(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),q(this,"disconnect",async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:i}=n;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",on("USER_DISCONNECTED")),await this.deletePairing(i))}),q(this,"formatUriFromPairing",n=>{this.isInitialized();const{topic:i,relay:s,expiry:o,methods:a}=n,c=this.core.crypto.keychain.get(i);return Wl({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),q(this,"sendRequest",async(n,i,s)=>{const o=io(i,s),a=await this.core.crypto.encode(n,o),c=er[i].req;return this.core.history.set(n,o),this.core.relayer.publish(n,a,c),o.id}),q(this,"sendResult",async(n,i,s)=>{const o=ch(n,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,u=er[c].res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),q(this,"sendError",async(n,i,s)=>{const o=uh(n,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,u=er[c]?er[c].res:er.unregistered_method.res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),q(this,"deletePairing",async(n,i)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,on("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),i?Promise.resolve():this.core.expirer.del(n)])}),q(this,"cleanup",async()=>{const n=this.pairings.getAll().filter(i=>Ku(i.expiry));await Promise.all(n.map(i=>this.deletePairing(i.topic)))}),q(this,"onRelayEventRequest",async n=>{const{topic:i,payload:s}=n;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,s);default:return await this.onUnknownRpcMethodRequest(i,s)}}),q(this,"onRelayEventResponse",async n=>{const{topic:i,payload:s}=n,o=(await this.core.history.get(i,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(o)}}),q(this,"onPairingPingRequest",async(n,i)=>{const{id:s}=i;try{this.isValidPing({topic:n}),await this.sendResult(s,n,!0),this.events.emit(tr.ping,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}}),q(this,"onPairingPingResponse",(n,i)=>{const{id:s}=i;setTimeout(()=>{dh(i)?this.events.emit(Is("pairing_ping",s),{}):ni(i)&&this.events.emit(Is("pairing_ping",s),{error:i.error})},500)}),q(this,"onPairingDeleteRequest",async(n,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(tr.delete,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}}),q(this,"onUnknownRpcMethodRequest",async(n,i)=>{const{id:s,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=on("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,n,a),this.logger.error(a)}catch(a){await this.sendError(s,n,a),this.logger.error(a)}}),q(this,"onUnknownRpcMethodResponse",n=>{this.registeredMethods.includes(n)||this.logger.error(on("WC_METHOD_UNSUPPORTED",n))}),q(this,"isValidPair",(n,i)=>{var s;if(!Xs(n)){const{message:a}=X("MISSING_OR_INVALID",`pair() params: ${n}`);throw i.setError(ot.malformed_pairing_uri),new Error(a)}if(!iv(n.uri)){const{message:a}=X("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw i.setError(ot.malformed_pairing_uri),new Error(a)}const o=ql(n?.uri);if(!((s=o?.relay)!=null&&s.protocol)){const{message:a}=X("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(ot.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=X("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(ot.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&k.toMiliseconds(o?.expiryTimestamp)<Date.now()){i.setError(ot.pairing_expired);const{message:a}=X("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),q(this,"isValidPing",async n=>{if(!Xs(n)){const{message:s}=X("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)}),q(this,"isValidDisconnect",async n=>{if(!Xs(n)){const{message:s}=X("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)}),q(this,"isValidPairingTopic",async n=>{if(!Gl(n,!1)){const{message:i}=X("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(i)}if(!this.pairings.keys.includes(n)){const{message:i}=X("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(i)}if(Ku(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:i}=X("EXPIRED",`pairing topic: ${n}`);throw new Error(i)}}),this.core=e,this.logger=Be(r,this.name),this.pairings=new Ah(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ue(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=X("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(be.message,async e=>{const{topic:r,message:n,transportType:i}=e;if(this.pairings.keys.includes(r)&&i!==Lt.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{const s=await this.core.crypto.decode(r,n);fh(s)?(this.core.history.set(r,s),await this.onRelayEventRequest({topic:r,payload:s})):so(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id)),await this.core.relayer.messages.ack(r,n)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(He.expired,async e=>{const{topic:r}=r1(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(tr.expire,{topic:r}))})}}var h2=Object.defineProperty,f2=(t,e,r)=>e in t?h2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_e=(t,e,r)=>f2(t,typeof e!="symbol"?e+"":e,r);class Bh extends Kd{constructor(e,r){super(e,r),this.core=e,this.logger=r,_e(this,"records",new Map),_e(this,"events",new Ve.exports.EventEmitter),_e(this,"name",Ea),_e(this,"version",va),_e(this,"cached",[]),_e(this,"initialized",!1),_e(this,"storagePrefix",We),_e(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),_e(this,"set",(n,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:i,chainId:s}),this.records.has(i.id))return;const o={id:i.id,topic:n,request:{method:i.method,params:i.params||null},chainId:s,expiry:Wr(k.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Ke.created,o)}),_e(this,"resolve",async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const i=await this.getRecord(n.id);typeof i.response>"u"&&(i.response=ni(n)?{error:n.error}:{result:n.result},this.records.set(i.id,i),this.persist(),this.events.emit(Ke.updated,i))}),_e(this,"get",async(n,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:i}),await this.getRecord(i))),_e(this,"delete",(n,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===n){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(Ke.deleted,s)}}),this.persist()}),_e(this,"exists",async(n,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===n:!1)),_e(this,"on",(n,i)=>{this.events.on(n,i)}),_e(this,"once",(n,i)=>{this.events.once(n,i)}),_e(this,"off",(n,i)=>{this.events.off(n,i)}),_e(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=Be(r,this.name)}get context(){return Ue(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:io(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Ke.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Ke.created,e=>{const r=Ke.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(Ke.updated,e=>{const r=Ke.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(Ke.deleted,e=>{const r=Ke.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(Ct.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{k.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(Ke.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=X("NOT_INITIALIZED",this.name);throw new Error(e)}}}var d2=Object.defineProperty,g2=(t,e,r)=>e in t?d2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ie=(t,e,r)=>g2(t,typeof e!="symbol"?e+"":e,r);class Rh extends Zd{constructor(e,r){super(e,r),this.core=e,this.logger=r,Ie(this,"expirations",new Map),Ie(this,"events",new Ve.exports.EventEmitter),Ie(this,"name",_a),Ie(this,"version",Sa),Ie(this,"cached",[]),Ie(this,"initialized",!1),Ie(this,"storagePrefix",We),Ie(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ie(this,"has",n=>{try{const i=this.formatTarget(n);return typeof this.getExpiration(i)<"u"}catch{return!1}}),Ie(this,"set",(n,i)=>{this.isInitialized();const s=this.formatTarget(n),o={target:s,expiry:i};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(He.created,{target:s,expiration:o})}),Ie(this,"get",n=>{this.isInitialized();const i=this.formatTarget(n);return this.getExpiration(i)}),Ie(this,"del",n=>{if(this.isInitialized(),this.has(n)){const i=this.formatTarget(n),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(He.deleted,{target:i,expiration:s})}}),Ie(this,"on",(n,i)=>{this.events.on(n,i)}),Ie(this,"once",(n,i)=>{this.events.once(n,i)}),Ie(this,"off",(n,i)=>{this.events.off(n,i)}),Ie(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=Be(r,this.name)}get context(){return Ue(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return e1(e);if(typeof e=="number")return t1(e);const{message:r}=X("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(He.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(n),new Error(n)}return r}checkExpiry(e,r){const{expiry:n}=r;k.toMiliseconds(n)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(He.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Ct.pulse,()=>this.checkExpirations()),this.events.on(He.created,e=>{const r=He.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(He.expired,e=>{const r=He.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(He.deleted,e=>{const r=He.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=X("NOT_INITIALIZED",this.name);throw new Error(e)}}}var p2=Object.defineProperty,y2=(t,e,r)=>e in t?p2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oe=(t,e,r)=>y2(t,typeof e!="symbol"?e+"":e,r);class Ch extends Xd{constructor(e,r,n){super(e,r,n),this.core=e,this.logger=r,this.store=n,oe(this,"name",Ia),oe(this,"abortController"),oe(this,"isDevEnv"),oe(this,"verifyUrlV3",Oa),oe(this,"storagePrefix",We),oe(this,"version",vi),oe(this,"publicKey"),oe(this,"fetchPromise"),oe(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&k.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),oe(this,"register",async i=>{if(!qr()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const u=sr(),l=this.startAbortTimer(k.ONE_SECOND*5),h=await new Promise((f,p)=>{const g=()=>{window.removeEventListener("message",d),u.body.removeChild(y),p("attestation aborted")};this.abortController.signal.addEventListener("abort",g);const y=u.createElement("iframe");y.src=c,y.style.display="none",y.addEventListener("error",g,{signal:this.abortController.signal});const d=E=>{if(E.data&&typeof E.data=="string")try{const m=JSON.parse(E.data);if(m.type==="verify_attestation"){if(qi(m.attestation).payload.id!==o)return;clearInterval(l),u.body.removeChild(y),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",d),f(m.attestation===null?"":m.attestation)}}catch(m){this.logger.warn(m)}};u.body.appendChild(y),window.addEventListener("message",d,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(u){this.logger.warn(u)}return""}),oe(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=i;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(qi(s).payload.id!==a)return;const u=await this.isValidJwtAttestation(s);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;const c=this.getVerifyUrl(i?.verifyUrl);return this.fetchAttestation(o,c)}),oe(this,"fetchAttestation",async(i,s)=>{this.logger.debug(`resolving attestation: ${i} from url: ${s}`);const o=this.startAbortTimer(k.ONE_SECOND*5),a=await fetch(`${s}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),oe(this,"getVerifyUrl",i=>{let s=i||$r;return xa.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${$r}`),s=$r),s}),oe(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(k.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await s.json()}catch(i){this.logger.warn(i)}}),oe(this,"persistPublicKey",async i=>{this.logger.debug("persisting public key to local storage",i),await this.store.setItem(this.storeKey,i),this.publicKey=i}),oe(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),oe(this,"isValidJwtAttestation",async i=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(i,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),oe(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),oe(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),oe(this,"validateAttestation",(i,s)=>{const o=XE(i,s.publicKey),a={hasExpired:k.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Be(r,this.name),this.abortController=new AbortController,this.isDevEnv=qu(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Ue(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),k.toMiliseconds(e))}}var b2=Object.defineProperty,w2=(t,e,r)=>e in t?b2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Nh=(t,e,r)=>w2(t,typeof e!="symbol"?e+"":e,r);class Ph extends Jd{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,Nh(this,"context",Aa),Nh(this,"registerDeviceToken",async n=>{const{clientId:i,token:s,notificationType:o,enableEncrypted:a=!1}=n,c=`${Ta}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:s,always_raw:a})})}),this.logger=Be(r,this.context)}}var m2=Object.defineProperty,Lh=Object.getOwnPropertySymbols,E2=Object.prototype.hasOwnProperty,v2=Object.prototype.propertyIsEnumerable,go=(t,e,r)=>e in t?m2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fn=(t,e)=>{for(var r in e||(e={}))E2.call(e,r)&&go(t,r,e[r]);if(Lh)for(var r of Lh(e))v2.call(e,r)&&go(t,r,e[r]);return t},ye=(t,e,r)=>go(t,typeof e!="symbol"?e+"":e,r);class $h extends Qd{constructor(e,r,n=!0){super(e,r,n),this.core=e,this.logger=r,ye(this,"context",Ra),ye(this,"storagePrefix",We),ye(this,"storageVersion",Ba),ye(this,"events",new Map),ye(this,"shouldPersist",!1),ye(this,"init",async()=>{if(!qu())try{const i={eventId:Hu(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Mu(this.core.relayer.protocol,this.core.relayer.version,In)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),ye(this,"createEvent",i=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=i,u=Hu(),l=this.core.projectId||"",h=Date.now(),f=fn({eventId:u,timestamp:h,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,f),this.shouldPersist=!0),f}),ye(this,"getEvent",i=>{const{eventId:s,topic:o}=i;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return fn(fn({},a),this.setMethods(a.eventId))}),ye(this,"deleteEvent",i=>{const{eventId:s}=i;this.events.delete(s),this.shouldPersist=!0}),ye(this,"setEventListeners",()=>{this.core.heartbeat.on(Ct.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{k.fromMiliseconds(Date.now())-k.fromMiliseconds(i.timestamp)>Ca&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),ye(this,"setMethods",i=>({addTrace:s=>this.addTrace(i,s),setError:s=>this.setError(i,s)})),ye(this,"addTrace",(i,s)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(s),this.events.set(i,o),this.shouldPersist=!0)}),ye(this,"setError",(i,s)=>{const o=this.events.get(i);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),ye(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),ye(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(s=>{this.events.set(s.eventId,fn(fn({},s),this.setMethods(s.eventId)))})}catch(i){this.logger.warn(i)}}),ye(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[s,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const s of i)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),ye(this,"sendEvent",async i=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${Na}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${In}${s}`,{method:"POST",body:JSON.stringify(i)})}),ye(this,"getAppDomain",()=>Ym().url),this.logger=Be(r,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var _2=Object.defineProperty,Uh=Object.getOwnPropertySymbols,S2=Object.prototype.hasOwnProperty,I2=Object.prototype.propertyIsEnumerable,po=(t,e,r)=>e in t?_2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Fh=(t,e)=>{for(var r in e||(e={}))S2.call(e,r)&&po(t,r,e[r]);if(Uh)for(var r of Uh(e))I2.call(e,r)&&po(t,r,e[r]);return t},te=(t,e,r)=>po(t,typeof e!="symbol"?e+"":e,r);class si extends jd{constructor(e){var r;super(e),te(this,"protocol",Ei),te(this,"version",vi),te(this,"name",Pr),te(this,"relayUrl"),te(this,"projectId"),te(this,"customStoragePrefix"),te(this,"events",new Ve.exports.EventEmitter),te(this,"logger"),te(this,"heartbeat"),te(this,"relayer"),te(this,"crypto"),te(this,"storage"),te(this,"history"),te(this,"expirer"),te(this,"pairing"),te(this,"verify"),te(this,"echoClient"),te(this,"linkModeSupportedApps"),te(this,"eventClient"),te(this,"initialized",!1),te(this,"logChunkController"),te(this,"on",(a,c)=>this.events.on(a,c)),te(this,"once",(a,c)=>this.events.once(a,c)),te(this,"off",(a,c)=>this.events.off(a,c)),te(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),te(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;const l={topic:a,message:c,publishedAt:Date.now(),transportType:Lt.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:u})});const n=this.getGlobalCore(e?.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Ii,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=Jo({level:typeof e?.logger=="string"&&e.logger?e.logger:ea.logger,name:Pr}),{logger:s,chunkLoggerController:o}=Ud({opts:i,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Be(s,this.name),this.heartbeat=new di,this.crypto=new Xl(this,this.logger,e?.keychain),this.history=new Bh(this,this.logger),this.expirer=new Rh(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new ud(Fh(Fh({},ta),e?.storageOptions)),this.relayer=new vh({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Th(this,this.logger),this.verify=new Ch(this,this.logger,this.storage),this.echoClient=new Ph(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new $h(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new si(e);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(pa,n),r}get context(){return Ue(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Di,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Di)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,n=`${r}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[n]=e}catch(n){console.warn("Failed to set global WalletConnect core",n)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const D2=si;L.CORE_CONTEXT=Pr,L.CORE_DEFAULT=ea,L.CORE_PROTOCOL=Ei,L.CORE_STORAGE_OPTIONS=ta,L.CORE_STORAGE_PREFIX=We,L.CORE_VERSION=vi,L.CRYPTO_CLIENT_SEED=_i,L.CRYPTO_CONTEXT=ra,L.CRYPTO_JWT_TTL=na,L.Core=D2,L.Crypto=Xl,L.ECHO_CONTEXT=Aa,L.ECHO_URL=Ta,L.EVENTS_CLIENT_API_URL=Na,L.EVENTS_STORAGE_CLEANUP_INTERVAL=Ca,L.EVENTS_STORAGE_CONTEXT=Ra,L.EVENTS_STORAGE_VERSION=Ba,L.EVENT_CLIENT_AUTHENTICATE_ERRORS=hg,L.EVENT_CLIENT_AUTHENTICATE_TRACES=lg,L.EVENT_CLIENT_CONTEXT=ag,L.EVENT_CLIENT_PAIRING_ERRORS=ot,L.EVENT_CLIENT_PAIRING_TRACES=tt,L.EVENT_CLIENT_SESSION_ERRORS=ug,L.EVENT_CLIENT_SESSION_TRACES=cg,L.EXPIRER_CONTEXT=_a,L.EXPIRER_DEFAULT_TTL=sg,L.EXPIRER_EVENTS=He,L.EXPIRER_STORAGE_VERSION=Sa,L.EchoClient=Ph,L.EventClient=$h,L.Expirer=Rh,L.HISTORY_CONTEXT=Ea,L.HISTORY_EVENTS=Ke,L.HISTORY_STORAGE_VERSION=va,L.JsonRpcHistory=Bh,L.KEYCHAIN_CONTEXT=ia,L.KEYCHAIN_STORAGE_VERSION=sa,L.KeyChain=Zl,L.MESSAGES_CONTEXT=oa,L.MESSAGES_STORAGE_VERSION=aa,L.MESSAGE_DIRECTION=Lr,L.MessageTracker=Ql,L.PAIRING_CONTEXT=wa,L.PAIRING_DEFAULT_TTL=ig,L.PAIRING_EVENTS=tr,L.PAIRING_RPC_OPTS=er,L.PAIRING_STORAGE_VERSION=ma,L.PENDING_SUB_RESOLUTION_TIMEOUT=ng,L.PUBLISHER_CONTEXT=ca,L.PUBLISHER_DEFAULT_TTL=Si,L.Pairing=Th,L.RELAYER_CONTEXT=ha,L.RELAYER_DEFAULT_LOGGER=la,L.RELAYER_DEFAULT_PROTOCOL=ua,L.RELAYER_DEFAULT_RELAY_URL=Ii,L.RELAYER_EVENTS=be,L.RELAYER_PROVIDER_EVENTS=Fe,L.RELAYER_RECONNECT_TIMEOUT=da,L.RELAYER_SDK_VERSION=In,L.RELAYER_STORAGE_OPTIONS=eg,L.RELAYER_SUBSCRIBER_SUFFIX=fa,L.RELAYER_TRANSPORT_CUTOFF=tg,L.Relayer=vh,L.STORE_STORAGE_VERSION=ga,L.SUBSCRIBER_CONTEXT=ya,L.SUBSCRIBER_DEFAULT_TTL=rg,L.SUBSCRIBER_EVENTS=Re,L.SUBSCRIBER_STORAGE_VERSION=ba,L.Store=Ah,L.Subscriber=wh,L.TRANSPORT_TYPES=Lt,L.TRUSTED_VERIFY_URLS=xa,L.VERIFY_CONTEXT=Ia,L.VERIFY_SERVER=$r,L.VERIFY_SERVER_V3=Oa,L.Verify=Ch,L.WALLETCONNECT_CLIENT_ID=pa,L.WALLETCONNECT_LINK_MODE_APPS=Di,L.default=si,Object.defineProperty(L,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
