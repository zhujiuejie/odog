var Q=/\{[^{}]+\}/g,J=()=>typeof process=="object"&&Number.parseInt(process?.versions?.node?.substring(0,2))>=18&&process.versions.undici;function _(){return Math.random().toString(36).slice(2,11)}function v(n){let{baseUrl:e="",Request:t=globalThis.Request,fetch:o=globalThis.fetch,querySerializer:r,bodySerializer:i,headers:c,requestInitExt:a=void 0,...W}={...n};a=J()?a:void 0,e=N(e);let p=[];async function h(l,s){let{baseUrl:m,fetch:P=o,Request:Z=t,headers:D,params:w={},parseAs:A="json",querySerializer:E,bodySerializer:H=i??X,body:I,...S}=s||{},$=e;m&&($=N(m)??e);let C=typeof r=="function"?r:L(r);E&&(C=typeof E=="function"?E:L({...typeof r=="object"?r:{},...E}));let O=I===void 0?void 0:H(I,k(c,D,w.header)),G=k(O===void 0||O instanceof FormData?{}:{"Content-Type":"application/json"},c,D,w.header),M={redirect:"follow",...W,...S,body:O,headers:G},T,g,y=new t(Y(l,{baseUrl:$,params:w,querySerializer:C}),M),f;for(let d in S)d in y||(y[d]=S[d]);if(p.length){T=_(),g=Object.freeze({baseUrl:$,fetch:P,parseAs:A,querySerializer:C,bodySerializer:H});for(let d of p)if(d&&typeof d=="object"&&typeof d.onRequest=="function"){let u=await d.onRequest({request:y,schemaPath:l,params:w,options:g,id:T});if(u)if(u instanceof t)y=u;else if(u instanceof Response){f=u;break}else throw new Error("onRequest: must return new Request() or Response() when modifying the request")}}if(!f){try{f=await P(y,a)}catch(d){let u=d;if(p.length)for(let b=p.length-1;b>=0;b--){let j=p[b];if(j&&typeof j=="object"&&typeof j.onError=="function"){let R=await j.onError({request:y,error:u,schemaPath:l,params:w,options:g,id:T});if(R){if(R instanceof Response){u=void 0,f=R;break}if(R instanceof Error){u=R;continue}throw new Error("onError: must return new Response() or instance of Error")}}}if(u)throw u}if(p.length)for(let d=p.length-1;d>=0;d--){let u=p[d];if(u&&typeof u=="object"&&typeof u.onResponse=="function"){let b=await u.onResponse({request:y,response:f,schemaPath:l,params:w,options:g,id:T});if(b){if(!(b instanceof Response))throw new Error("onResponse: must return new Response() when modifying the response");f=b}}}}if(f.status===204||y.method==="HEAD"||f.headers.get("Content-Length")==="0")return f.ok?{data:void 0,response:f}:{error:void 0,response:f};if(f.ok)return A==="stream"?{data:f.body,response:f}:{data:await f[A](),response:f};let U=await f.text();try{U=JSON.parse(U)}catch{}return{error:U,response:f}}return{request(l,s,m){return h(s,{...m,method:l.toUpperCase()})},GET(l,s){return h(l,{...s,method:"GET"})},PUT(l,s){return h(l,{...s,method:"PUT"})},POST(l,s){return h(l,{...s,method:"POST"})},DELETE(l,s){return h(l,{...s,method:"DELETE"})},OPTIONS(l,s){return h(l,{...s,method:"OPTIONS"})},HEAD(l,s){return h(l,{...s,method:"HEAD"})},PATCH(l,s){return h(l,{...s,method:"PATCH"})},TRACE(l,s){return h(l,{...s,method:"TRACE"})},use(...l){for(let s of l)if(s){if(typeof s!="object"||!("onRequest"in s||"onResponse"in s||"onError"in s))throw new Error("Middleware must be an object with one of `onRequest()`, `onResponse() or `onError()`");p.push(s)}},eject(...l){for(let s of l){let m=p.indexOf(s);m!==-1&&p.splice(m,1)}}}}var q=class{constructor(e,t){this.client=e,this.url=t}GET=e=>this.client.GET(this.url,e);PUT=e=>this.client.PUT(this.url,e);POST=e=>this.client.POST(this.url,e);DELETE=e=>this.client.DELETE(this.url,e);OPTIONS=e=>this.client.OPTIONS(this.url,e);HEAD=e=>this.client.HEAD(this.url,e);PATCH=e=>this.client.PATCH(this.url,e);TRACE=e=>this.client.TRACE(this.url,e)},z=class{constructor(){this.client=null}get(e,t){let o=new q(e,t);return this.client[t]=o,o}};function K(n){let e=new z,t=new Proxy(n,e);function o(){}o.prototype=t;let r=new o;return e.client=r,r}function ee(n){return K(v(n))}function x(n,e,t){if(e==null)return"";if(typeof e=="object")throw new Error("Deeply-nested arrays/objects aren\u2019t supported. Provide your own `querySerializer()` to handle these.");return`${n}=${t?.allowReserved===!0?e:encodeURIComponent(e)}`}function B(n,e,t){if(!e||typeof e!="object")return"";let o=[],r={simple:",",label:".",matrix:";"}[t.style]||"&";if(t.style!=="deepObject"&&t.explode===!1){for(let a in e)o.push(a,t.allowReserved===!0?e[a]:encodeURIComponent(e[a]));let c=o.join(",");switch(t.style){case"form":return`${n}=${c}`;case"label":return`.${c}`;case"matrix":return`;${n}=${c}`;default:return c}}for(let c in e){let a=t.style==="deepObject"?`${n}[${c}]`:c;o.push(x(a,e[c],t))}let i=o.join(r);return t.style==="label"||t.style==="matrix"?`${r}${i}`:i}function F(n,e,t){if(!Array.isArray(e))return"";if(t.explode===!1){let i={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[t.style]||",",c=(t.allowReserved===!0?e:e.map(a=>encodeURIComponent(a))).join(i);switch(t.style){case"simple":return c;case"label":return`.${c}`;case"matrix":return`;${n}=${c}`;default:return`${n}=${c}`}}let o={simple:",",label:".",matrix:";"}[t.style]||"&",r=[];for(let i of e)t.style==="simple"||t.style==="label"?r.push(t.allowReserved===!0?i:encodeURIComponent(i)):r.push(x(n,i,t));return t.style==="label"||t.style==="matrix"?`${o}${r.join(o)}`:r.join(o)}function L(n){return function(t){let o=[];if(t&&typeof t=="object")for(let r in t){let i=t[r];if(i!=null){if(Array.isArray(i)){if(i.length===0)continue;o.push(F(r,i,{style:"form",explode:!0,...n?.array,allowReserved:n?.allowReserved||!1}));continue}if(typeof i=="object"){o.push(B(r,i,{style:"deepObject",explode:!0,...n?.object,allowReserved:n?.allowReserved||!1}));continue}o.push(x(r,i,n))}}return o.join("&")}}function V(n,e){let t=n;for(let o of n.match(Q)??[]){let r=o.substring(1,o.length-1),i=!1,c="simple";if(r.endsWith("*")&&(i=!0,r=r.substring(0,r.length-1)),r.startsWith(".")?(c="label",r=r.substring(1)):r.startsWith(";")&&(c="matrix",r=r.substring(1)),!e||e[r]===void 0||e[r]===null)continue;let a=e[r];if(Array.isArray(a)){t=t.replace(o,F(r,a,{style:c,explode:i}));continue}if(typeof a=="object"){t=t.replace(o,B(r,a,{style:c,explode:i}));continue}if(c==="matrix"){t=t.replace(o,`;${x(r,a)}`);continue}t=t.replace(o,c==="label"?`.${encodeURIComponent(a)}`:encodeURIComponent(a))}return t}function X(n,e){return n instanceof FormData?n:e&&(e.get instanceof Function?e.get("Content-Type")??e.get("content-type"):e["Content-Type"]??e["content-type"])==="application/x-www-form-urlencoded"?new URLSearchParams(n).toString():JSON.stringify(n)}function Y(n,e){let t=`${e.baseUrl}${n}`;e.params?.path&&(t=V(t,e.params.path));let o=e.querySerializer(e.params.query??{});return o.startsWith("?")&&(o=o.substring(1)),o&&(t+=`?${o}`),t}function k(...n){let e=new Headers;for(let t of n){if(!t||typeof t!="object")continue;let o=t instanceof Headers?t.entries():Object.entries(t);for(let[r,i]of o)if(i===null)e.delete(r);else if(Array.isArray(i))for(let c of i)e.append(r,c);else i!==void 0&&e.set(r,i)}return e}function N(n){return n.endsWith("/")?n.substring(0,n.length-1):n}export{Y as createFinalURL,ee as createPathBasedClient,L as createQuerySerializer,v as default,X as defaultBodySerializer,V as defaultPathSerializer,k as mergeHeaders,_ as randomID,N as removeTrailingSlash,F as serializeArrayParam,B as serializeObjectParam,x as serializePrimitiveParam,K as wrapAsPathBasedClient};
